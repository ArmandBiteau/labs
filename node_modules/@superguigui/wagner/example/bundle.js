(function e(t,r,i){function n(o,s){if(!r[o]){if(!t[o]){var h=typeof require=="function"&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){var r=t[o][1][e];return n(r?r:e)},u,u.exports,e,t,r,i)}return r[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<i.length;o++)n(i[o]);return n})({1:[function(e,t,r){"use strict";var i=e("domready");var n=e("three");var a=e("raf");var o=e("dat-gui");var s=e("..");var h=e("../src/passes/box-blur/BoxBlurPass");var l=e("../src/passes/fxaa/FXAAPass");var u=e("../src/passes/zoom-blur/ZoomBlurPass");var c=e("../src/passes/bloom/MultiPassBloomPass");var f,d,p;var m,v;var g=[];var y,x,_,b;var w;var M={usePostProcessing:true,useFXAA:true,useBlur:false,useBloom:true};i(function(){f=new n.Scene;d=new n.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e4);d.position.z=100;p=new n.WebGLRenderer({alpha:true});p.setSize(window.innerWidth,window.innerHeight);p.setClearColor(3289650);document.body.appendChild(p.domElement);v=new n.PointLight(16777215,1);v.position.copy(d.position);f.add(v);m=new n.MeshPhongMaterial({color:3841259});for(var e=0,t;e<500;e++){t=C();g.push(t);f.add(t)}t.position.set(0,0,50);T();E();window.addEventListener("resize",S);a(A)});function S(){y.setSize(window.innerWidth,window.innerHeight);d.aspect=window.innerWidth/window.innerHeight;d.updateProjectionMatrix();p.setSize(window.innerWidth,window.innerHeight)}function C(){var e=new n.Mesh(new n.BoxGeometry(20,20,20),m);e.position.set(Math.random()*600-300,Math.random()*600-300,Math.random()*-500);e.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2);return e}function T(){p.autoClearColor=true;y=new s.Composer(p);_=new l;x=new h(3,3);b=new c({blurAmount:2,applyZoomBlur:true});return y}function E(){w=new o.GUI;w.add(M,"usePostProcessing");w.add(M,"useFXAA");w.add(M,"useBlur");w.add(M,"useBloom");return w}function A(){a(A);for(var e=0;e<g.length;e++){g[e].rotation.y+=.01+(e-g.length)*1e-5;g[e].rotation.x+=.01+(e-g.length)*1e-5}if(M.usePostProcessing){y.reset();y.render(f,d);if(M.useFXAA)y.pass(_);if(M.useBlur)y.pass(x);if(M.useBloom)y.pass(b);y.toScreen()}else{p.render(f,d)}}},{"..":2,"../src/passes/bloom/MultiPassBloomPass":15,"../src/passes/box-blur/BoxBlurPass":16,"../src/passes/fxaa/FXAAPass":20,"../src/passes/zoom-blur/ZoomBlurPass":21,"dat-gui":4,domready:7,raf:8,three:10}],2:[function(e,t,r){"use strict";t.exports.Composer=e("./src/Composer");t.exports.CopyPass=e("./src/passes/copy/CopyPass");t.exports.BlendMode={Normal:1,Dissolve:2,Darken:3,Multiply:4,ColorBurn:5,LinearBurn:6,DarkerColor:7,Lighten:8,Screen:9,ColorDodge:10,LinearDodge:11,LighterColor:12,Overlay:13,SoftLight:14,HardLight:15,VividLight:16,LinearLight:17,PinLight:18,HardMix:19,Difference:20,Exclusion:21,Substract:22,Divide:23}},{"./src/Composer":11,"./src/passes/copy/CopyPass":19}],3:[function(e,t,r){var i=t.exports={};var n=[];var a=false;var o;var s=-1;function h(){a=false;if(o.length){n=o.concat(n)}else{s=-1}if(n.length){l()}}function l(){if(a){return}var e=setTimeout(h);a=true;var t=n.length;while(t){o=n;n=[];while(++s<t){o[s].run()}s=-1;t=n.length}o=null;a=false;clearTimeout(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}n.push(new u(e,t));if(!a){setTimeout(l,0)}};function u(e,t){this.fun=e;this.array=t}u.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function c(){}i.on=c;i.addListener=c;i.once=c;i.off=c;i.removeListener=c;i.removeAllListeners=c;i.emit=c;i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],4:[function(e,t,r){t.exports=e("./vendor/dat.gui");t.exports.color=e("./vendor/dat.color")},{"./vendor/dat.color":5,"./vendor/dat.gui":6}],5:[function(e,t,r){var i=t.exports=i||{};i.color=i.color||{};i.utils=i.utils||{};i.utils.common=function(){var e=Array.prototype.forEach;var t=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(!this.isUndefined(t[r]))e[r]=t[r]},this);return e},defaults:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(this.isUndefined(e[r]))e[r]=t[r]},this);return e},compose:function(){var e=t.call(arguments);return function(){var r=t.call(arguments);for(var i=e.length-1;i>=0;i--){r=[e[i].apply(this,r)]}return r[0]}},each:function(t,r,i){if(e&&t.forEach===e){t.forEach(r,i)}else if(t.length===t.length+0){for(var n=0,a=t.length;n<a;n++)if(n in t&&r.call(i,t[n],n)===this.BREAK)return}else{for(var n in t)if(r.call(i,t[n],n)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},toArray:function(e){if(e.toArray)return e.toArray();return t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===false||e===true},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}();i.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var r=t.hex.toString(16);while(r.length<6){r="0"+r}return"#"+r}else{return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}}(i.utils.common);i.Color=i.color.Color=function(e,t,r,i){var n=function(){this.__state=e.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};n.COMPONENTS=["r","g","b","h","s","v","hex","a"];i.extend(n.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(n.prototype,"r",2);a(n.prototype,"g",1);a(n.prototype,"b",0);o(n.prototype,"h");o(n.prototype,"s");o(n.prototype,"v");Object.defineProperty(n.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(n.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(e){this.__state.space="HEX";this.__state.hex=e}});function a(e,t,r){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="RGB"){return this.__state[t]}s(this,t,r);return this.__state[t]},set:function(e){if(this.__state.space!=="RGB"){s(this,t,r);this.__state.space="RGB"}this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="HSV")return this.__state[t];h(this);return this.__state[t]},set:function(e){if(this.__state.space!=="HSV"){h(this);this.__state.space="HSV"}this.__state[t]=e}})}function s(e,r,n){if(e.__state.space==="HEX"){e.__state[r]=t.component_from_hex(e.__state.hex,n)}else if(e.__state.space==="HSV"){i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}else{throw"Corrupted color state"}}function h(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:r.s,v:r.v});if(!i.isNaN(r.h)){e.__state.h=r.h}else if(i.isUndefined(e.__state.h)){e.__state.h=0}}return n}(i.color.interpret=function(e,t){var r,i;var n=function(){i=false;var e=arguments.length>1?t.toArray(arguments):arguments[0];t.each(a,function(n){if(n.litmus(e)){t.each(n.conversions,function(n,a){r=n.read(e);if(i===false&&r!==false){i=r;r.conversionName=a;r.conversion=n;return t.BREAK}});return t.BREAK}});return i};var a=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){if(e.length!=3)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){if(e.length!=4)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)){return{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)){return{space:"RGB",r:e.r,g:e.g,b:e.b}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)){return{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)){return{space:"HSV",h:e.h,s:e.s,v:e.v}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return n}(i.color.toString,i.utils.common),i.color.math=function(){var e;return{hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6;var n=e/60-Math.floor(e/60);var a=r*(1-t);var o=r*(1-n*t);var s=r*(1-(1-n)*t);var h=[[r,s,a],[o,r,a],[a,r,s],[a,o,r],[s,a,r],[r,a,o]][i];return{r:h[0]*255,g:h[1]*255,b:h[2]*255}},rgb_to_hsv:function(e,t,r){var i=Math.min(e,t,r),n=Math.max(e,t,r),a=n-i,o,s;if(n!=0){s=a/n}else{return{h:NaN,s:0,v:0}}if(e==n){o=(t-r)/a}else if(t==n){o=2+(r-e)/a}else{o=4+(e-t)/a}o/=6;if(o<0){o+=1}return{h:o*360,s:s,v:n/255}},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);i=this.hex_with_component(i,1,t);i=this.hex_with_component(i,0,r);return i},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,r,i){return i<<(e=r*8)|t&~(255<<e)}}}(),i.color.toString,i.utils.common)},{}],6:[function(e,t,r){var i=t.exports=i||{};i.gui=i.gui||{};i.utils=i.utils||{};i.controllers=i.controllers||{};i.dom=i.dom||{};i.color=i.color||{};i.utils.css=function(){return{load:function(e,t){t=t||document;var r=t.createElement("link");r.type="text/css";r.rel="stylesheet";r.href=e;t.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){t=t||document;var r=document.createElement("style");r.type="text/css";r.innerHTML=e;t.getElementsByTagName("head")[0].appendChild(r)}}}();i.utils.common=function(){var e=Array.prototype.forEach;var t=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(!this.isUndefined(t[r]))e[r]=t[r]},this);return e},defaults:function(e){this.each(t.call(arguments,1),function(t){for(var r in t)if(this.isUndefined(e[r]))e[r]=t[r]},this);return e},compose:function(){var e=t.call(arguments);return function(){var r=t.call(arguments);for(var i=e.length-1;i>=0;i--){r=[e[i].apply(this,r)]}return r[0]}},each:function(t,r,i){if(e&&t.forEach===e){t.forEach(r,i)}else if(t.length===t.length+0){for(var n=0,a=t.length;n<a;n++)if(n in t&&r.call(i,t[n],n)===this.BREAK)return}else{for(var n in t)if(r.call(i,t[n],n)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},toArray:function(e){if(e.toArray)return e.toArray();return t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===false||e===true},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}();i.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t];this.domElement=document.createElement("div");this.object=e;this.property=t;this.__onChange=undefined;this.__onFinishChange=undefined};e.extend(t.prototype,{onChange:function(e){this.__onChange=e;return this},onFinishChange:function(e){this.__onFinishChange=e;return this},setValue:function(e){this.object[this.property]=e;if(this.__onChange){this.__onChange.call(this,e)}this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return t}(i.utils.common);i.dom.dom=function(e){var t={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]};var r={};e.each(t,function(t,i){e.each(t,function(e){r[e]=i})});var i=/(\d+(\.\d+)?)px/;function n(t){if(t==="0"||e.isUndefined(t))return 0;var r=t.match(i);if(!e.isNull(r)){return parseFloat(r[1])}return 0}var a={makeSelectable:function(e,t){if(e===undefined||e.style===undefined)return;e.onselectstart=t?function(){return false}:function(){};e.style.MozUserSelect=t?"auto":"none";e.style.KhtmlUserSelect=t?"auto":"none";e.unselectable=t?"on":"off"},makeFullscreen:function(t,r,i){if(e.isUndefined(r))r=true;if(e.isUndefined(i))i=true;t.style.position="absolute";if(r){t.style.left=0;t.style.right=0}if(i){t.style.top=0;t.style.bottom=0}},fakeEvent:function(t,i,n,a){n=n||{};var o=r[i];if(!o){throw new Error("Event type "+i+" not supported.")}var s=document.createEvent(o);switch(o){case"MouseEvents":var h=n.x||n.clientX||0;var l=n.y||n.clientY||0;s.initMouseEvent(i,n.bubbles||false,n.cancelable||true,window,n.clickCount||1,0,0,h,l,false,false,false,false,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;e.defaults(n,{cancelable:true,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:undefined,charCode:undefined});u(i,n.bubbles||false,n.cancelable,window,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode);break;default:s.initEvent(i,n.bubbles||false,n.cancelable||true);break}e.defaults(s,a);t.dispatchEvent(s)},bind:function(e,t,r,i){i=i||false;if(e.addEventListener)e.addEventListener(t,r,i);else if(e.attachEvent)e.attachEvent("on"+t,r);return a},unbind:function(e,t,r,i){i=i||false;if(e.removeEventListener)e.removeEventListener(t,r,i);else if(e.detachEvent)e.detachEvent("on"+t,r);return a},addClass:function(e,t){if(e.className===undefined){e.className=t}else if(e.className!==t){var r=e.className.split(/ +/);if(r.indexOf(t)==-1){r.push(t);e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}}return a},removeClass:function(e,t){if(t){if(e.className===undefined){}else if(e.className===t){e.removeAttribute("class")}else{var r=e.className.split(/ +/);var i=r.indexOf(t);if(i!=-1){r.splice(i,1);e.className=r.join(" ")}}}else{e.className=undefined}return a},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||false},getWidth:function(e){var t=getComputedStyle(e);return n(t["border-left-width"])+n(t["border-right-width"])+n(t["padding-left"])+n(t["padding-right"])+n(t["width"])},getHeight:function(e){var t=getComputedStyle(e);return n(t["border-top-width"])+n(t["border-bottom-width"])+n(t["padding-top"])+n(t["padding-bottom"])+n(t["height"])},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent){do{t.left+=e.offsetLeft;t.top+=e.offsetTop}while(e=e.offsetParent)}return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return a}(i.utils.common);i.controllers.OptionController=function(e,t,r){var i=function(e,n,a){i.superclass.call(this,e,n);var o=this;this.__select=document.createElement("select");if(r.isArray(a)){var s={};r.each(a,function(e){s[e]=e});a=s}r.each(a,function(e,t){var r=document.createElement("option");r.innerHTML=t;r.setAttribute("value",e);o.__select.appendChild(r)});this.updateDisplay();t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)});this.domElement.appendChild(this.__select)};i.superclass=e;r.extend(i.prototype,e.prototype,{setValue:function(e){var t=i.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}return t},updateDisplay:function(){this.__select.value=this.getValue();return i.superclass.prototype.updateDisplay.call(this)}});return i}(i.controllers.Controller,i.dom.dom,i.utils.common);i.controllers.NumberController=function(e,t){var r=function(e,n,a){r.superclass.call(this,e,n);a=a||{};this.__min=a.min;this.__max=a.max;this.__step=a.step;if(t.isUndefined(this.__step)){if(this.initialValue==0){this.__impliedStep=1}else{this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10}}else{this.__impliedStep=this.__step}this.__precision=i(this.__impliedStep)};r.superclass=e;t.extend(r.prototype,e.prototype,{setValue:function(e){if(this.__min!==undefined&&e<this.__min){e=this.__min}else if(this.__max!==undefined&&e>this.__max){e=this.__max}if(this.__step!==undefined&&e%this.__step!=0){e=Math.round(e/this.__step)*this.__step}return r.superclass.prototype.setValue.call(this,e)},min:function(e){this.__min=e;return this},max:function(e){this.__max=e;return this},step:function(e){this.__step=e;return this}});function i(e){e=e.toString();if(e.indexOf(".")>-1){return e.length-e.indexOf(".")-1}else{return 0}}return r}(i.controllers.Controller,i.utils.common);i.controllers.NumberControllerBox=function(e,t,r){var i=function(e,n,a){this.__truncationSuspended=false;i.superclass.call(this,e,n,a);var o=this;var s;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"change",h);t.bind(this.__input,"blur",l);t.bind(this.__input,"mousedown",u);t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){o.__truncationSuspended=true;this.blur();o.__truncationSuspended=false}});function h(){var e=parseFloat(o.__input.value);if(!r.isNaN(e))o.setValue(e)}function l(){h();if(o.__onFinishChange){o.__onFinishChange.call(o,o.getValue())}}function u(e){t.bind(window,"mousemove",c);t.bind(window,"mouseup",f);s=e.clientY}function c(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep);s=e.clientY}function f(){t.unbind(window,"mousemove",c);t.unbind(window,"mouseup",f)}this.updateDisplay();this.domElement.appendChild(this.__input)};i.superclass=e;r.extend(i.prototype,e.prototype,{updateDisplay:function(){this.__input.value=this.__truncationSuspended?this.getValue():n(this.getValue(),this.__precision);return i.superclass.prototype.updateDisplay.call(this)}});function n(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}return i}(i.controllers.NumberController,i.dom.dom,i.utils.common);i.controllers.NumberControllerSlider=function(e,t,r,i,n){var a=function(e,r,i,n,s){a.superclass.call(this,e,r,{min:i,max:n,step:s});var h=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");t.bind(this.__background,"mousedown",l);t.addClass(this.__background,"slider");t.addClass(this.__foreground,"slider-fg");function l(e){t.bind(window,"mousemove",u);t.bind(window,"mouseup",c);u(e)}function u(e){e.preventDefault();var r=t.getOffset(h.__background);var i=t.getWidth(h.__background);h.setValue(o(e.clientX,r.left,r.left+i,h.__min,h.__max));return false}function c(){t.unbind(window,"mousemove",u);t.unbind(window,"mouseup",c);if(h.__onFinishChange){h.__onFinishChange.call(h,h.getValue())}}this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};a.superclass=e;a.useDefaultStyles=function(){r.inject(n)};i.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=e*100+"%";return a.superclass.prototype.updateDisplay.call(this)}});function o(e,t,r,i,n){return i+(n-i)*((e-t)/(r-t))}return a}(i.controllers.NumberController,i.dom.dom,i.utils.css,i.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");i.controllers.FunctionController=function(e,t,r){var i=function(e,r,n){i.superclass.call(this,e,r);var a=this;this.__button=document.createElement("div");this.__button.innerHTML=n===undefined?"Fire":n;t.bind(this.__button,"click",function(e){e.preventDefault();a.fire();return false});t.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};i.superclass=e;r.extend(i.prototype,e.prototype,{fire:function(){if(this.__onChange){this.__onChange.call(this)}if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.getValue().call(this.object)}});return i}(i.controllers.Controller,i.dom.dom,i.utils.common);i.controllers.BooleanController=function(e,t,r){var i=function(e,r){i.superclass.call(this,e,r);var n=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");t.bind(this.__checkbox,"change",a,false);this.domElement.appendChild(this.__checkbox);this.updateDisplay();function a(){n.setValue(!n.__prev)}};i.superclass=e;r.extend(i.prototype,e.prototype,{setValue:function(e){var t=i.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.__prev=this.getValue();return t},updateDisplay:function(){if(this.getValue()===true){this.__checkbox.setAttribute("checked","checked");this.__checkbox.checked=true}else{this.__checkbox.checked=false}return i.superclass.prototype.updateDisplay.call(this)}});return i}(i.controllers.Controller,i.dom.dom,i.utils.common);i.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var r=t.hex.toString(16);while(r.length<6){r="0"+r}return"#"+r}else{return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}}(i.utils.common);i.color.interpret=function(e,t){var r,i;var n=function(){i=false;var e=arguments.length>1?t.toArray(arguments):arguments[0];t.each(a,function(n){if(n.litmus(e)){t.each(n.conversions,function(n,a){r=n.read(e);if(i===false&&r!==false){i=r;r.conversionName=a;r.conversion=n;return t.BREAK}});return t.BREAK}});return i};var a=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){if(e.length!=3)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){if(e.length!=4)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)){return{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)){return{space:"RGB",r:e.r,g:e.g,b:e.b}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)){return{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)){return{space:"HSV",h:e.h,s:e.s,v:e.v}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return n}(i.color.toString,i.utils.common);i.GUI=i.gui.GUI=function(e,t,r,i,n,a,o,s,h,l,u,c,f,d,p){e.inject(r);var m="dg";var v=72;var g=20;var y="Default";var x=function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(e){return false}}();var _;var b=true;var w;var M=false;var S=[];var C=function(e){var t=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);d.addClass(this.domElement,m);this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];e=e||{};e=p.defaults(e,{autoPlace:true,width:C.DEFAULT_WIDTH});e=p.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace});if(!p.isUndefined(e.load)){if(e.preset)e.load.preset=e.preset}else{e.load={preset:y}}if(p.isUndefined(e.parent)&&e.hideable){S.push(this)}e.resizable=p.isUndefined(e.parent)&&e.resizable;if(e.autoPlace&&p.isUndefined(e.scrollable)){e.scrollable=true}var r=x&&localStorage.getItem(P(this,"isLocal"))==="true";Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){if(t.parent){return t.getRoot().preset}else{return e.load.preset}},set:function(r){if(t.parent){t.getRoot().preset=r}else{e.load.preset=r}k(this);t.revert()}},width:{get:function(){return e.width},set:function(r){e.width=r;B(t,r)}},name:{get:function(){return e.name},set:function(t){e.name=t;if(n){n.innerHTML=e.name}}},closed:{get:function(){return e.closed},set:function(r){e.closed=r;if(e.closed){d.addClass(t.__ul,C.CLASS_CLOSED)}else{d.removeClass(t.__ul,C.CLASS_CLOSED)}this.onResize();if(t.__closeButton){t.__closeButton.innerHTML=r?C.TEXT_OPEN:C.TEXT_CLOSED}}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return r},set:function(e){if(x){r=e;if(e){d.bind(window,"unload",s)}else{d.unbind(window,"unload",s)}localStorage.setItem(P(t,"isLocal"),e)}}}});if(p.isUndefined(e.parent)){e.closed=false;d.addClass(this.domElement,C.CLASS_MAIN);d.makeSelectable(this.domElement,false);if(x){if(r){t.useLocalStorage=true;var i=localStorage.getItem(P(this,"gui"));if(i){e.load=JSON.parse(i)}}}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=C.TEXT_CLOSED;d.addClass(this.__closeButton,C.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);d.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{if(e.closed===undefined){e.closed=true}var n=document.createTextNode(e.name);d.addClass(n,"controller-name");var a=E(t,n);var o=function(e){e.preventDefault();t.closed=!t.closed;return false};d.addClass(this.__ul,C.CLASS_CLOSED);d.addClass(a,"title");d.bind(a,"click",o);if(!e.closed){this.closed=false}}if(e.autoPlace){if(p.isUndefined(e.parent)){if(b){w=document.createElement("div");d.addClass(w,m);d.addClass(w,C.CLASS_AUTO_PLACE_CONTAINER);document.body.appendChild(w);b=false}w.appendChild(this.domElement);d.addClass(this.domElement,C.CLASS_AUTO_PLACE)}if(!this.parent)B(t,e.width)}d.bind(window,"resize",function(){t.onResize()});d.bind(this.__ul,"webkitTransitionEnd",function(){t.onResize()});d.bind(this.__ul,"transitionend",function(){t.onResize()});d.bind(this.__ul,"oTransitionEnd",function(){t.onResize()});this.onResize();if(e.resizable){F(this)}function s(){localStorage.setItem(P(t,"gui"),JSON.stringify(t.getSaveObject()))}var h=t.getRoot();function l(){var e=t.getRoot();e.width+=1;p.defer(function(){e.width-=1})}if(!e.parent){l()}};C.toggleHide=function(){M=!M;p.each(S,function(e){e.domElement.style.zIndex=M?-999:999;e.domElement.style.opacity=M?0:1})};C.CLASS_AUTO_PLACE="a";C.CLASS_AUTO_PLACE_CONTAINER="ac";C.CLASS_MAIN="main";C.CLASS_CONTROLLER_ROW="cr";C.CLASS_TOO_TALL="taller-than-window";C.CLASS_CLOSED="closed";C.CLASS_CLOSE_BUTTON="close-button";C.CLASS_DRAG="drag";C.DEFAULT_WIDTH=245;C.TEXT_CLOSED="Close Controls";C.TEXT_OPEN="Open Controls";d.bind(window,"keydown",function(e){if(document.activeElement.type!=="text"&&(e.which===v||e.keyCode==v)){C.toggleHide()}},false);p.extend(C.prototype,{add:function(e,t){return T(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return T(this,e,t,{color:true})},remove:function(e){this.__ul.removeChild(e.__li);this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){if(this.autoPlace){w.removeChild(this.domElement)}},addFolder:function(e){if(this.__folders[e]!==undefined){throw new Error("You already have a folder in this GUI by the"+' name "'+e+'"')}var t={name:e,parent:this};t.autoPlace=this.autoPlace;if(this.load&&this.load.folders&&this.load.folders[e]){t.closed=this.load.folders[e].closed;t.load=this.load.folders[e]}var r=new C(t);this.__folders[e]=r;var i=E(this,r.domElement);d.addClass(i,"folder");return r},open:function(){this.closed=false},close:function(){this.closed=true},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=d.getOffset(e.__ul).top;var r=0;p.each(e.__ul.childNodes,function(t){if(!(e.autoPlace&&t===e.__save_row))r+=d.getHeight(t)});if(window.innerHeight-t-g<r){d.addClass(e.domElement,C.CLASS_TOO_TALL);e.__ul.style.height=window.innerHeight-t-g+"px"}else{d.removeClass(e.domElement,C.CLASS_TOO_TALL);e.__ul.style.height="auto"}}if(e.__resize_handle){p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})}if(e.__closeButton){e.__closeButton.style.width=e.width+"px"}},remember:function(){if(p.isUndefined(_)){_=new f;_.domElement.innerHTML=t}if(this.parent){throw new Error("You can only call remember on a top level GUI.")}var e=this;p.each(Array.prototype.slice.call(arguments),function(t){if(e.__rememberedObjects.length==0){R(e)}if(e.__rememberedObjects.indexOf(t)==-1){e.__rememberedObjects.push(t)}});if(this.autoPlace){B(this,this.width)}},getRoot:function(){var e=this;while(e.parent){e=e.parent}return e},getSaveObject:function(){var e=this.load;e.closed=this.closed;if(this.__rememberedObjects.length>0){e.preset=this.preset;if(!e.remembered){e.remembered={}}e.remembered[this.preset]=U(this)}e.folders={};p.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()});return e},save:function(){if(!this.load.remembered){this.load.remembered={}}this.load.remembered[this.preset]=U(this);V(this,false)},saveAs:function(e){if(!this.load.remembered){this.load.remembered={};this.load.remembered[y]=U(this,true)}this.load.remembered[e]=U(this);this.preset=e;

D(this,e,true)},revert:function(e){p.each(this.__controllers,function(t){if(!this.getRoot().load.remembered){t.setValue(t.initialValue)}else{L(e||this.getRoot(),t)}},this);p.each(this.__folders,function(e){e.revert(e)});if(!e){V(this.getRoot(),false)}},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e);if(t)N(this.__listening)}});function T(e,t,r,a){if(t[r]===undefined){throw new Error("Object "+t+' has no property "'+r+'"')}var o;if(a.color){o=new u(t,r)}else{var s=[t,r].concat(a.factoryArgs);o=i.apply(e,s)}if(a.before instanceof n){a.before=a.before.__li}L(e,o);d.addClass(o.domElement,"c");var h=document.createElement("span");d.addClass(h,"property-name");h.innerHTML=o.property;var l=document.createElement("div");l.appendChild(h);l.appendChild(o.domElement);var c=E(e,l,a.before);d.addClass(c,C.CLASS_CONTROLLER_ROW);d.addClass(c,typeof o.getValue());A(e,c,o);e.__controllers.push(o);return o}function E(e,t,r){var i=document.createElement("li");if(t)i.appendChild(t);if(r){e.__ul.insertBefore(i,params.before)}else{e.__ul.appendChild(i)}e.onResize();return i}function A(e,t,r){r.__li=t;r.__gui=e;p.extend(r,{options:function(t){if(arguments.length>1){r.remove();return T(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[p.toArray(arguments)]})}if(p.isArray(t)||p.isObject(t)){r.remove();return T(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[t]})}},name:function(e){r.__li.firstElementChild.firstElementChild.innerHTML=e;return r},listen:function(){r.__gui.listen(r);return r},remove:function(){r.__gui.remove(r);return r}});if(r instanceof h){var i=new s(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});p.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=r[e];var n=i[e];r[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);t.apply(r,e);return n.apply(i,e)}});d.addClass(t,"has-slider");r.domElement.insertBefore(i.domElement,r.domElement.firstElementChild)}else if(r instanceof s){var n=function(t){if(p.isNumber(r.__min)&&p.isNumber(r.__max)){r.remove();return T(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]})}return t};r.min=p.compose(n,r.min);r.max=p.compose(n,r.max)}else if(r instanceof a){d.bind(t,"click",function(){d.fakeEvent(r.__checkbox,"click")});d.bind(r.__checkbox,"click",function(e){e.stopPropagation()})}else if(r instanceof o){d.bind(t,"click",function(){d.fakeEvent(r.__button,"click")});d.bind(t,"mouseover",function(){d.addClass(r.__button,"hover")});d.bind(t,"mouseout",function(){d.removeClass(r.__button,"hover")})}else if(r instanceof u){d.addClass(t,"color");r.updateDisplay=p.compose(function(e){t.style.borderLeftColor=r.__color.toString();return e},r.updateDisplay);r.updateDisplay()}r.setValue=p.compose(function(t){if(e.getRoot().__preset_select&&r.isModified()){V(e.getRoot(),true)}return t},r.setValue)}function L(e,t){var r=e.getRoot();var i=r.__rememberedObjects.indexOf(t.object);if(i!=-1){var n=r.__rememberedObjectIndecesToControllers[i];if(n===undefined){n={};r.__rememberedObjectIndecesToControllers[i]=n}n[t.property]=t;if(r.load&&r.load.remembered){var a=r.load.remembered;var o;if(a[e.preset]){o=a[e.preset]}else if(a[y]){o=a[y]}else{return}if(o[i]&&o[i][t.property]!==undefined){var s=o[i][t.property];t.initialValue=s;t.setValue(s)}}}}function P(e,t){return document.location.href+"."+t}function R(e){var t=e.__save_row=document.createElement("li");d.addClass(e.domElement,"has-save");e.__ul.insertBefore(t,e.__ul.firstChild);d.addClass(t,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;";d.addClass(r,"button gears");var i=document.createElement("span");i.innerHTML="Save";d.addClass(i,"button");d.addClass(i,"save");var n=document.createElement("span");n.innerHTML="New";d.addClass(n,"button");d.addClass(n,"save-as");var a=document.createElement("span");a.innerHTML="Revert";d.addClass(a,"button");d.addClass(a,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered){p.each(e.load.remembered,function(t,r){D(e,r,r==e.preset)})}else{D(e,y,false)}d.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++){e.__preset_select[t].innerHTML=e.__preset_select[t].value}e.preset=this.value});t.appendChild(o);t.appendChild(r);t.appendChild(i);t.appendChild(n);t.appendChild(a);if(x){var s=document.getElementById("dg-save-locally");var h=document.getElementById("dg-local-explain");s.style.display="block";var l=document.getElementById("dg-local-storage");if(localStorage.getItem(P(e,"isLocal"))==="true"){l.setAttribute("checked","checked")}function u(){h.style.display=e.useLocalStorage?"block":"none"}u();d.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage;u()})}var c=document.getElementById("dg-new-constructor");d.bind(c,"keydown",function(e){if(e.metaKey&&(e.which===67||e.keyCode==67)){_.hide()}});d.bind(r,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),undefined,2);_.show();c.focus();c.select()});d.bind(i,"click",function(){e.save()});d.bind(n,"click",function(){var t=prompt("Enter a new preset name.");if(t)e.saveAs(t)});d.bind(a,"click",function(){e.revert()})}function F(e){e.__resize_handle=document.createElement("div");p.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var t;d.bind(e.__resize_handle,"mousedown",r);d.bind(e.__closeButton,"mousedown",r);e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild);function r(r){r.preventDefault();t=r.clientX;d.addClass(e.__closeButton,C.CLASS_DRAG);d.bind(window,"mousemove",i);d.bind(window,"mouseup",n);return false}function i(r){r.preventDefault();e.width+=t-r.clientX;e.onResize();t=r.clientX;return false}function n(){d.removeClass(e.__closeButton,C.CLASS_DRAG);d.unbind(window,"mousemove",i);d.unbind(window,"mouseup",n)}}function B(e,t){e.domElement.style.width=t+"px";if(e.__save_row&&e.autoPlace){e.__save_row.style.width=t+"px"}if(e.__closeButton){e.__closeButton.style.width=t+"px"}}function U(e,t){var r={};p.each(e.__rememberedObjects,function(i,n){var a={};var o=e.__rememberedObjectIndecesToControllers[n];p.each(o,function(e,r){a[r]=t?e.initialValue:e.getValue()});r[n]=a});return r}function D(e,t,r){var i=document.createElement("option");i.innerHTML=t;i.value=t;e.__preset_select.appendChild(i);if(r){e.__preset_select.selectedIndex=e.__preset_select.length-1}}function k(e){for(var t=0;t<e.__preset_select.length;t++){if(e.__preset_select[t].value==e.preset){e.__preset_select.selectedIndex=t}}}function V(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];if(t){r.innerHTML=r.value+"*"}else{r.innerHTML=r.value}}function N(e){if(e.length!=0){c(function(){N(e)})}p.each(e,function(e){e.updateDisplay()})}return C}(i.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",i.controllers.factory=function(e,t,r,i,n,a,o){return function(s,h){var l=s[h];if(o.isArray(arguments[2])||o.isObject(arguments[2])){return new e(s,h,arguments[2])}if(o.isNumber(l)){if(o.isNumber(arguments[2])&&o.isNumber(arguments[3])){return new r(s,h,arguments[2],arguments[3])}else{return new t(s,h,{min:arguments[2],max:arguments[3]})}}if(o.isString(l)){return new i(s,h)}if(o.isFunction(l)){return new n(s,h,"")}if(o.isBoolean(l)){return new a(s,h)}}}(i.controllers.OptionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.StringController=function(e,t,r){var i=function(e,r){i.superclass.call(this,e,r);var n=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"keyup",a);t.bind(this.__input,"change",a);t.bind(this.__input,"blur",o);t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){this.blur()}});function a(){n.setValue(n.__input.value)}function o(){if(n.__onFinishChange){n.__onFinishChange.call(n,n.getValue())}}this.updateDisplay();this.domElement.appendChild(this.__input)};i.superclass=e;r.extend(i.prototype,e.prototype,{updateDisplay:function(){if(!t.isActive(this.__input)){this.__input.value=this.getValue()}return i.superclass.prototype.updateDisplay.call(this)}});return i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.FunctionController,i.controllers.BooleanController,i.utils.common),i.controllers.Controller,i.controllers.BooleanController,i.controllers.FunctionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.OptionController,i.controllers.ColorController=function(e,t,r,i,n){var a=function(e,o){a.superclass.call(this,e,o);this.__color=new r(this.getValue());this.__temp=new r(0);var l=this;this.domElement=document.createElement("div");t.makeSelectable(this.domElement,false);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){d.call(this)}});t.bind(this.__input,"blur",d);t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(l.__selector,"drag")})});var u=document.createElement("div");n.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});n.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});n.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});n.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});n.extend(u.style,{width:"100%",height:"100%",background:"none"});s(u,"top","rgba(0,0,0,0)","#000");n.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});h(this.__hue_field);n.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});t.bind(this.__saturation_field,"mousedown",c);t.bind(this.__field_knob,"mousedown",c);t.bind(this.__hue_field,"mousedown",function(e){v(e);t.bind(window,"mousemove",v);t.bind(window,"mouseup",p)});function c(e){m(e);t.bind(window,"mousemove",m);t.bind(window,"mouseup",f)}function f(){t.unbind(window,"mousemove",m);t.unbind(window,"mouseup",f)}function d(){var e=i(this.value);if(e!==false){l.__color.__state=e;l.setValue(l.__color.toOriginal())}else{this.value=l.__color.toString()}}function p(){t.unbind(window,"mousemove",v);t.unbind(window,"mouseup",p)}this.__saturation_field.appendChild(u);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay();function m(e){e.preventDefault();var r=t.getWidth(l.__saturation_field);var i=t.getOffset(l.__saturation_field);var n=(e.clientX-i.left+document.body.scrollLeft)/r;var a=1-(e.clientY-i.top+document.body.scrollTop)/r;if(a>1)a=1;else if(a<0)a=0;if(n>1)n=1;else if(n<0)n=0;l.__color.v=a;l.__color.s=n;l.setValue(l.__color.toOriginal());return false}function v(e){e.preventDefault();var r=t.getHeight(l.__hue_field);var i=t.getOffset(l.__hue_field);var n=1-(e.clientY-i.top+document.body.scrollTop)/r;if(n>1)n=1;else if(n<0)n=0;l.__color.h=n*360;l.setValue(l.__color.toOriginal());return false}};a.superclass=e;n.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=i(this.getValue());if(e!==false){var t=false;n.each(r.COMPONENTS,function(r){if(!n.isUndefined(e[r])&&!n.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r]){t=true;return{}}},this);if(t){n.extend(this.__color.__state,e)}}n.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var a=this.__color.v<.5||this.__color.s>.5?255:0;var o=255-a;n.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+a+","+a+","+a+")"});this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px";this.__temp.s=1;this.__temp.v=1;s(this.__saturation_field,"left","#fff",this.__temp.toString());n.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+a+","+a+","+a+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];function s(e,t,r,i){e.style.background="";n.each(o,function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+r+" 0%, "+i+" 100%); "})}function h(e){e.style.background="";e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}return a}(i.controllers.Controller,i.dom.dom,i.color.Color=function(e,t,r,i){var n=function(){this.__state=e.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};n.COMPONENTS=["r","g","b","h","s","v","hex","a"];i.extend(n.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(n.prototype,"r",2);a(n.prototype,"g",1);a(n.prototype,"b",0);o(n.prototype,"h");o(n.prototype,"s");o(n.prototype,"v");Object.defineProperty(n.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(n.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(e){this.__state.space="HEX";this.__state.hex=e}});function a(e,t,r){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="RGB"){return this.__state[t]}s(this,t,r);return this.__state[t]},set:function(e){if(this.__state.space!=="RGB"){s(this,t,r);this.__state.space="RGB"}this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="HSV")return this.__state[t];h(this);return this.__state[t]},set:function(e){if(this.__state.space!=="HSV"){h(this);this.__state.space="HSV"}this.__state[t]=e}})}function s(e,r,n){if(e.__state.space==="HEX"){e.__state[r]=t.component_from_hex(e.__state.hex,n)}else if(e.__state.space==="HSV"){i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}else{throw"Corrupted color state"}}function h(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:r.s,v:r.v});if(!i.isNaN(r.h)){e.__state.h=r.h}else if(i.isUndefined(e.__state.h)){e.__state.h=0}}return n}(i.color.interpret,i.color.math=function(){var e;return{hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6;var n=e/60-Math.floor(e/60);var a=r*(1-t);var o=r*(1-n*t);var s=r*(1-(1-n)*t);var h=[[r,s,a],[o,r,a],[a,r,s],[a,o,r],[s,a,r],[r,a,o]][i];return{r:h[0]*255,g:h[1]*255,b:h[2]*255}},rgb_to_hsv:function(e,t,r){var i=Math.min(e,t,r),n=Math.max(e,t,r),a=n-i,o,s;if(n!=0){s=a/n}else{return{h:NaN,s:0,v:0}}if(e==n){o=(t-r)/a}else if(t==n){o=2+(r-e)/a}else{o=4+(e-t)/a}o/=6;if(o<0){o+=1}return{h:o*360,s:s,v:n/255}},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);i=this.hex_with_component(i,1,t);i=this.hex_with_component(i,0,r);return i},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,r,i){return i<<(e=r*8)|t&~(255<<e)}}}(),i.color.toString,i.utils.common),i.color.interpret,i.utils.common),i.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),i.dom.CenteredDiv=function(e,t){var r=function(){this.backgroundElement=document.createElement("div");t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});e.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var r=this;e.bind(this.backgroundElement,"click",function(){r.hide()})};r.prototype.show=function(){var e=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();t.defer(function(){e.backgroundElement.style.opacity=1;e.domElement.style.opacity=1;e.domElement.style.webkitTransform="scale(1)"})};r.prototype.hide=function(){var t=this;var r=function(){t.domElement.style.display="none";t.backgroundElement.style.display="none";e.unbind(t.domElement,"webkitTransitionEnd",r);e.unbind(t.domElement,"transitionend",r);e.unbind(t.domElement,"oTransitionEnd",r)};e.bind(this.domElement,"webkitTransitionEnd",r);e.bind(this.domElement,"transitionend",r);e.bind(this.domElement,"oTransitionEnd",r);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};r.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"};function i(e){console.log(e)}return r}(i.dom.dom,i.utils.common),i.dom.dom,i.utils.common)},{}],7:[function(e,t,r){!function(e,r){if(typeof t!="undefined")t.exports=r();else if(typeof define=="function"&&typeof define.amd=="object")define(r);else this[e]=r()}("domready",function(){var e=[],t,r=document,i=r.documentElement.doScroll,n="DOMContentLoaded",a=(i?/^loaded|^c/:/^loaded|^i|^c/).test(r.readyState);if(!a)r.addEventListener(n,t=function(){r.removeEventListener(n,t);a=1;while(t=e.shift())t()});return function(t){a?setTimeout(t,0):e.push(t)}})},{}],8:[function(e,t,r){var i=e("performance-now"),n=typeof window==="undefined"?{}:window,a=["moz","webkit"],o="AnimationFrame",s=n["request"+o],h=n["cancel"+o]||n["cancelRequest"+o],l=true;for(var u=0;u<a.length&&!s;u++){s=n[a[u]+"Request"+o];h=n[a[u]+"Cancel"+o]||n[a[u]+"CancelRequest"+o]}if(!s||!h){l=false;var c=0,f=0,d=[],p=1e3/60;s=function(e){if(d.length===0){var t=i(),r=Math.max(0,p-(t-c));c=r+t;setTimeout(function(){var e=d.slice(0);d.length=0;for(var t=0;t<e.length;t++){if(!e[t].cancelled){try{e[t].callback(c)}catch(r){setTimeout(function(){throw r},0)}}}},Math.round(r))}d.push({handle:++f,callback:e,cancelled:false});return f};h=function(e){for(var t=0;t<d.length;t++){if(d[t].handle===e){d[t].cancelled=true}}}}t.exports=function(e){if(!l){return s.call(n,e)}return s.call(n,function(){try{e.apply(this,arguments)}catch(t){setTimeout(function(){throw t},0)}})};t.exports.cancel=function(){h.apply(n,arguments)}},{"performance-now":9}],9:[function(e,t,r){(function(e){(function(){var r,i,n;if(typeof performance!=="undefined"&&performance!==null&&performance.now){t.exports=function(){return performance.now()}}else if(typeof e!=="undefined"&&e!==null&&e.hrtime){t.exports=function(){return(r()-n)/1e6};i=e.hrtime;r=function(){var e;e=i();return e[0]*1e9+e[1]};n=r()}else if(Date.now){t.exports=function(){return Date.now()-n};n=Date.now()}else{t.exports=function(){return(new Date).getTime()-n};n=(new Date).getTime()}}).call(this)}).call(this,e("_process"))},{_process:3}],10:[function(e,t,r){var i=i||{};var n={REVISION:"71"};if(typeof t==="object"){t.exports=n}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:+e}}n.log=function(){console.log.apply(console,arguments)};n.warn=function(){console.warn.apply(console,arguments)};n.error=function(){console.error.apply(console,arguments)};n.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};n.CullFaceNone=0;n.CullFaceBack=1;n.CullFaceFront=2;n.CullFaceFrontBack=3;n.FrontFaceDirectionCW=0;n.FrontFaceDirectionCCW=1;n.BasicShadowMap=0;n.PCFShadowMap=1;n.PCFSoftShadowMap=2;n.FrontSide=0;n.BackSide=1;n.DoubleSide=2;n.NoShading=0;n.FlatShading=1;n.SmoothShading=2;n.NoColors=0;n.FaceColors=1;n.VertexColors=2;n.NoBlending=0;n.NormalBlending=1;n.AdditiveBlending=2;n.SubtractiveBlending=3;n.MultiplyBlending=4;n.CustomBlending=5;n.AddEquation=100;n.SubtractEquation=101;n.ReverseSubtractEquation=102;n.MinEquation=103;n.MaxEquation=104;n.ZeroFactor=200;n.OneFactor=201;n.SrcColorFactor=202;n.OneMinusSrcColorFactor=203;n.SrcAlphaFactor=204;n.OneMinusSrcAlphaFactor=205;n.DstAlphaFactor=206;n.OneMinusDstAlphaFactor=207;n.DstColorFactor=208;n.OneMinusDstColorFactor=209;n.SrcAlphaSaturateFactor=210;n.MultiplyOperation=0;n.MixOperation=1;n.AddOperation=2;n.UVMapping=300;n.CubeReflectionMapping=301;n.CubeRefractionMapping=302;n.EquirectangularReflectionMapping=303;n.EquirectangularRefractionMapping=304;n.SphericalReflectionMapping=305;n.RepeatWrapping=1e3;n.ClampToEdgeWrapping=1001;n.MirroredRepeatWrapping=1002;n.NearestFilter=1003;n.NearestMipMapNearestFilter=1004;n.NearestMipMapLinearFilter=1005;n.LinearFilter=1006;n.LinearMipMapNearestFilter=1007;n.LinearMipMapLinearFilter=1008;n.UnsignedByteType=1009;n.ByteType=1010;n.ShortType=1011;n.UnsignedShortType=1012;n.IntType=1013;n.UnsignedIntType=1014;n.FloatType=1015;n.HalfFloatType=1025;n.UnsignedShort4444Type=1016;n.UnsignedShort5551Type=1017;n.UnsignedShort565Type=1018;n.AlphaFormat=1019;n.RGBFormat=1020;n.RGBAFormat=1021;n.LuminanceFormat=1022;n.LuminanceAlphaFormat=1023;n.RGBEFormat=n.RGBAFormat;n.RGB_S3TC_DXT1_Format=2001;n.RGBA_S3TC_DXT1_Format=2002;n.RGBA_S3TC_DXT3_Format=2003;n.RGBA_S3TC_DXT5_Format=2004;n.RGB_PVRTC_4BPPV1_Format=2100;n.RGB_PVRTC_2BPPV1_Format=2101;n.RGBA_PVRTC_4BPPV1_Format=2102;n.RGBA_PVRTC_2BPPV1_Format=2103;n.Projector=function(){n.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){n.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){n.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(e,t){n.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};n.CanvasRenderer=function(){n.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};n.Color=function(e){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(e)};n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,set:function(e){if(e instanceof n.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,r){this.r=e;this.g=t;this.b=r;return this},setHSL:function(e,t,r){if(t===0){this.r=this.g=this.b=r}else{var i=function(e,t,r){if(r<0)r+=1;if(r>1)r-=1;if(r<1/6)return e+(t-e)*6*r;if(r<1/2)return t;if(r<2/3)return e+(t-e)*6*(2/3-r);return e};var n=r<=.5?r*(1+t):r+t-r*t;var a=2*r-n;this.r=i(a,n,e+1/3);this.g=i(a,n,e);this.b=i(a,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);this.r=Math.min(255,parseInt(t[1],10))/255;this.g=Math.min(255,parseInt(t[2],10))/255;this.b=Math.min(255,parseInt(t[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);this.r=Math.min(100,parseInt(t[1],10))/100;this.g=Math.min(100,parseInt(t[2],10))/100;this.b=Math.min(100,parseInt(t[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);this.setHex(parseInt(t[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16));return this}if(/^(\w+)$/i.test(e)){this.setHex(n.ColorKeywords[e]);return this}},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e,t){if(t===undefined)t=2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},copyLinearToGamma:function(e,t){if(t===undefined)t=2;var r=t>0?1/t:1;this.r=Math.pow(e.r,r);this.g=Math.pow(e.g,r);this.b=Math.pow(e.b,r);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;this.r=e*e;this.g=t*t;this.b=r*r;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);
this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var r=this.r,i=this.g,n=this.b;var a=Math.max(r,i,n);var o=Math.min(r,i,n);var s,h;var l=(o+a)/2;if(o===a){s=0;h=0}else{var u=a-o;h=l<=.5?u/(a+o):u/(2-a-o);switch(a){case r:s=(i-n)/u+(i<n?6:0);break;case i:s=(n-r)/u+2;break;case n:s=(r-i)/u+4;break}s/=6}t.h=s;t.s=h;t.l=l;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();i.h+=e;i.s+=t;i.l+=r;this.setHSL(i.h,i.s,i.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){this.r=e[0];this.g=e[1];this.b=e[2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e},clone:function(){return(new n.Color).setRGB(this.r,this.g,this.b)}};n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};n.Quaternion=function(e,t,r,i){this._x=e||0;this._y=t||0;this._z=r||0;this._w=i!==undefined?i:1};n.Quaternion.prototype={constructor:n.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e;this.onChangeCallback()},set:function(e,t,r,i){this._x=e;this._y=t;this._z=r;this._w=i;this.onChangeCallback();return this},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(e instanceof n.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=Math.cos(e._x/2);var i=Math.cos(e._y/2);var a=Math.cos(e._z/2);var o=Math.sin(e._x/2);var s=Math.sin(e._y/2);var h=Math.sin(e._z/2);if(e.order==="XYZ"){this._x=o*i*a+r*s*h;this._y=r*s*a-o*i*h;this._z=r*i*h+o*s*a;this._w=r*i*a-o*s*h}else if(e.order==="YXZ"){this._x=o*i*a+r*s*h;this._y=r*s*a-o*i*h;this._z=r*i*h-o*s*a;this._w=r*i*a+o*s*h}else if(e.order==="ZXY"){this._x=o*i*a-r*s*h;this._y=r*s*a+o*i*h;this._z=r*i*h+o*s*a;this._w=r*i*a-o*s*h}else if(e.order==="ZYX"){this._x=o*i*a-r*s*h;this._y=r*s*a+o*i*h;this._z=r*i*h-o*s*a;this._w=r*i*a+o*s*h}else if(e.order==="YZX"){this._x=o*i*a+r*s*h;this._y=r*s*a+o*i*h;this._z=r*i*h-o*s*a;this._w=r*i*a-o*s*h}else if(e.order==="XZY"){this._x=o*i*a-r*s*h;this._y=r*s*a-o*i*h;this._z=r*i*h+o*s*a;this._w=r*i*a+o*s*h}if(t!==false)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);this._x=e.x*i;this._y=e.y*i;this._z=e.z*i;this._w=Math.cos(r);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],i=t[4],n=t[8],a=t[1],o=t[5],s=t[9],h=t[2],l=t[6],u=t[10],c=r+o+u,f;if(c>0){f=.5/Math.sqrt(c+1);this._w=.25/f;this._x=(l-s)*f;this._y=(n-h)*f;this._z=(a-i)*f}else if(r>o&&r>u){f=2*Math.sqrt(1+r-o-u);this._w=(l-s)/f;this._x=.25*f;this._y=(i+a)/f;this._z=(n+h)/f}else if(o>u){f=2*Math.sqrt(1+o-r-u);this._w=(n-h)/f;this._x=(i+a)/f;this._y=.25*f;this._z=(s+l)/f}else{f=2*Math.sqrt(1+u-r-o);this._w=(a-i)/f;this._x=(n+h)/f;this._y=(s+l)/f;this._z=.25*f}this.onChangeCallback();return this},setFromUnitVectors:function(){var e,t;var r=1e-6;return function(i,a){if(e===undefined)e=new n.Vector3;t=i.dot(a)+1;if(t<r){t=0;if(Math.abs(i.x)>Math.abs(i.z)){e.set(-i.y,i.x,0)}else{e.set(0,-i.z,i.y)}}else{e.crossVectors(i,a)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this.onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){n.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,a=e._w;var o=t._x,s=t._y,h=t._z,l=t._w;this._x=r*l+a*o+i*h-n*s;this._y=i*l+a*s+n*o-r*h;this._z=n*l+a*h+r*s-i*o;this._w=a*l-r*o-i*s-n*h;this.onChangeCallback();return this},multiplyVector3:function(e){n.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w;var o=a*e._w+r*e._x+i*e._y+n*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=a;this._x=r;this._y=i;this._z=n;return this}var s=Math.acos(o);var h=Math.sqrt(1-o*o);if(Math.abs(h)<.001){this._w=.5*(a+this._w);this._x=.5*(r+this._x);this._y=.5*(i+this._y);this._z=.5*(n+this._z);return this}var l=Math.sin((1-t)*s)/h,u=Math.sin(t*s)/h;this._w=a*l+this._w*u;this._x=r*l+this._x*u;this._y=i*l+this._y*u;this._z=n*l+this._z*u;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new n.Quaternion(this._x,this._y,this._z,this._w)}};n.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)};n.Vector2=function(e,t){this.x=e||0;this.y=t||0};n.Vector2.prototype={constructor:n.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){n.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},sub:function(e,t){if(t!==undefined){n.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subScalar:function(e){this.x-=e;this.y-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t}else{this.x=0;this.y=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},clampScalar:function(){var e,t;return function(r,i){if(e===undefined){e=new n.Vector2;t=new n.Vector2}e.set(r,r);t.set(i,i);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];return this},clone:function(){return new n.Vector2(this.x,this.y)}};n.Vector3=function(e,t,r){this.x=e||0;this.y=t||0;this.z=r||0};n.Vector3.prototype={constructor:n.Vector3,set:function(e,t,r){this.x=e;this.y=t;this.z=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){n.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},sub:function(e,t){if(t!==undefined){n.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){n.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function(t){if(t instanceof n.Euler===false){n.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(e===undefined)e=new n.Quaternion;this.applyQuaternion(e.setFromEuler(t));return this}}(),applyAxisAngle:function(){var e;return function(t,r){if(e===undefined)e=new n.Quaternion;this.applyQuaternion(e.setFromAxisAngle(t,r));return this}}(),applyMatrix3:function(e){var t=this.x;var r=this.y;var i=this.z;var n=e.elements;this.x=n[0]*t+n[3]*r+n[6]*i;this.y=n[1]*t+n[4]*r+n[7]*i;this.z=n[2]*t+n[5]*r+n[8]*i;return this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z;var n=e.elements;this.x=n[0]*t+n[4]*r+n[8]*i+n[12];this.y=n[1]*t+n[5]*r+n[9]*i+n[13];this.z=n[2]*t+n[6]*r+n[10]*i+n[14];return this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z;var n=e.elements;var a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a;this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a;this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a;return this},applyQuaternion:function(e){var t=this.x;var r=this.y;var i=this.z;var n=e.x;var a=e.y;var o=e.z;var s=e.w;var h=s*t+a*i-o*r;var l=s*r+o*t-n*i;var u=s*i+n*r-a*t;var c=-n*t-a*r-o*i;this.x=h*s+c*-n+l*-o-u*-a;this.y=l*s+c*-a+u*-n-h*-o;this.z=u*s+c*-o+h*-a-l*-n;return this},project:function(){var e;return function(t){if(e===undefined)e=new n.Matrix4;e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function(t){if(e===undefined)e=new n.Matrix4;e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z;var n=e.elements;this.x=n[0]*t+n[4]*r+n[8]*i;this.y=n[1]*t+n[5]*r+n[9]*i;this.z=n[2]*t+n[6]*r+n[10]*i;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},clampScalar:function(){var e,t;return function(r,i){if(e===undefined){e=new n.Vector3;t=new n.Vector3}e.set(r,r,r);t.set(i,i,i);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},cross:function(e,t){if(t!==undefined){n.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var r=this.x,i=this.y,a=this.z;this.x=i*e.z-a*e.y;this.y=a*e.x-r*e.z;this.z=r*e.y-i*e.x;return this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z;var a=t.x,o=t.y,s=t.z;this.x=i*s-n*o;this.y=n*a-r*s;this.z=r*o-i*a;return this},projectOnVector:function(){var e,t;return function(r){if(e===undefined)e=new n.Vector3;e.copy(r).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){if(e===undefined)e=new n.Vector3;e.copy(this).projectOnVector(t);return this.sub(e)}}(),reflect:function(){var e;return function(t){if(e===undefined)e=new n.Vector3;return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(n.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var r=this.y-e.y;var i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){n.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){n.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){n.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){n.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){n.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var r=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=r;this.z=i;return this},setFromMatrixColumn:function(e,t){var r=e*4;var i=t.elements;this.x=i[r];this.y=i[r+1];this.z=i[r+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];return this},clone:function(){return new n.Vector3(this.x,this.y,this.z)}};n.Vector4=function(e,t,r,i){this.x=e||0;this.y=t||0;this.z=r||0;this.w=i!==undefined?i:1};n.Vector4.prototype={constructor:n.Vector4,set:function(e,t,r,i){this.x=e;this.y=t;this.z=r;this.w=i;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){n.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},sub:function(e,t){if(t!==undefined){n.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var r=this.y;var i=this.z;var n=this.w;var a=e.elements;this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n;this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n;this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n;this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t;this.w*=t}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,a=.01,o=.1,s=e.elements,h=s[0],l=s[4],u=s[8],c=s[1],f=s[5],d=s[9],p=s[2],m=s[6],v=s[10];if(Math.abs(l-c)<a&&Math.abs(u-p)<a&&Math.abs(d-m)<a){if(Math.abs(l+c)<o&&Math.abs(u+p)<o&&Math.abs(d+m)<o&&Math.abs(h+f+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(h+1)/2;var y=(f+1)/2;var x=(v+1)/2;var _=(l+c)/4;var b=(u+p)/4;var w=(d+m)/4;if(g>y&&g>x){if(g<a){r=0;i=.707106781;n=.707106781}else{r=Math.sqrt(g);i=_/r;n=b/r}}else if(y>x){if(y<a){r=.707106781;i=0;n=.707106781}else{i=Math.sqrt(y);r=_/i;n=w/i}}else{if(x<a){r=.707106781;i=.707106781;n=0}else{n=Math.sqrt(x);r=b/n;i=w/n}}this.set(r,i,n,t);return this}var M=Math.sqrt((m-d)*(m-d)+(u-p)*(u-p)+(c-l)*(c-l));if(Math.abs(M)<.001)M=1;this.x=(m-d)/M;this.y=(u-p)/M;this.z=(c-l)/M;this.w=Math.acos((h+f+v-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},clampScalar:function(){var e,t;return function(r,i){if(e===undefined){e=new n.Vector4;t=new n.Vector4}e.set(r,r,r,r);t.set(i,i,i,i);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},lerpVectors:function(e,t,r){this.subVectors(t,e).multiplyScalar(r).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},fromAttribute:function(e,t,r){if(r===undefined)r=0;t=t*e.itemSize+r;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];this.w=e.array[t+3];return this},clone:function(){return new n.Vector4(this.x,this.y,this.z,this.w)}};n.Euler=function(e,t,r,i){this._x=e||0;this._y=t||0;this._z=r||0;this._order=i||n.Euler.DefaultOrder};n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];n.Euler.DefaultOrder="XYZ";n.Euler.prototype={constructor:n.Euler,_x:0,_y:0,_z:0,_order:n.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e;this.onChangeCallback()},set:function(e,t,r,i){this._x=e;this._y=t;this._z=r;this._order=i||this._order;this.onChangeCallback();return this},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t,r){var i=n.Math.clamp;var a=e.elements;var o=a[0],s=a[4],h=a[8];var l=a[1],u=a[5],c=a[9];var f=a[2],d=a[6],p=a[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(i(h,-1,1));if(Math.abs(h)<.99999){this._x=Math.atan2(-c,p);this._z=Math.atan2(-s,o)}else{this._x=Math.atan2(d,u);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-i(c,-1,1));if(Math.abs(c)<.99999){this._y=Math.atan2(h,p);this._z=Math.atan2(l,u)}else{this._y=Math.atan2(-f,o);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(i(d,-1,1));if(Math.abs(d)<.99999){this._y=Math.atan2(-f,p);this._z=Math.atan2(-s,u)}else{this._y=0;this._z=Math.atan2(l,o)}}else if(t==="ZYX"){this._y=Math.asin(-i(f,-1,1));if(Math.abs(f)<.99999){this._x=Math.atan2(d,p);this._z=Math.atan2(l,o)}else{this._x=0;this._z=Math.atan2(-s,u)}}else if(t==="YZX"){this._z=Math.asin(i(l,-1,1));if(Math.abs(l)<.99999){this._x=Math.atan2(-c,u);this._y=Math.atan2(-f,o)}else{this._x=0;this._y=Math.atan2(h,p)}}else if(t==="XZY"){this._z=Math.asin(-i(s,-1,1));if(Math.abs(s)<.99999){this._x=Math.atan2(d,u);this._y=Math.atan2(h,o)}else{this._x=Math.atan2(-c,p);this._y=0}}else{n.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t)}this._order=t;if(r!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var e;return function(t,r,i){if(e===undefined)e=new n.Matrix4;e.makeRotationFromQuaternion(t);this.setFromRotationMatrix(e,r,i);return this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new n.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e},toVector3:function(e){if(e){return e.set(this._x,this._y,this._z)}else{return new n.Vector3(this._x,this._y,this._z)}},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new n.Euler(this._x,this._y,this._z,this._order)}};n.Line3=function(e,t){this.start=e!==undefined?e:new n.Vector3;this.end=t!==undefined?t:new n.Vector3};n.Line3.prototype={constructor:n.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new n.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new n.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new n.Vector3;var t=new n.Vector3;return function(r,i){e.subVectors(r,this.start);t.subVectors(this.end,this.start);var a=t.dot(t);var o=t.dot(e);var s=o/a;if(i){s=n.Math.clamp(s,0,1)}return s}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);var a=r||new n.Vector3;return this.delta(a).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new n.Line3).copy(this)}};n.Box2=function(e,t){this.min=e!==undefined?e:new n.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new n.Vector2(-Infinity,-Infinity)};n.Box2.prototype={constructor:n.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new n.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(i);this.max.copy(t).add(i);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this;

},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new n.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var r=t||new n.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var r=t||new n.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.Box2).copy(this)}};n.Box3=function(e,t){this.min=e!==undefined?e:new n.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new n.Vector3(-Infinity,-Infinity,-Infinity)};n.Box3.prototype={constructor:n.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new n.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(i);this.max.copy(t).add(i);return this}}(),setFromObject:function(){var e=new n.Vector3;return function(t){var r=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){var i=t.geometry;if(i!==undefined){if(i instanceof n.Geometry){var a=i.vertices;for(var o=0,s=a.length;o<s;o++){e.copy(a[o]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}else if(i instanceof n.BufferGeometry&&i.attributes["position"]!==undefined){var h=i.attributes["position"].array;for(var o=0,s=h.length;o<s;o+=3){e.set(h[o],h[o+1],h[o+2]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}}});return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var r=t||new n.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var r=t||new n.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new n.Vector3;return function(t){var r=t||new n.Sphere;r.center=this.center();r.radius=this.size(e).length()*.5;return r}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.Box3).copy(this)}};n.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){n.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};n.Matrix3.prototype={constructor:n.Matrix3,set:function(e,t,r,i,n,a,o,s,h){var l=this.elements;l[0]=e;l[3]=t;l[6]=r;l[1]=i;l[4]=n;l[7]=a;l[2]=o;l[5]=s;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){n.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){n.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new n.Vector3;return function(t,r,i){if(r===undefined)r=0;if(i===undefined)i=t.length;for(var n=0,a=r;n<i;n+=3,a+=3){e.x=t[a];e.y=t[a+1];e.z=t[a+2];e.applyMatrix3(this);t[a]=e.x;t[a+1]=e.y;t[a+2]=e.z}return t}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],h=e[7],l=e[8];return t*a*l-t*o*h-r*n*l+r*o*s+i*n*h-i*a*s},getInverse:function(e,t){var r=e.elements;var i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9];i[1]=-r[10]*r[1]+r[2]*r[9];i[2]=r[6]*r[1]-r[2]*r[5];i[3]=-r[10]*r[4]+r[6]*r[8];i[4]=r[10]*r[0]-r[2]*r[8];i[5]=-r[6]*r[0]+r[2]*r[4];i[6]=r[9]*r[4]-r[5]*r[8];i[7]=-r[9]*r[0]+r[1]*r[8];i[8]=r[5]*r[0]-r[1]*r[4];var a=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(a===0){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(o)}else{n.warn(o)}this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];return e},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new n.Matrix3).fromArray(this.elements)}};n.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){n.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};n.Matrix4.prototype={constructor:n.Matrix4,set:function(e,t,r,i,n,a,o,s,h,l,u,c,f,d,p,m){var v=this.elements;v[0]=e;v[4]=t;v[8]=r;v[12]=i;v[1]=n;v[5]=a;v[9]=o;v[13]=s;v[2]=h;v[6]=l;v[10]=u;v[14]=c;v[3]=f;v[7]=d;v[11]=p;v[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){n.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var r=e.elements;t[12]=r[12];t[13]=r[13];t[14]=r[14];return this},extractBasis:function(e,t,r){var i=this.elements;e.set(i[0],i[1],i[2]);t.set(i[4],i[5],i[6]);r.set(i[8],i[9],i[10]);return this},makeBasis:function(e,t,r){this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1);return this},extractRotation:function(){var e=new n.Vector3;return function(t){var r=this.elements;var i=t.elements;var n=1/e.set(i[0],i[1],i[2]).length();var a=1/e.set(i[4],i[5],i[6]).length();var o=1/e.set(i[8],i[9],i[10]).length();r[0]=i[0]*n;r[1]=i[1]*n;r[2]=i[2]*n;r[4]=i[4]*a;r[5]=i[5]*a;r[6]=i[6]*a;r[8]=i[8]*o;r[9]=i[9]*o;r[10]=i[10]*o;return this}}(),makeRotationFromEuler:function(e){if(e instanceof n.Euler===false){n.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var r=e.x,i=e.y,a=e.z;var o=Math.cos(r),s=Math.sin(r);var h=Math.cos(i),l=Math.sin(i);var u=Math.cos(a),c=Math.sin(a);if(e.order==="XYZ"){var f=o*u,d=o*c,p=s*u,m=s*c;t[0]=h*u;t[4]=-h*c;t[8]=l;t[1]=d+p*l;t[5]=f-m*l;t[9]=-s*h;t[2]=m-f*l;t[6]=p+d*l;t[10]=o*h}else if(e.order==="YXZ"){var v=h*u,g=h*c,y=l*u,x=l*c;t[0]=v+x*s;t[4]=y*s-g;t[8]=o*l;t[1]=o*c;t[5]=o*u;t[9]=-s;t[2]=g*s-y;t[6]=x+v*s;t[10]=o*h}else if(e.order==="ZXY"){var v=h*u,g=h*c,y=l*u,x=l*c;t[0]=v-x*s;t[4]=-o*c;t[8]=y+g*s;t[1]=g+y*s;t[5]=o*u;t[9]=x-v*s;t[2]=-o*l;t[6]=s;t[10]=o*h}else if(e.order==="ZYX"){var f=o*u,d=o*c,p=s*u,m=s*c;t[0]=h*u;t[4]=p*l-d;t[8]=f*l+m;t[1]=h*c;t[5]=m*l+f;t[9]=d*l-p;t[2]=-l;t[6]=s*h;t[10]=o*h}else if(e.order==="YZX"){var _=o*h,b=o*l,w=s*h,M=s*l;t[0]=h*u;t[4]=M-_*c;t[8]=w*c+b;t[1]=c;t[5]=o*u;t[9]=-s*u;t[2]=-l*u;t[6]=b*c+w;t[10]=_-M*c}else if(e.order==="XZY"){var _=o*h,b=o*l,w=s*h,M=s*l;t[0]=h*u;t[4]=-c;t[8]=l*u;t[1]=_*c+M;t[5]=o*u;t[9]=b*c-w;t[2]=w*c-b;t[6]=s*u;t[10]=M*c+_}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){n.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var r=e.x,i=e.y,n=e.z,a=e.w;var o=r+r,s=i+i,h=n+n;var l=r*o,u=r*s,c=r*h;var f=i*s,d=i*h,p=n*h;var m=a*o,v=a*s,g=a*h;t[0]=1-(f+p);t[4]=u-g;t[8]=c+v;t[1]=u+g;t[5]=1-(l+p);t[9]=d-m;t[2]=c-v;t[6]=d+m;t[10]=1-(l+f);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e=new n.Vector3;var t=new n.Vector3;var r=new n.Vector3;return function(i,n,a){var o=this.elements;r.subVectors(i,n).normalize();if(r.length()===0){r.z=1}e.crossVectors(a,r).normalize();if(e.length()===0){r.x+=1e-4;e.crossVectors(a,r).normalize()}t.crossVectors(r,e);o[0]=e.x;o[4]=t.x;o[8]=r.x;o[1]=e.y;o[5]=t.y;o[9]=r.y;o[2]=e.z;o[6]=t.z;o[10]=r.z;return this}}(),multiply:function(e,t){if(t!==undefined){n.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements;var i=t.elements;var n=this.elements;var a=r[0],o=r[4],s=r[8],h=r[12];var l=r[1],u=r[5],c=r[9],f=r[13];var d=r[2],p=r[6],m=r[10],v=r[14];var g=r[3],y=r[7],x=r[11],_=r[15];var b=i[0],w=i[4],M=i[8],S=i[12];var C=i[1],T=i[5],E=i[9],A=i[13];var L=i[2],P=i[6],R=i[10],F=i[14];var B=i[3],U=i[7],D=i[11],k=i[15];n[0]=a*b+o*C+s*L+h*B;n[4]=a*w+o*T+s*P+h*U;n[8]=a*M+o*E+s*R+h*D;n[12]=a*S+o*A+s*F+h*k;n[1]=l*b+u*C+c*L+f*B;n[5]=l*w+u*T+c*P+f*U;n[9]=l*M+u*E+c*R+f*D;n[13]=l*S+u*A+c*F+f*k;n[2]=d*b+p*C+m*L+v*B;n[6]=d*w+p*T+m*P+v*U;n[10]=d*M+p*E+m*R+v*D;n[14]=d*S+p*A+m*F+v*k;n[3]=g*b+y*C+x*L+_*B;n[7]=g*w+y*T+x*P+_*U;n[11]=g*M+y*E+x*R+_*D;n[15]=g*S+y*A+x*F+_*k;return this},multiplyToArray:function(e,t,r){var i=this.elements;this.multiplyMatrices(e,t);r[0]=i[0];r[1]=i[1];r[2]=i[2];r[3]=i[3];r[4]=i[4];r[5]=i[5];r[6]=i[6];r[7]=i[7];r[8]=i[8];r[9]=i[9];r[10]=i[10];r[11]=i[11];r[12]=i[12];r[13]=i[13];r[14]=i[14];r[15]=i[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){n.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){n.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){n.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new n.Vector3;return function(t,r,i){if(r===undefined)r=0;if(i===undefined)i=t.length;for(var n=0,a=r;n<i;n+=3,a+=3){e.x=t[a];e.y=t[a+1];e.z=t[a+2];e.applyMatrix4(this);t[a]=e.x;t[a+1]=e.y;t[a+2]=e.z}return t}}(),rotateAxis:function(e){n.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){n.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],r=e[4],i=e[8],n=e[12];var a=e[1],o=e[5],s=e[9],h=e[13];var l=e[2],u=e[6],c=e[10],f=e[14];var d=e[3],p=e[7],m=e[11],v=e[15];return d*(+n*s*u-i*h*u-n*o*c+r*h*c+i*o*f-r*s*f)+p*(+t*s*f-t*h*c+n*a*c-i*a*f+i*h*l-n*s*l)+m*(+t*h*u-t*o*f-n*a*u+r*a*f+n*o*l-r*h*l)+v*(-i*o*l-t*s*u+t*o*c+i*a*u-r*a*c+r*s*l)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];e[t+9]=r[9];e[t+10]=r[10];e[t+11]=r[11];e[t+12]=r[12];e[t+13]=r[13];e[t+14]=r[14];e[t+15]=r[15];return e},getPosition:function(){var e=new n.Vector3;return function(){n.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var r=this.elements;var i=e.elements;var a=i[0],o=i[4],s=i[8],h=i[12];var l=i[1],u=i[5],c=i[9],f=i[13];var d=i[2],p=i[6],m=i[10],v=i[14];var g=i[3],y=i[7],x=i[11],_=i[15];r[0]=c*v*y-f*m*y+f*p*x-u*v*x-c*p*_+u*m*_;r[4]=h*m*y-s*v*y-h*p*x+o*v*x+s*p*_-o*m*_;r[8]=s*f*y-h*c*y+h*u*x-o*f*x-s*u*_+o*c*_;r[12]=h*c*p-s*f*p-h*u*m+o*f*m+s*u*v-o*c*v;r[1]=f*m*g-c*v*g-f*d*x+l*v*x+c*d*_-l*m*_;r[5]=s*v*g-h*m*g+h*d*x-a*v*x-s*d*_+a*m*_;r[9]=h*c*g-s*f*g-h*l*x+a*f*x+s*l*_-a*c*_;r[13]=s*f*d-h*c*d+h*l*m-a*f*m-s*l*v+a*c*v;r[2]=u*v*g-f*p*g+f*d*y-l*v*y-u*d*_+l*p*_;r[6]=h*p*g-o*v*g-h*d*y+a*v*y+o*d*_-a*p*_;r[10]=o*f*g-h*u*g+h*l*y-a*f*y-o*l*_+a*u*_;r[14]=h*u*d-o*f*d-h*l*p+a*f*p+o*l*v-a*u*v;r[3]=c*p*g-u*m*g-c*d*y+l*m*y+u*d*x-l*p*x;r[7]=o*m*g-s*p*g+s*d*y-a*m*y-o*d*x+a*p*x;r[11]=s*u*g-o*c*g-s*l*y+a*c*y+o*l*x-a*u*x;r[15]=o*c*d-s*u*d+s*l*p-a*c*p-o*l*m+a*u*m;var b=a*r[0]+l*r[4]+d*r[8]+g*r[12];if(b==0){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(w)}else{n.warn(w)}this.identity();return this}this.multiplyScalar(1/b);return this},translate:function(e){n.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){n.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){n.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){n.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){n.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var r=e.x,i=e.y,n=e.z;t[0]*=r;t[4]*=i;t[8]*=n;t[1]*=r;t[5]*=i;t[9]*=n;t[2]*=r;t[6]*=i;t[10]*=n;t[3]*=r;t[7]*=i;t[11]*=n;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var r=Math.cos(t);var i=Math.sin(t);var n=1-r;var a=e.x,o=e.y,s=e.z;var h=n*a,l=n*o;this.set(h*a+r,h*o-i*s,h*s+i*o,0,h*o+i*s,l*o+r,l*s-i*a,0,h*s-i*o,l*s+i*a,n*s*s+r,0,0,0,0,1);return this},makeScale:function(e,t,r){this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1);return this},compose:function(e,t,r){this.makeRotationFromQuaternion(t);this.scale(r);this.setPosition(e);return this},decompose:function(){var e=new n.Vector3;var t=new n.Matrix4;return function(r,i,n){var a=this.elements;var o=e.set(a[0],a[1],a[2]).length();var s=e.set(a[4],a[5],a[6]).length();var h=e.set(a[8],a[9],a[10]).length();var l=this.determinant();if(l<0){o=-o}r.x=a[12];r.y=a[13];r.z=a[14];t.elements.set(this.elements);var u=1/o;var c=1/s;var f=1/h;t.elements[0]*=u;t.elements[1]*=u;t.elements[2]*=u;t.elements[4]*=c;t.elements[5]*=c;t.elements[6]*=c;t.elements[8]*=f;t.elements[9]*=f;t.elements[10]*=f;i.setFromRotationMatrix(t);n.x=o;n.y=s;n.z=h;return this}}(),makeFrustum:function(e,t,r,i,n,a){var o=this.elements;var s=2*n/(t-e);var h=2*n/(i-r);var l=(t+e)/(t-e);var u=(i+r)/(i-r);var c=-(a+n)/(a-n);var f=-2*a*n/(a-n);o[0]=s;o[4]=0;o[8]=l;o[12]=0;o[1]=0;o[5]=h;o[9]=u;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=f;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,r,i){var a=r*Math.tan(n.Math.degToRad(e*.5));var o=-a;var s=o*t;var h=a*t;return this.makeFrustum(s,h,o,a,r,i)},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements;var s=t-e;var h=r-i;var l=a-n;var u=(t+e)/s;var c=(r+i)/h;var f=(a+n)/l;o[0]=2/s;o[4]=0;o[8]=0;o[12]=-u;o[1]=0;o[5]=2/h;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/l;o[14]=-f;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new n.Matrix4).fromArray(this.elements)}};n.Ray=function(e,t){this.origin=e!==undefined?e:new n.Vector3;this.direction=t!==undefined?t:new n.Vector3};n.Ray.prototype={constructor:n.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var r=t||new n.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new n.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var r=t||new n.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);if(i<0){return r.copy(this.origin)}return r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);if(r<0){return this.origin.distanceTo(t)}e.copy(this.direction).multiplyScalar(r).add(this.origin);return e.distanceTo(t)}}(),distanceSqToSegment:function(){var e=new n.Vector3;var t=new n.Vector3;var r=new n.Vector3;return function(i,n,a,o){e.copy(i).add(n).multiplyScalar(.5);t.copy(n).sub(i).normalize();r.copy(this.origin).sub(e);var s=i.distanceTo(n)*.5;var h=-this.direction.dot(t);var l=r.dot(this.direction);var u=-r.dot(t);var c=r.lengthSq();var f=Math.abs(1-h*h);var d,p,m,v;if(f>0){d=h*u-l;p=h*l-u;v=s*f;if(d>=0){if(p>=-v){if(p<=v){var g=1/f;d*=g;p*=g;m=d*(d+h*p+2*l)+p*(h*d+p+2*u)+c}else{p=s;d=Math.max(0,-(h*p+l));m=-d*d+p*(p+2*u)+c}}else{p=-s;d=Math.max(0,-(h*p+l));m=-d*d+p*(p+2*u)+c}}else{if(p<=-v){d=Math.max(0,-(-h*s+l));p=d>0?-s:Math.min(Math.max(-s,-u),s);m=-d*d+p*(p+2*u)+c}else if(p<=v){d=0;p=Math.min(Math.max(-s,-u),s);m=p*(p+2*u)+c}else{d=Math.max(0,-(h*s+l));p=d>0?s:Math.min(Math.max(-s,-u),s);m=-d*d+p*(p+2*u)+c}}}else{p=h>0?-s:s;d=Math.max(0,-(h*p+l));m=-d*d+p*(p+2*u)+c}if(a){a.copy(this.direction).multiplyScalar(d).add(this.origin)}if(o){o.copy(t).multiplyScalar(p).add(e)}return m}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new n.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction);var n=e.dot(e)-i*i;var a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n);var s=i-o;var h=i+o;if(s<0&&h<0)return null;if(s<0)return this.at(h,r);return this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var r=e.normal.dot(this.direction);if(r*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0){if(e.distanceToPoint(this.origin)==0){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(r===null){return null}return this.at(r,t)},isIntersectionBox:function(){var e=new n.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var r,i,n,a,o,s;var h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z;var c=this.origin;if(h>=0){r=(e.min.x-c.x)*h;i=(e.max.x-c.x)*h}else{r=(e.max.x-c.x)*h;i=(e.min.x-c.x)*h}if(l>=0){n=(e.min.y-c.y)*l;a=(e.max.y-c.y)*l}else{n=(e.max.y-c.y)*l;a=(e.min.y-c.y)*l}if(r>a||n>i)return null;if(n>r||r!==r)r=n;if(a<i||i!==i)i=a;if(u>=0){o=(e.min.z-c.z)*u;s=(e.max.z-c.z)*u}else{o=(e.max.z-c.z)*u;s=(e.min.z-c.z)*u}if(r>s||o>i)return null;if(o>r||r!==r)r=o;if(s<i||i!==i)i=s;if(i<0)return null;return this.at(r>=0?r:i,t)},intersectTriangle:function(){var e=new n.Vector3;var t=new n.Vector3;var r=new n.Vector3;var i=new n.Vector3;return function(n,a,o,s,h){t.subVectors(a,n);r.subVectors(o,n);i.crossVectors(t,r);var l=this.direction.dot(i);var u;if(l>0){if(s)return null;u=1}else if(l<0){u=-1;l=-l}else{return null}e.subVectors(this.origin,n);var c=u*this.direction.dot(r.crossVectors(e,r));if(c<0){return null}var f=u*this.direction.dot(t.cross(e));if(f<0){return null}if(c+f>l){return null}var d=-u*e.dot(i);if(d<0){return null}return this.at(d/l,h)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new n.Ray).copy(this)}};n.Sphere=function(e,t){this.center=e!==undefined?e:new n.Vector3;this.radius=t!==undefined?t:0};n.Sphere.prototype={constructor:n.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new n.Box3;return function(t,r){var i=this.center;if(r!==undefined){i.copy(r)}else{e.setFromPoints(t).center(i)}var n=0;for(var a=0,o=t.length;a<o;a++){n=Math.max(n,i.distanceToSquared(t[a]))}this.radius=Math.sqrt(n);return this}}(),copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);var i=t||new n.Vector3;i.copy(e);if(r>this.radius*this.radius){i.sub(this.center).normalize();i.multiplyScalar(this.radius).add(this.center)}return i},getBoundingBox:function(e){var t=e||new n.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new n.Sphere).copy(this)}};n.Frustum=function(e,t,r,i,a,o){this.planes=[e!==undefined?e:new n.Plane,t!==undefined?t:new n.Plane,r!==undefined?r:new n.Plane,i!==undefined?i:new n.Plane,a!==undefined?a:new n.Plane,o!==undefined?o:new n.Plane]};n.Frustum.prototype={constructor:n.Frustum,set:function(e,t,r,i,n,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(r);o[3].copy(i);o[4].copy(n);o[5].copy(a);return this},copy:function(e){var t=this.planes;for(var r=0;r<6;r++){t[r].copy(e.planes[r])}return this},setFromMatrix:function(e){var t=this.planes;var r=e.elements;var i=r[0],n=r[1],a=r[2],o=r[3];var s=r[4],h=r[5],l=r[6],u=r[7];var c=r[8],f=r[9],d=r[10],p=r[11];var m=r[12],v=r[13],g=r[14],y=r[15];t[0].setComponents(o-i,u-s,p-c,y-m).normalize();t[1].setComponents(o+i,u+s,p+c,y+m).normalize();t[2].setComponents(o+n,u+h,p+f,y+v).normalize();t[3].setComponents(o-n,u-h,p-f,y-v).normalize();t[4].setComponents(o-a,u-l,p-d,y-g).normalize();t[5].setComponents(o+a,u+l,p+d,y+g).normalize();return this},intersectsObject:function(){var e=new n.Sphere;return function(t){var r=t.geometry;if(r.boundingSphere===null)r.computeBoundingSphere();e.copy(r.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var r=e.center;var i=-e.radius;for(var n=0;n<6;n++){var a=t[n].distanceToPoint(r);if(a<i){return false}}return true},intersectsBox:function(){var e=new n.Vector3,t=new n.Vector3;return function(r){var i=this.planes;for(var n=0;n<6;n++){var a=i[n];e.x=a.normal.x>0?r.min.x:r.max.x;t.x=a.normal.x>0?r.max.x:r.min.x;e.y=a.normal.y>0?r.min.y:r.max.y;t.y=a.normal.y>0?r.max.y:r.min.y;e.z=a.normal.z>0?r.min.z:r.max.z;t.z=a.normal.z>0?r.max.z:r.min.z;var o=a.distanceToPoint(e);var s=a.distanceToPoint(t);if(o<0&&s<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var r=0;r<6;r++){if(t[r].distanceToPoint(e)<0){return false}}return true},clone:function(){return(new n.Frustum).copy(this)}};n.Plane=function(e,t){this.normal=e!==undefined?e:new n.Vector3(1,0,0);this.constant=t!==undefined?t:0};n.Plane.prototype={constructor:n.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,r,i){this.normal.set(e,t,r);this.constant=i;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new n.Vector3;var t=new n.Vector3;return function(r,i,n){var a=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();this.setFromNormalAndCoplanarPoint(a,r);return this}}(),copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);var i=t||new n.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new n.Vector3;return function(t,r){var i=r||new n.Vector3;var a=t.delta(e);var o=this.normal.dot(a);if(o==0){if(this.distanceToPoint(t.start)==0){return i.copy(t.start)}return undefined}var s=-(t.start.dot(this.normal)+this.constant)/o;if(s<0||s>1){return undefined}return i.copy(a).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t=e||new n.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new n.Vector3;var t=new n.Vector3;var r=new n.Matrix3;return function(i,n){var a=n||r.getNormalMatrix(i);var o=e.copy(this.normal).applyMatrix3(a);var s=this.coplanarPoint(t);s.applyMatrix4(i);this.setFromNormalAndCoplanarPoint(o,s);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new n.Plane).copy(this)}};n.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var r=0,i;return function(){for(var n=0;n<36;n++){if(n==8||n==13||n==18||n==23){t[n]="-"}else if(n==14){t[n]="4"}else{if(r<=2)r=33554432+Math.random()*16777216|0;i=r&15;r=r>>4;t[n]=e[n==19?i&3|8:i]}}return t.join("")}}(),clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*(3-2*e)},smootherstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},nextPowerOfTwo:function(e){e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;e++;return e}};n.Spline=function(e){this.points=e;var t=[],r={x:0,y:0,z:0},i,a,o,s,h,l,u,c,f;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){i=(this.points.length-1)*e;a=Math.floor(i);o=i-a;t[0]=a===0?a:a-1;t[1]=a;t[2]=a>this.points.length-2?this.points.length-1:a+1;t[3]=a>this.points.length-3?this.points.length-1:a+2;l=this.points[t[0]];u=this.points[t[1]];c=this.points[t[2]];f=this.points[t[3]];s=o*o;h=o*s;r.x=d(l.x,u.x,c.x,f.x,o,s,h);r.y=d(l.y,u.y,c.y,f.y,o,s,h);r.z=d(l.z,u.z,c.z,f.z,o,s,h);return r};this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++){t=this.points[e];i[e]=[t.x,t.y,t.z]}return i};this.getLength=function(e){var t,r,i,a,o=0,s=0,h=0,l=new n.Vector3,u=new n.Vector3,c=[],f=0;c[0]=0;if(!e)e=100;i=this.points.length*e;l.copy(this.points[0]);for(t=1;t<i;t++){r=t/i;a=this.getPoint(r);u.copy(a);f+=u.distanceTo(l);l.copy(a);o=(this.points.length-1)*r;s=Math.floor(o);if(s!=h){
c[s]=f;h=s}}c[c.length]=f;return{chunks:c,total:f}};this.reparametrizeByArcLength=function(e){var t,r,i,a,o,s,h,l,u=[],c=new n.Vector3,f=this.getLength();u.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){s=f.chunks[t]-f.chunks[t-1];h=Math.ceil(e*s/f.total);a=(t-1)/(this.points.length-1);o=t/(this.points.length-1);for(r=1;r<h-1;r++){i=a+r*(1/h)*(o-a);l=this.getPoint(i);u.push(c.copy(l).clone())}u.push(c.copy(this.points[t]).clone())}this.points=u};function d(e,t,r,i,n,a,o){var s=(r-e)*.5,h=(i-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t}};n.Triangle=function(e,t,r){this.a=e!==undefined?e:new n.Vector3;this.b=t!==undefined?t:new n.Vector3;this.c=r!==undefined?r:new n.Vector3};n.Triangle.normal=function(){var e=new n.Vector3;return function(t,r,i,a){var o=a||new n.Vector3;o.subVectors(i,r);e.subVectors(t,r);o.cross(e);var s=o.lengthSq();if(s>0){return o.multiplyScalar(1/Math.sqrt(s))}return o.set(0,0,0)}}();n.Triangle.barycoordFromPoint=function(){var e=new n.Vector3;var t=new n.Vector3;var r=new n.Vector3;return function(i,a,o,s,h){e.subVectors(s,a);t.subVectors(o,a);r.subVectors(i,a);var l=e.dot(e);var u=e.dot(t);var c=e.dot(r);var f=t.dot(t);var d=t.dot(r);var p=l*f-u*u;var m=h||new n.Vector3;if(p==0){return m.set(-2,-1,-1)}var v=1/p;var g=(f*c-u*d)*v;var y=(l*d-u*c)*v;return m.set(1-g-y,y,g)}}();n.Triangle.containsPoint=function(){var e=new n.Vector3;return function(t,r,i,a){var o=n.Triangle.barycoordFromPoint(t,r,i,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}();n.Triangle.prototype={constructor:n.Triangle,set:function(e,t,r){this.a.copy(e);this.b.copy(t);this.c.copy(r);return this},setFromPointsAndIndices:function(e,t,r,i){this.a.copy(e[t]);this.b.copy(e[r]);this.c.copy(e[i]);return this},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new n.Vector3;var t=new n.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new n.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return n.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new n.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return n.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return n.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new n.Triangle).copy(this)}};n.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};n.Clock.prototype={constructor:n.Clock,start:function(){this.startTime=i.performance!==undefined&&i.performance.now!==undefined?i.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=i.performance!==undefined&&i.performance.now!==undefined?i.performance.now():Date.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};n.EventDispatcher=function(){};n.EventDispatcher.prototype={constructor:n.EventDispatcher,apply:function(e){e.addEventListener=n.EventDispatcher.prototype.addEventListener;e.hasEventListener=n.EventDispatcher.prototype.hasEventListener;e.removeEventListener=n.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=n.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var r=this._listeners;if(r[e]===undefined){r[e]=[]}if(r[e].indexOf(t)===-1){r[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var r=this._listeners;if(r[e]!==undefined&&r[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var r=this._listeners;var i=r[e];if(i!==undefined){var n=i.indexOf(t);if(n!==-1){i.splice(n,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var r=t[e.type];if(r!==undefined){e.target=this;var i=[];var n=r.length;for(var a=0;a<n;a++){i[a]=r[a]}for(var a=0;a<n;a++){i[a].call(this,e)}}}};(function(e){e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r);this.near=i||0;this.far=n||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance};var r=function(e,t,i,n){e.raycast(t,i);if(n===true){var a=e.children;for(var o=0,s=a.length;o<s;o++){r(a[o],t,i,true)}}};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){if(r instanceof e.PerspectiveCamera){this.ray.origin.copy(r.position);this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(r.position).normalize()}else if(r instanceof e.OrthographicCamera){this.ray.origin.set(t.x,t.y,-1).unproject(r);this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)}else{e.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(e,i){var n=[];r(e,this,n,i);n.sort(t);return n},intersectObjects:function(i,n){var a=[];if(i instanceof Array===false){e.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return a}for(var o=0,s=i.length;o<s;o++){r(i[o],this,a,n)}a.sort(t);return a}}})(n);n.Object3D=function(){Object.defineProperty(this,"id",{value:n.Object3DIdCount++});this.uuid=n.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=n.Object3D.DefaultUp.clone();var e=new n.Vector3;var t=new n.Euler;var r=new n.Quaternion;var i=new n.Vector3(1,1,1);var a=function(){r.setFromEuler(t,false)};var o=function(){t.setFromQuaternion(r,undefined,false)};t.onChange(a);r.onChange(o);Object.defineProperties(this,{position:{enumerable:true,value:e},rotation:{enumerable:true,value:t},quaternion:{enumerable:true,value:r},scale:{enumerable:true,value:i}});this.rotationAutoUpdate=true;this.matrix=new n.Matrix4;this.matrixWorld=new n.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};n.Object3D.DefaultUp=new n.Vector3(0,1,0);n.Object3D.prototype={constructor:n.Object3D,get eulerOrder(){n.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(e){n.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=e},get useQuaternion(){n.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){n.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new n.Quaternion;return function(t,r){e.setFromAxisAngle(t,r);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new n.Vector3;return function(t,r){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(r));return this}}(),translate:function(e,t){n.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},translateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new n.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){n.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e instanceof n.Object3D){if(e.parent!==undefined){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e)}else{n.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}}var r=this.children.indexOf(e);if(r!==-1){e.parent=undefined;e.dispatchEvent({type:"removed"});this.children.splice(r,1)}},getChildByName:function(e){n.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];var a=n.getObjectByProperty(e,t);if(a!==undefined){return a}}return undefined},getWorldPosition:function(e){var t=e||new n.Vector3;this.updateMatrixWorld(true);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new n.Vector3;var t=new n.Vector3;return function(r){var i=r||new n.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,i,t);return i}}(),getWorldRotation:function(){var e=new n.Quaternion;return function(t){var r=t||new n.Euler;this.getWorldQuaternion(e);return r.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new n.Vector3;var t=new n.Quaternion;return function(r){var i=r||new n.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,i);return i}}(),getWorldDirection:function(){var e=new n.Quaternion;return function(t){var r=t||new n.Vector3;this.getWorldQuaternion(e);return r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,r=this.children.length;t<r;t++){this.children[t].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);for(var t=0,r=this.children.length;t<r;t++){this.children[t].traverseVisible(e)}},traverseAncestors:function(e){if(this.parent){e(this.parent);this.parent.traverseAncestors(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,r=this.children.length;t<r;t++){this.children[t].updateMatrixWorld(e)}},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var t={};var r=function(r){if(e.geometries===undefined){e.geometries=[]}if(t[r.uuid]===undefined){var i=r.toJSON();delete i.metadata;t[r.uuid]=i;e.geometries.push(i)}return r.uuid};var i={};var a=function(t){if(e.materials===undefined){e.materials=[]}if(i[t.uuid]===undefined){var r=t.toJSON();delete r.metadata;i[t.uuid]=r;e.materials.push(r)}return t.uuid};var o=function(e){var t={};t.uuid=e.uuid;t.type=e.type;if(e.name!=="")t.name=e.name;if(JSON.stringify(e.userData)!=="{}")t.userData=e.userData;if(e.visible!==true)t.visible=e.visible;if(e instanceof n.PerspectiveCamera){t.fov=e.fov;t.aspect=e.aspect;t.near=e.near;t.far=e.far}else if(e instanceof n.OrthographicCamera){t.left=e.left;t.right=e.right;t.top=e.top;t.bottom=e.bottom;t.near=e.near;t.far=e.far}else if(e instanceof n.AmbientLight){t.color=e.color.getHex()}else if(e instanceof n.DirectionalLight){t.color=e.color.getHex();t.intensity=e.intensity}else if(e instanceof n.PointLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance;t.decay=e.decay}else if(e instanceof n.SpotLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance;t.angle=e.angle;t.exponent=e.exponent;t.decay=e.decay}else if(e instanceof n.HemisphereLight){t.color=e.color.getHex();t.groundColor=e.groundColor.getHex()}else if(e instanceof n.Mesh||e instanceof n.Line||e instanceof n.PointCloud){t.geometry=r(e.geometry);t.material=a(e.material);if(e instanceof n.Line)t.mode=e.mode}else if(e instanceof n.Sprite){t.material=a(e.material)}t.matrix=e.matrix.toArray();if(e.children.length>0){t.children=[];for(var i=0;i<e.children.length;i++){t.children.push(o(e.children[i]))}}return t};e.object=o(this);return e},clone:function(e,t){if(e===undefined)e=new n.Object3D;if(t===undefined)t=true;e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(t===true){for(var r=0;r<this.children.length;r++){var i=this.children[r];e.add(i.clone())}}return e}};n.EventDispatcher.prototype.apply(n.Object3D.prototype);n.Object3DIdCount=0;n.Face3=function(e,t,r,i,a,o){this.a=e;this.b=t;this.c=r;this.normal=i instanceof n.Vector3?i:new n.Vector3;this.vertexNormals=i instanceof Array?i:[];this.color=a instanceof n.Color?a:new n.Color;this.vertexColors=a instanceof Array?a:[];this.vertexTangents=[];this.materialIndex=o!==undefined?o:0};n.Face3.prototype={constructor:n.Face3,clone:function(){var e=new n.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.materialIndex=this.materialIndex;for(var t=0,r=this.vertexNormals.length;t<r;t++){e.vertexNormals[t]=this.vertexNormals[t].clone()}for(var t=0,r=this.vertexColors.length;t<r;t++){e.vertexColors[t]=this.vertexColors[t].clone()}for(var t=0,r=this.vertexTangents.length;t<r;t++){e.vertexTangents[t]=this.vertexTangents[t].clone()}return e}};n.Face4=function(e,t,r,i,a,o,s){n.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new n.Face3(e,t,r,a,o,s)};n.BufferAttribute=function(e,t){this.array=e;this.itemSize=t;this.needsUpdate=false};n.BufferAttribute.prototype={constructor:n.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,r){e*=this.itemSize;r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++){this.array[e+i]=t.array[r+i]}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},setX:function(e,t){this.array[e*this.itemSize]=t;return this},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},setXY:function(e,t,r){e*=this.itemSize;this.array[e]=t;this.array[e+1]=r;return this},setXYZ:function(e,t,r,i){e*=this.itemSize;this.array[e]=t;this.array[e+1]=r;this.array[e+2]=i;return this},setXYZW:function(e,t,r,i,n){e*=this.itemSize;this.array[e]=t;this.array[e+1]=r;this.array[e+2]=i;this.array[e+3]=n;return this},clone:function(){return new n.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};n.Int8Attribute=function(e,t){n.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Uint8Attribute=function(e,t){n.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Uint8ClampedAttribute=function(e,t){n.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Int16Attribute=function(e,t){n.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Uint16Attribute=function(e,t){n.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Int32Attribute=function(e,t){n.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Uint32Attribute=function(e,t){n.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Float32Attribute=function(e,t){n.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.Float64Attribute=function(e,t){n.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new n.BufferAttribute(e,t)};n.DynamicBufferAttribute=function(e,t){n.BufferAttribute.call(this,e,t);this.updateRange={offset:0,count:-1}};n.DynamicBufferAttribute.prototype=Object.create(n.BufferAttribute.prototype);n.DynamicBufferAttribute.prototype.constructor=n.DynamicBufferAttribute;n.DynamicBufferAttribute.prototype.clone=function(){return new n.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)};n.BufferGeometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++});this.uuid=n.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};n.BufferGeometry.prototype={constructor:n.BufferGeometry,addAttribute:function(e,t){if(t instanceof n.BufferAttribute===false){n.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[e]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[e]=t;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,r){this.drawcalls.push({start:e,count:t,index:r!==undefined?r:0})},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.applyToVector3Array(t.array);t.needsUpdate=true}var r=this.attributes.normal;if(r!==undefined){var i=(new n.Matrix3).getNormalMatrix(e);i.applyToVector3Array(r.array);r.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.applyMatrix((new n.Matrix4).setPosition(e));return e},fromGeometry:function(e,t){t=t||{vertexColors:n.NoColors};var r=e.vertices;var i=e.faces;var a=e.faceVertexUvs;var o=t.vertexColors;var s=a[0].length>0;var h=i[0].vertexNormals.length==3;var l=new Float32Array(i.length*3*3);this.addAttribute("position",new n.BufferAttribute(l,3));var u=new Float32Array(i.length*3*3);this.addAttribute("normal",new n.BufferAttribute(u,3));if(o!==n.NoColors){var c=new Float32Array(i.length*3*3);this.addAttribute("color",new n.BufferAttribute(c,3))}if(s===true){var f=new Float32Array(i.length*3*2);this.addAttribute("uv",new n.BufferAttribute(f,2))}for(var d=0,p=0,m=0;d<i.length;d++,p+=6,m+=9){var v=i[d];var g=r[v.a];var y=r[v.b];var x=r[v.c];l[m]=g.x;l[m+1]=g.y;l[m+2]=g.z;l[m+3]=y.x;l[m+4]=y.y;l[m+5]=y.z;l[m+6]=x.x;l[m+7]=x.y;l[m+8]=x.z;if(h===true){var _=v.vertexNormals[0];var b=v.vertexNormals[1];var w=v.vertexNormals[2];u[m]=_.x;u[m+1]=_.y;u[m+2]=_.z;u[m+3]=b.x;u[m+4]=b.y;u[m+5]=b.z;u[m+6]=w.x;u[m+7]=w.y;u[m+8]=w.z}else{var M=v.normal;u[m]=M.x;u[m+1]=M.y;u[m+2]=M.z;u[m+3]=M.x;u[m+4]=M.y;u[m+5]=M.z;u[m+6]=M.x;u[m+7]=M.y;u[m+8]=M.z}if(o===n.FaceColors){var S=v.color;c[m]=S.r;c[m+1]=S.g;c[m+2]=S.b;c[m+3]=S.r;c[m+4]=S.g;c[m+5]=S.b;c[m+6]=S.r;c[m+7]=S.g;c[m+8]=S.b}else if(o===n.VertexColors){var C=v.vertexColors[0];var T=v.vertexColors[1];var E=v.vertexColors[2];c[m]=C.r;c[m+1]=C.g;c[m+2]=C.b;c[m+3]=T.r;c[m+4]=T.g;c[m+5]=T.b;c[m+6]=E.r;c[m+7]=E.g;c[m+8]=E.b}if(s===true){var A=a[0][d][0];var L=a[0][d][1];var P=a[0][d][2];f[p]=A.x;f[p+1]=A.y;f[p+2]=L.x;f[p+3]=L.y;f[p+4]=P.x;f[p+5]=P.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var e=new n.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new n.Box3}var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var i=0,a=t.length;i<a;i+=3){e.set(t[i],t[i+1],t[i+2]);r.expandByPoint(e)}}if(t===undefined||t.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){n.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var e=new n.Box3;var t=new n.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new n.Sphere}var r=this.attributes.position.array;if(r){e.makeEmpty();var i=this.boundingSphere.center;for(var a=0,o=r.length;a<o;a+=3){t.set(r[a],r[a+1],r[a+2]);e.expandByPoint(t)}e.center(i);var s=0;for(var a=0,o=r.length;a<o;a+=3){t.set(r[a],r[a+1],r[a+2]);s=Math.max(s,i.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(s);if(isNaN(this.boundingSphere.radius)){n.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(e.normal===undefined){this.addAttribute("normal",new n.BufferAttribute(new Float32Array(t.length),3))}else{var r=e.normal.array;for(var i=0,a=r.length;i<a;i++){r[i]=0}}var r=e.normal.array;var o,s,h,l=new n.Vector3,u=new n.Vector3,c=new n.Vector3,f=new n.Vector3,d=new n.Vector3;if(e.index){var p=e.index.array;var m=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}];for(var v=0,g=m.length;v<g;++v){var y=m[v].start;var x=m[v].count;var _=m[v].index;for(var i=y,a=y+x;i<a;i+=3){o=(_+p[i])*3;s=(_+p[i+1])*3;h=(_+p[i+2])*3;l.fromArray(t,o);u.fromArray(t,s);c.fromArray(t,h);f.subVectors(c,u);d.subVectors(l,u);f.cross(d);r[o]+=f.x;r[o+1]+=f.y;r[o+2]+=f.z;r[s]+=f.x;r[s+1]+=f.y;r[s+2]+=f.z;r[h]+=f.x;r[h+1]+=f.y;r[h+2]+=f.z}}}else{for(var i=0,a=t.length;i<a;i+=9){l.fromArray(t,i);u.fromArray(t,i+3);c.fromArray(t,i+6);f.subVectors(c,u);d.subVectors(l,u);f.cross(d);r[i]=f.x;r[i+1]=f.y;r[i+2]=f.z;r[i+3]=f.x;r[i+4]=f.y;r[i+5]=f.z;r[i+6]=f.x;r[i+7]=f.y;r[i+8]=f.z}}this.normalizeNormals();e.normal.needsUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){n.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes.index.array;var t=this.attributes.position.array;var r=this.attributes.normal.array;var i=this.attributes.uv.array;var a=t.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new n.BufferAttribute(new Float32Array(4*a),4))}var o=this.attributes.tangent.array;var s=[],h=[];for(var l=0;l<a;l++){s[l]=new n.Vector3;h[l]=new n.Vector3}var u=new n.Vector3,c=new n.Vector3,f=new n.Vector3,d=new n.Vector2,p=new n.Vector2,m=new n.Vector2,v,g,y,x,_,b,w,M,S,C,T;var E=new n.Vector3,A=new n.Vector3;function L(e,r,n){u.fromArray(t,e*3);c.fromArray(t,r*3);f.fromArray(t,n*3);d.fromArray(i,e*2);p.fromArray(i,r*2);m.fromArray(i,n*2);v=c.x-u.x;g=f.x-u.x;y=c.y-u.y;x=f.y-u.y;_=c.z-u.z;b=f.z-u.z;w=p.x-d.x;M=m.x-d.x;S=p.y-d.y;C=m.y-d.y;T=1/(w*C-M*S);E.set((C*v-S*g)*T,(C*y-S*x)*T,(C*_-S*b)*T);A.set((w*g-M*v)*T,(w*x-M*y)*T,(w*b-M*_)*T);s[e].add(E);s[r].add(E);s[n].add(E);h[e].add(A);h[r].add(A);h[n].add(A)}var P,R;var F,B;var U,D,k;if(this.drawcalls.length===0){this.addDrawCall(0,e.length,0)}var V=this.drawcalls;for(F=0,B=V.length;F<B;++F){var N=V[F].start;var O=V[F].count;var z=V[F].index;for(P=N,R=N+O;P<R;P+=3){U=z+e[P];D=z+e[P+1];k=z+e[P+2];L(U,D,k)}}var I=new n.Vector3,G=new n.Vector3;var H=new n.Vector3,W=new n.Vector3;var j,X,q;function Y(e){H.fromArray(r,e*3);W.copy(H);X=s[e];I.copy(X);I.sub(H.multiplyScalar(H.dot(X))).normalize();G.crossVectors(W,X);q=G.dot(h[e]);j=q<0?-1:1;o[e*4]=I.x;o[e*4+1]=I.y;o[e*4+2]=I.z;o[e*4+3]=j}for(F=0,B=V.length;F<B;++F){var N=V[F].start;var O=V[F].count;var z=V[F].index;for(P=N,R=N+O;P<R;P+=3){U=z+e[P];D=z+e[P+1];k=z+e[P+2];Y(U);Y(D);Y(k)}}},computeOffsets:function(e){if(e===undefined)e=65535;var t=this.attributes.index.array;var r=this.attributes.position.array;var i=t.length/3;var n=new Uint16Array(t.length);var a=0;var o=0;var s=[{start:0,count:0,index:0}];var h=s[0];var l=0;var u=0;var c=new Int32Array(6);var f=new Int32Array(r.length);var d=new Int32Array(r.length);for(var p=0;p<r.length;p++){f[p]=-1;d[p]=-1}for(var m=0;m<i;m++){u=0;for(var v=0;v<3;v++){var g=t[m*3+v];if(f[g]==-1){c[v*2]=g;c[v*2+1]=-1;u++}else if(f[g]<h.index){c[v*2]=g;c[v*2+1]=-1;l++}else{c[v*2]=g;c[v*2+1]=f[g]}}var y=o+u;if(y>h.index+e){var x={start:a,count:0,index:o};s.push(x);h=x;for(var _=0;_<6;_+=2){var b=c[_+1];if(b>-1&&b<h.index)c[_+1]=-1}}for(var _=0;_<6;_+=2){var g=c[_];var b=c[_+1];if(b===-1)b=o++;f[g]=b;d[b]=g;n[a++]=b-h.index;h.count++}}this.reorderBuffers(n,d,o);this.offsets=s;this.drawcalls=s;return s},merge:function(e,t){if(e instanceof n.BufferGeometry===false){n.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===undefined)t=0;var r=this.attributes;for(var i in r){if(e.attributes[i]===undefined)continue;var a=r[i];var o=a.array;var s=e.attributes[i];var h=s.array;var l=s.itemSize;for(var u=0,c=l*t;u<h.length;u++,c++){o[c]=h[u]}}return this},normalizeNormals:function(){var e=this.attributes.normal.array;var t,r,i,n;for(var a=0,o=e.length;a<o;a+=3){t=e[a];r=e[a+1];i=e[a+2];n=1/Math.sqrt(t*t+r*r+i*i);e[a]*=n;e[a+1]*=n;e[a+2]*=n}},reorderBuffers:function(e,t,r){var i={};for(var n in this.attributes){if(n=="index")continue;var a=this.attributes[n].array;i[n]=new a.constructor(this.attributes[n].itemSize*r)}for(var o=0;o<r;o++){var s=t[o];for(var n in this.attributes){if(n=="index")continue;var h=this.attributes[n].array;var l=this.attributes[n].itemSize;var u=i[n];for(var c=0;c<l;c++)u[o*l+c]=h[s*l+c]}}this.attributes["index"].array=e;for(var n in this.attributes){if(n=="index")continue;this.attributes[n].array=i[n];this.attributes[n].numItems=this.attributes[n].itemSize*r}},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var t=this.attributes;var r=this.offsets;var i=this.boundingSphere;for(var n in t){var a=t[n];var o=Array.prototype.slice.call(a.array);e.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:o}}if(r.length>0){e.data.offsets=JSON.parse(JSON.stringify(r))}if(i!==null){e.data.boundingSphere={center:i.center.toArray(),radius:i.radius}}return e},clone:function(){var e=new n.BufferGeometry;for(var t in this.attributes){var r=this.attributes[t];e.addAttribute(t,r.clone())}for(var i=0,a=this.offsets.length;i<a;i++){var o=this.offsets[i];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};n.EventDispatcher.prototype.apply(n.BufferGeometry.prototype);n.Geometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++});this.uuid=n.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};n.Geometry.prototype={constructor:n.Geometry,applyMatrix:function(e){var t=(new n.Matrix3).getNormalMatrix(e);for(var r=0,i=this.vertices.length;r<i;r++){var a=this.vertices[r];a.applyMatrix4(e)}for(var r=0,i=this.faces.length;r<i;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var s=0,h=o.vertexNormals.length;s<h;s++){o.vertexNormals[s].applyMatrix3(t).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},fromBufferGeometry:function(e){var t=this;var r=e.attributes;var i=r.position.array;var a=r.index!==undefined?r.index.array:undefined;var o=r.normal!==undefined?r.normal.array:undefined;var s=r.color!==undefined?r.color.array:undefined;var h=r.uv!==undefined?r.uv.array:undefined;var l=[];var u=[];for(var c=0,f=0;c<i.length;c+=3,f+=2){t.vertices.push(new n.Vector3(i[c],i[c+1],i[c+2]));if(o!==undefined){l.push(new n.Vector3(o[c],o[c+1],o[c+2]))}if(s!==undefined){t.colors.push(new n.Color(s[c],s[c+1],s[c+2]))}if(h!==undefined){u.push(new n.Vector2(h[f],h[f+1]))}}var d=function(e,r,i){var a=o!==undefined?[l[e].clone(),l[r].clone(),l[i].clone()]:[];var c=s!==undefined?[t.colors[e].clone(),t.colors[r].clone(),t.colors[i].clone()]:[];t.faces.push(new n.Face3(e,r,i,a,c));if(h!==undefined){t.faceVertexUvs[0].push([u[e].clone(),u[r].clone(),u[i].clone()])}};if(a!==undefined){var p=e.drawcalls;if(p.length>0){for(var c=0;c<p.length;c++){var m=p[c];var v=m.start;var g=m.count;var y=m.index;for(var f=v,x=v+g;f<x;f+=3){d(y+a[f],y+a[f+1],y+a[f+2])}}}else{for(var c=0;c<a.length;c+=3){d(a[c],a[c+1],a[c+2])}}}else{for(var c=0;c<i.length/3;c+=3){d(c,c+1,c+2)}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.applyMatrix((new n.Matrix4).setPosition(e));return e},computeFaceNormals:function(){var e=new n.Vector3,t=new n.Vector3;for(var r=0,i=this.faces.length;r<i;r++){var a=this.faces[r];var o=this.vertices[a.a];var s=this.vertices[a.b];var h=this.vertices[a.c];e.subVectors(h,s);t.subVectors(o,s);e.cross(t);e.normalize();a.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,a,o,s;s=new Array(this.vertices.length);for(t=0,r=this.vertices.length;t<r;t++){s[t]=new n.Vector3}if(e){var h,l,u;var c=new n.Vector3,f=new n.Vector3;for(i=0,a=this.faces.length;i<a;i++){o=this.faces[i];h=this.vertices[o.a];l=this.vertices[o.b];u=this.vertices[o.c];c.subVectors(u,l);f.subVectors(h,l);c.cross(f);s[o.a].add(c);s[o.b].add(c);s[o.c].add(c)}}else{for(i=0,a=this.faces.length;i<a;i++){o=this.faces[i];s[o.a].add(o.normal);s[o.b].add(o.normal);s[o.c].add(o.normal)}}for(t=0,r=this.vertices.length;t<r;t++){s[t].normalize()}for(i=0,a=this.faces.length;i<a;i++){o=this.faces[i];o.vertexNormals[0]=s[o.a].clone();o.vertexNormals[1]=s[o.b].clone();

o.vertexNormals[2]=s[o.c].clone()}},computeMorphNormals:function(){var e,t,r,i,a;for(r=0,i=this.faces.length;r<i;r++){a=this.faces[r];if(!a.__originalFaceNormal){a.__originalFaceNormal=a.normal.clone()}else{a.__originalFaceNormal.copy(a.normal)}if(!a.__originalVertexNormals)a.__originalVertexNormals=[];for(e=0,t=a.vertexNormals.length;e<t;e++){if(!a.__originalVertexNormals[e]){a.__originalVertexNormals[e]=a.vertexNormals[e].clone()}else{a.__originalVertexNormals[e].copy(a.vertexNormals[e])}}}var o=new n.Geometry;o.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals;var h=this.morphNormals[e].vertexNormals;var l,u;for(r=0,i=this.faces.length;r<i;r++){l=new n.Vector3;u={a:new n.Vector3,b:new n.Vector3,c:new n.Vector3};s.push(l);h.push(u)}}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices;o.computeFaceNormals();o.computeVertexNormals();var l,u;for(r=0,i=this.faces.length;r<i;r++){a=this.faces[r];l=c.faceNormals[r];u=c.vertexNormals[r];l.copy(a.normal);u.a.copy(a.vertexNormals[0]);u.b.copy(a.vertexNormals[1]);u.c.copy(a.vertexNormals[2])}}for(r=0,i=this.faces.length;r<i;r++){a=this.faces[r];a.normal=a.__originalFaceNormal;a.vertexNormals=a.__originalVertexNormals}},computeTangents:function(){var e,t,r,i,a,o,s,h,l,u,c,f,d,p,m,v,g,y,x,_,b,w,M,S,C,T,E,A=[],L=[],P=new n.Vector3,R=new n.Vector3,F=new n.Vector3,B=new n.Vector3,U=new n.Vector3,D;for(r=0,i=this.vertices.length;r<i;r++){A[r]=new n.Vector3;L[r]=new n.Vector3}function k(e,t,r,i,n,a,o){l=e.vertices[t];u=e.vertices[r];c=e.vertices[i];f=h[n];d=h[a];p=h[o];m=u.x-l.x;v=c.x-l.x;g=u.y-l.y;y=c.y-l.y;x=u.z-l.z;_=c.z-l.z;b=d.x-f.x;w=p.x-f.x;M=d.y-f.y;S=p.y-f.y;C=1/(b*S-w*M);P.set((S*m-M*v)*C,(S*g-M*y)*C,(S*x-M*_)*C);R.set((b*v-w*m)*C,(b*y-w*g)*C,(b*_-w*x)*C);A[t].add(P);A[r].add(P);A[i].add(P);L[t].add(R);L[r].add(R);L[i].add(R)}for(e=0,t=this.faces.length;e<t;e++){s=this.faces[e];h=this.faceVertexUvs[0][e];k(this,s.a,s.b,s.c,0,1,2)}var V=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){s=this.faces[e];for(a=0;a<Math.min(s.vertexNormals.length,3);a++){U.copy(s.vertexNormals[a]);o=s[V[a]];T=A[o];F.copy(T);F.sub(U.multiplyScalar(U.dot(T))).normalize();B.crossVectors(s.vertexNormals[a],T);E=B.dot(L[o]);D=E<0?-1:1;s.vertexTangents[a]=new n.Vector4(F.x,F.y,F.z,D)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var t=this.vertices;for(var r=0,i=t.length;r<i;r++){if(r>0){e+=t[r].distanceTo(t[r-1])}this.lineDistances[r]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new n.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new n.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof n.Geometry===false){n.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var i,a=this.vertices.length,o=this.vertices,s=e.vertices,h=this.faces,l=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0];if(r===undefined)r=0;if(t!==undefined){i=(new n.Matrix3).getNormalMatrix(t)}for(var f=0,d=s.length;f<d;f++){var p=s[f];var m=p.clone();if(t!==undefined)m.applyMatrix4(t);o.push(m)}for(f=0,d=l.length;f<d;f++){var v=l[f],g,y,x,_=v.vertexNormals,b=v.vertexColors;g=new n.Face3(v.a+a,v.b+a,v.c+a);g.normal.copy(v.normal);if(i!==undefined){g.normal.applyMatrix3(i).normalize()}for(var w=0,M=_.length;w<M;w++){y=_[w].clone();if(i!==undefined){y.applyMatrix3(i).normalize()}g.vertexNormals.push(y)}g.color.copy(v.color);for(var w=0,M=b.length;w<M;w++){x=b[w];g.vertexColors.push(x.clone())}g.materialIndex=v.materialIndex+r;h.push(g)}for(f=0,d=c.length;f<d;f++){var S=c[f],C=[];if(S===undefined){continue}for(var w=0,M=S.length;w<M;w++){C.push(S[w].clone())}u.push(C)}},mergeMesh:function(e){if(e instanceof n.Mesh===false){n.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix();this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={};var t=[],r=[];var i,n;var a=4;var o=Math.pow(10,a);var s,h,l;var u,c,f;for(s=0,h=this.vertices.length;s<h;s++){i=this.vertices[s];n=Math.round(i.x*o)+"_"+Math.round(i.y*o)+"_"+Math.round(i.z*o);if(e[n]===undefined){e[n]=s;t.push(this.vertices[s]);r[s]=t.length-1}else{r[s]=r[e[n]]}}var d=[];for(s=0,h=this.faces.length;s<h;s++){l=this.faces[s];l.a=r[l.a];l.b=r[l.b];l.c=r[l.c];u=[l.a,l.b,l.c];var p=-1;for(var m=0;m<3;m++){if(u[m]==u[(m+1)%3]){p=m;d.push(s);break}}}for(s=d.length-1;s>=0;s--){var v=d[s];this.faces.splice(v,1);for(c=0,f=this.faceVertexUvs.length;c<f;c++){this.faceVertexUvs[c].splice(v,1)}}var g=this.vertices.length-t.length;this.vertices=t;return g},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var r in t){if(t[r]!==undefined)e[r]=t[r]}return e}var i=[];for(var n=0;n<this.vertices.length;n++){var a=this.vertices[n];i.push(a.x,a.y,a.z)}var o=[];var s=[];var h={};var l=[];var u={};var c=[];var f={};for(var n=0;n<this.faces.length;n++){var d=this.faces[n];var p=false;var m=false;var v=this.faceVertexUvs[0][n]!==undefined;var g=d.normal.length()>0;var y=d.vertexNormals.length>0;var x=d.color.r!==1||d.color.g!==1||d.color.b!==1;var _=d.vertexColors.length>0;var b=0;b=C(b,0,0);b=C(b,1,p);b=C(b,2,m);b=C(b,3,v);b=C(b,4,g);b=C(b,5,y);b=C(b,6,x);b=C(b,7,_);o.push(b);o.push(d.a,d.b,d.c);if(v){var w=this.faceVertexUvs[0][n];o.push(A(w[0]),A(w[1]),A(w[2]))}if(g){o.push(T(d.normal))}if(y){var M=d.vertexNormals;o.push(T(M[0]),T(M[1]),T(M[2]))}if(x){o.push(E(d.color))}if(_){var S=d.vertexColors;o.push(E(S[0]),E(S[1]),E(S[2]))}}function C(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(h[t]!==undefined){return h[t]}h[t]=s.length/3;s.push(e.x,e.y,e.z);return h[t]}function E(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(u[t]!==undefined){return u[t]}u[t]=l.length;l.push(e.getHex());return u[t]}function A(e){var t=e.x.toString()+e.y.toString();if(f[t]!==undefined){return f[t]}f[t]=c.length/2;c.push(e.x,e.y);return f[t]}e.data={};e.data.vertices=i;e.data.normals=s;if(l.length>0)e.data.colors=l;if(c.length>0)e.data.uvs=[c];e.data.faces=o;return e},clone:function(){var e=new n.Geometry;var t=this.vertices;for(var r=0,i=t.length;r<i;r++){e.vertices.push(t[r].clone())}var a=this.faces;for(var r=0,i=a.length;r<i;r++){e.faces.push(a[r].clone())}for(var r=0,i=this.faceVertexUvs.length;r<i;r++){var o=this.faceVertexUvs[r];if(e.faceVertexUvs[r]===undefined){e.faceVertexUvs[r]=[]}for(var s=0,h=o.length;s<h;s++){var l=o[s],u=[];for(var c=0,f=l.length;c<f;c++){var d=l[c];u.push(d.clone())}e.faceVertexUvs[r].push(u)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};n.EventDispatcher.prototype.apply(n.Geometry.prototype);n.GeometryIdCount=0;n.Camera=function(){n.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new n.Matrix4;this.projectionMatrix=new n.Matrix4};n.Camera.prototype=Object.create(n.Object3D.prototype);n.Camera.prototype.constructor=n.Camera;n.Camera.prototype.getWorldDirection=function(){var e=new n.Quaternion;return function(t){var r=t||new n.Vector3;this.getWorldQuaternion(e);return r.set(0,0,-1).applyQuaternion(e)}}();n.Camera.prototype.lookAt=function(){var e=new n.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();n.Camera.prototype.clone=function(e){if(e===undefined)e=new n.Camera;n.Object3D.prototype.clone.call(this,e);e.matrixWorldInverse.copy(this.matrixWorldInverse);e.projectionMatrix.copy(this.projectionMatrix);return e};n.CubeCamera=function(e,t,r){n.Object3D.call(this);this.type="CubeCamera";var i=90,a=1;var o=new n.PerspectiveCamera(i,a,e,t);o.up.set(0,-1,0);o.lookAt(new n.Vector3(1,0,0));this.add(o);var s=new n.PerspectiveCamera(i,a,e,t);s.up.set(0,-1,0);s.lookAt(new n.Vector3(-1,0,0));this.add(s);var h=new n.PerspectiveCamera(i,a,e,t);h.up.set(0,0,1);h.lookAt(new n.Vector3(0,1,0));this.add(h);var l=new n.PerspectiveCamera(i,a,e,t);l.up.set(0,0,-1);l.lookAt(new n.Vector3(0,-1,0));this.add(l);var u=new n.PerspectiveCamera(i,a,e,t);u.up.set(0,-1,0);u.lookAt(new n.Vector3(0,0,1));this.add(u);var c=new n.PerspectiveCamera(i,a,e,t);c.up.set(0,-1,0);c.lookAt(new n.Vector3(0,0,-1));this.add(c);this.renderTarget=new n.WebGLRenderTargetCube(r,r,{format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter});this.updateCubeMap=function(e,t){var r=this.renderTarget;var i=r.generateMipmaps;r.generateMipmaps=false;r.activeCubeFace=0;e.render(t,o,r);r.activeCubeFace=1;e.render(t,s,r);r.activeCubeFace=2;e.render(t,h,r);r.activeCubeFace=3;e.render(t,l,r);r.activeCubeFace=4;e.render(t,u,r);r.generateMipmaps=i;r.activeCubeFace=5;e.render(t,c,r)}};n.CubeCamera.prototype=Object.create(n.Object3D.prototype);n.CubeCamera.prototype.constructor=n.CubeCamera;n.OrthographicCamera=function(e,t,r,i,a,o){n.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=t;this.top=r;this.bottom=i;this.near=a!==undefined?a:.1;this.far=o!==undefined?o:2e3;this.updateProjectionMatrix()};n.OrthographicCamera.prototype=Object.create(n.Camera.prototype);n.OrthographicCamera.prototype.constructor=n.OrthographicCamera;n.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var r=(this.right+this.left)/2;var i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)};n.OrthographicCamera.prototype.clone=function(){var e=new n.OrthographicCamera;n.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.left=this.left;e.right=this.right;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};n.PerspectiveCamera=function(e,t,r,i){n.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=r!==undefined?r:.1;this.far=i!==undefined?i:2e3;this.updateProjectionMatrix()};n.PerspectiveCamera.prototype=Object.create(n.Camera.prototype);n.PerspectiveCamera.prototype.constructor=n.PerspectiveCamera;n.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*n.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};n.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,a){this.fullWidth=e;this.fullHeight=t;this.x=r;this.y=i;this.width=n;this.height=a;this.updateProjectionMatrix()};n.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=n.Math.radToDeg(2*Math.atan(Math.tan(n.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight;var r=Math.tan(n.Math.degToRad(e*.5))*this.near;var i=-r;var a=t*i;var o=t*r;var s=Math.abs(o-a);var h=Math.abs(r-i);this.projectionMatrix.makeFrustum(a+this.x*s/this.fullWidth,a+(this.x+this.width)*s/this.fullWidth,r-(this.y+this.height)*h/this.fullHeight,r-this.y*h/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)}};n.PerspectiveCamera.prototype.clone=function(){var e=new n.PerspectiveCamera;n.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};n.Light=function(e){n.Object3D.call(this);this.type="Light";this.color=new n.Color(e)};n.Light.prototype=Object.create(n.Object3D.prototype);n.Light.prototype.constructor=n.Light;n.Light.prototype.clone=function(e){if(e===undefined)e=new n.Light;n.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};n.AmbientLight=function(e){n.Light.call(this,e);this.type="AmbientLight"};n.AmbientLight.prototype=Object.create(n.Light.prototype);n.AmbientLight.prototype.constructor=n.AmbientLight;n.AmbientLight.prototype.clone=function(){var e=new n.AmbientLight;n.Light.prototype.clone.call(this,e);return e};n.AreaLight=function(e,t){n.Light.call(this,e);this.type="AreaLight";this.normal=new n.Vector3(0,-1,0);this.right=new n.Vector3(1,0,0);this.intensity=t!==undefined?t:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};n.AreaLight.prototype=Object.create(n.Light.prototype);n.AreaLight.prototype.constructor=n.AreaLight;n.DirectionalLight=function(e,t){n.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new n.Object3D;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new n.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};n.DirectionalLight.prototype=Object.create(n.Light.prototype);n.DirectionalLight.prototype.constructor=n.DirectionalLight;n.DirectionalLight.prototype.clone=function(){var e=new n.DirectionalLight;n.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraLeft=this.shadowCameraLeft;e.shadowCameraRight=this.shadowCameraRight;e.shadowCameraTop=this.shadowCameraTop;e.shadowCameraBottom=this.shadowCameraBottom;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;e.shadowCascade=this.shadowCascade;e.shadowCascadeOffset.copy(this.shadowCascadeOffset);e.shadowCascadeCount=this.shadowCascadeCount;e.shadowCascadeBias=this.shadowCascadeBias.slice(0);e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return e};n.HemisphereLight=function(e,t,r){n.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new n.Color(t);this.intensity=r!==undefined?r:1};n.HemisphereLight.prototype=Object.create(n.Light.prototype);n.HemisphereLight.prototype.constructor=n.HemisphereLight;n.HemisphereLight.prototype.clone=function(){var e=new n.HemisphereLight;n.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};n.PointLight=function(e,t,r,i){n.Light.call(this,e);this.type="PointLight";this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.decay=i!==undefined?i:1};n.PointLight.prototype=Object.create(n.Light.prototype);n.PointLight.prototype.constructor=n.PointLight;n.PointLight.prototype.clone=function(){var e=new n.PointLight;n.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;e.decay=this.decay;return e};n.SpotLight=function(e,t,r,i,a,o){n.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.target=new n.Object3D;this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.angle=i!==undefined?i:Math.PI/3;this.exponent=a!==undefined?a:10;this.decay=o!==undefined?o:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};n.SpotLight.prototype=Object.create(n.Light.prototype);n.SpotLight.prototype.constructor=n.SpotLight;n.SpotLight.prototype.clone=function(){var e=new n.SpotLight;n.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.decay=this.decay;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraFov=this.shadowCameraFov;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;return e};n.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};n.Loader=function(e){this.showStatus=e;this.statusDomElement=e?n.Loader.prototype.addStatusElement():null;this.imageLoader=new n.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};n.Loader.prototype={constructor:n.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(e){var t="Loaded ";if(e.total){t+=(100*e.loaded/e.total).toFixed(0)+"%"}else{t+=(e.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t){var r=[];for(var i=0;i<e.length;++i){r[i]=this.createMaterial(e[i],t)}return r},needsTangents:function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t];if(i instanceof n.ShaderMaterial)return true}return false},createMaterial:function(e,t){var r=this;function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function a(e,a,o,s,h,l,u){var c=t+o;var f;var d=n.Loader.Handlers.get(c);if(d!==null){f=d.load(c)}else{f=new n.Texture;d=r.imageLoader;d.crossOrigin=r.crossOrigin;d.load(c,function(e){if(n.Math.isPowerOfTwo(e.width)===false||n.Math.isPowerOfTwo(e.height)===false){var t=i(e.width);var r=i(e.height);var a=document.createElement("canvas");a.width=t;a.height=r;var o=a.getContext("2d");o.drawImage(e,0,0,t,r);f.image=a}else{f.image=e}f.needsUpdate=true})}f.sourceFile=o;if(s){f.repeat.set(s[0],s[1]);if(s[0]!==1)f.wrapS=n.RepeatWrapping;if(s[1]!==1)f.wrapT=n.RepeatWrapping}if(h){f.offset.set(h[0],h[1])}if(l){var p={repeat:n.RepeatWrapping,mirror:n.MirroredRepeatWrapping};if(p[l[0]]!==undefined)f.wrapS=p[l[0]];if(p[l[1]]!==undefined)f.wrapT=p[l[1]]}if(u){f.anisotropy=u}e[a]=f}function o(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var s="MeshLambertMaterial";var h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(e.shading){var l=e.shading.toLowerCase();if(l==="phong")s="MeshPhongMaterial";else if(l==="basic")s="MeshBasicMaterial"}if(e.blending!==undefined&&n[e.blending]!==undefined){h.blending=n[e.blending]}if(e.transparent!==undefined){h.transparent=e.transparent}if(e.opacity!==undefined&&e.opacity<1){h.transparent=true}if(e.depthTest!==undefined){h.depthTest=e.depthTest}if(e.depthWrite!==undefined){h.depthWrite=e.depthWrite}if(e.visible!==undefined){h.visible=e.visible}if(e.flipSided!==undefined){h.side=n.BackSide}if(e.doubleSided!==undefined){h.side=n.DoubleSide}if(e.wireframe!==undefined){h.wireframe=e.wireframe}if(e.vertexColors!==undefined){if(e.vertexColors==="face"){h.vertexColors=n.FaceColors}else if(e.vertexColors){h.vertexColors=n.VertexColors}}if(e.colorDiffuse){h.color=o(e.colorDiffuse)}else if(e.DbgColor){h.color=e.DbgColor}if(e.colorSpecular){h.specular=o(e.colorSpecular)}if(e.colorEmissive){h.emissive=o(e.colorEmissive)}if(e.transparency!==undefined){console.warn("THREE.Loader: transparency has been renamed to opacity");e.opacity=e.transparency}if(e.opacity!==undefined){h.opacity=e.opacity}if(e.specularCoef){h.shininess=e.specularCoef}if(e.mapDiffuse&&t){a(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy)}if(e.mapLight&&t){a(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy)}if(e.mapBump&&t){a(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy)}if(e.mapNormal&&t){a(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy)}if(e.mapSpecular&&t){a(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy)}if(e.mapAlpha&&t){a(h,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy)}if(e.mapBumpScale){h.bumpScale=e.mapBumpScale}if(e.mapNormalFactor){h.normalScale=new n.Vector2(e.mapNormalFactor,e.mapNormalFactor)}var u=new n[s](h);if(e.DbgName!==undefined)u.name=e.DbgName;return u}};n.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;t<r;t+=2){var i=this.handlers[t];var n=this.handlers[t+1];if(i.test(e)){return n}}return null}};n.XHRLoader=function(e){this.manager=e!==undefined?e:n.DefaultLoadingManager};n.XHRLoader.prototype={constructor:n.XHRLoader,load:function(e,t,r,i){var a=this;var o=n.Cache.get(e);if(o!==undefined){if(t)t(o);return}var s=new XMLHttpRequest;s.open("GET",e,true);s.addEventListener("load",function(r){n.Cache.add(e,this.response);if(t)t(this.response);a.manager.itemEnd(e)},false);if(r!==undefined){s.addEventListener("progress",function(e){r(e)},false)}if(i!==undefined){s.addEventListener("error",function(e){i(e)},false)}if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)s.responseType=this.responseType;s.send(null);a.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}};n.ImageLoader=function(e){this.manager=e!==undefined?e:n.DefaultLoadingManager};n.ImageLoader.prototype={constructor:n.ImageLoader,load:function(e,t,r,i){var a=this;var o=n.Cache.get(e);if(o!==undefined){t(o);return}var s=document.createElement("img");s.addEventListener("load",function(r){n.Cache.add(e,this);if(t)t(this);a.manager.itemEnd(e)},false);if(r!==undefined){s.addEventListener("progress",function(e){r(e)},false)}if(i!==undefined){s.addEventListener("error",function(e){i(e)},false)}if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;s.src=e;a.manager.itemStart(e);return s},setCrossOrigin:function(e){this.crossOrigin=e}};n.JSONLoader=function(e){n.Loader.call(this,e);this.withCredentials=false};n.JSONLoader.prototype=Object.create(n.Loader.prototype);n.JSONLoader.prototype.constructor=n.JSONLoader;n.JSONLoader.prototype.load=function(e,t,r){r=r&&typeof r==="string"?r:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,r)};n.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,a){var o=new XMLHttpRequest;var s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE){if(o.status===200||o.status===0){if(o.responseText){var h=JSON.parse(o.responseText);var l=h.metadata;if(l!==undefined){if(l.type==="object"){n.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");return}if(l.type==="scene"){n.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.");return}}var u=e.parse(h,i);r(u.geometry,u.materials)}else{n.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.")}e.onLoadComplete()}else{n.error("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")")}}else if(o.readyState===o.LOADING){if(a){if(s===0){s=o.getResponseHeader("Content-Length")}a({total:s,loaded:o.responseText.length})}}else if(o.readyState===o.HEADERS_RECEIVED){if(a!==undefined){s=o.getResponseHeader("Content-Length")}}};o.open("GET",t,true);o.withCredentials=this.withCredentials;o.send(null)};n.JSONLoader.prototype.parse=function(e,t){var r=new n.Geometry,i=e.scale!==undefined?1/e.scale:1;a(i);o();s(i);r.computeFaceNormals();r.computeBoundingSphere();function a(t){function i(e,t){return e&1<<t}var a,o,s,h,l,u,c,f,d,p,m,v,g,y,x,_,b,w,M,S,C,T,E,A,L,P,R,F=e.faces,B=e.vertices,U=e.normals,D=e.colors,k=0;if(e.uvs!==undefined){for(a=0;a<e.uvs.length;a++){if(e.uvs[a].length)k++}for(a=0;a<k;a++){r.faceVertexUvs[a]=[]}}h=0;l=B.length;while(h<l){w=new n.Vector3;w.x=B[h++]*t;w.y=B[h++]*t;w.z=B[h++]*t;r.vertices.push(w)}h=0;l=F.length;while(h<l){p=F[h++];m=i(p,0);v=i(p,1);g=i(p,3);y=i(p,4);x=i(p,5);_=i(p,6);b=i(p,7);if(m){S=new n.Face3;S.a=F[h];S.b=F[h+1];S.c=F[h+3];C=new n.Face3;C.a=F[h+1];C.b=F[h+2];C.c=F[h+3];h+=4;if(v){d=F[h++];S.materialIndex=d;C.materialIndex=d}s=r.faces.length;if(g){for(a=0;a<k;a++){A=e.uvs[a];r.faceVertexUvs[a][s]=[];r.faceVertexUvs[a][s+1]=[];for(o=0;o<4;o++){f=F[h++];P=A[f*2];R=A[f*2+1];L=new n.Vector2(P,R);if(o!==2)r.faceVertexUvs[a][s].push(L);if(o!==0)r.faceVertexUvs[a][s+1].push(L)}}}if(y){c=F[h++]*3;S.normal.set(U[c++],U[c++],U[c]);C.normal.copy(S.normal)}if(x){for(a=0;a<4;a++){c=F[h++]*3;E=new n.Vector3(U[c++],U[c++],U[c]);if(a!==2)S.vertexNormals.push(E);if(a!==0)C.vertexNormals.push(E)}}if(_){u=F[h++];T=D[u];S.color.setHex(T);C.color.setHex(T)}if(b){for(a=0;a<4;a++){u=F[h++];T=D[u];if(a!==2)S.vertexColors.push(new n.Color(T));if(a!==0)C.vertexColors.push(new n.Color(T))}}r.faces.push(S);r.faces.push(C)}else{M=new n.Face3;M.a=F[h++];M.b=F[h++];M.c=F[h++];if(v){d=F[h++];M.materialIndex=d}s=r.faces.length;if(g){for(a=0;a<k;a++){A=e.uvs[a];r.faceVertexUvs[a][s]=[];for(o=0;o<3;o++){f=F[h++];P=A[f*2];R=A[f*2+1];L=new n.Vector2(P,R);r.faceVertexUvs[a][s].push(L)}}}if(y){c=F[h++]*3;M.normal.set(U[c++],U[c++],U[c])}if(x){for(a=0;a<3;a++){c=F[h++]*3;E=new n.Vector3(U[c++],U[c++],U[c]);M.vertexNormals.push(E)}}if(_){u=F[h++];M.color.setHex(D[u])}if(b){for(a=0;a<3;a++){u=F[h++];M.vertexColors.push(new n.Color(D[u]))}}r.faces.push(M)}}}function o(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var i=0,a=e.skinWeights.length;i<a;i+=t){var o=e.skinWeights[i];var s=t>1?e.skinWeights[i+1]:0;var h=t>2?e.skinWeights[i+2]:0;var l=t>3?e.skinWeights[i+3]:0;r.skinWeights.push(new n.Vector4(o,s,h,l))}}if(e.skinIndices){for(var i=0,a=e.skinIndices.length;i<a;i+=t){var u=e.skinIndices[i];var c=t>1?e.skinIndices[i+1]:0;var f=t>2?e.skinIndices[i+2]:0;var d=t>3?e.skinIndices[i+3]:0;r.skinIndices.push(new n.Vector4(u,c,f,d))}}r.bones=e.bones;if(r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)){n.warn("THREE.JSONLoader: When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}r.animation=e.animation;r.animations=e.animations}function s(t){if(e.morphTargets!==undefined){var i,a,o,s,h,l;for(i=0,a=e.morphTargets.length;i<a;i++){r.morphTargets[i]={};r.morphTargets[i].name=e.morphTargets[i].name;r.morphTargets[i].vertices=[];h=r.morphTargets[i].vertices;l=e.morphTargets[i].vertices;for(o=0,s=l.length;o<s;o+=3){var u=new n.Vector3;u.x=l[o]*t;u.y=l[o+1]*t;u.z=l[o+2]*t;h.push(u)}}}if(e.morphColors!==undefined){var i,a,c,f,d,p,m;for(i=0,a=e.morphColors.length;i<a;i++){r.morphColors[i]={};r.morphColors[i].name=e.morphColors[i].name;r.morphColors[i].colors=[];d=r.morphColors[i].colors;p=e.morphColors[i].colors;for(c=0,f=p.length;c<f;c+=3){m=new n.Color(16755200);m.setRGB(p[c],p[c+1],p[c+2]);d.push(m)}}}}if(e.materials===undefined||e.materials.length===0){return{geometry:r}}else{var h=this.initMaterials(e.materials,t);if(this.needsTangents(h)){r.computeTangents()}return{geometry:r,materials:h}}};n.LoadingManager=function(e,t,r){var i=this;var n=0,a=0;this.onLoad=e;this.onProgress=t;this.onError=r;this.itemStart=function(e){a++};this.itemEnd=function(e){n++;if(i.onProgress!==undefined){i.onProgress(e,n,a)}if(n===a&&i.onLoad!==undefined){i.onLoad()}}};n.DefaultLoadingManager=new n.LoadingManager;n.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:n.DefaultLoadingManager};n.BufferGeometryLoader.prototype={constructor:n.BufferGeometryLoader,load:function(e,t,r,i){var a=this;var o=new n.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n.BufferGeometry;var r=e.data.attributes;for(var a in r){var o=r[a];var s=new i[o.type](o.array);t.addAttribute(a,new n.BufferAttribute(s,o.itemSize))}var h=e.data.offsets;if(h!==undefined){t.offsets=JSON.parse(JSON.stringify(h))}var l=e.data.boundingSphere;if(l!==undefined){var u=new n.Vector3;if(l.center!==undefined){u.fromArray(l.center)}t.boundingSphere=new n.Sphere(u,l.radius)}return t}};n.MaterialLoader=function(e){this.manager=e!==undefined?e:n.DefaultLoadingManager};n.MaterialLoader.prototype={constructor:n.MaterialLoader,load:function(e,t,r,i){var a=this;var o=new n.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n[e.type];if(e.color!==undefined)t.color.setHex(e.color);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.uniforms!==undefined)t.uniforms=e.uniforms;if(e.vertexShader!==undefined)t.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)t.fragmentShader=e.fragmentShader;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.shading!==undefined)t.shading=e.shading;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.size!==undefined)t.size=e.size;if(e.sizeAttenuation!==undefined)t.sizeAttenuation=e.sizeAttenuation;if(e.materials!==undefined){for(var r=0,i=e.materials.length;r<i;r++){t.materials.push(this.parse(e.materials[r]))}}return t}};n.ObjectLoader=function(e){this.manager=e!==undefined?e:n.DefaultLoadingManager;this.texturePath=""};n.ObjectLoader.prototype={constructor:n.ObjectLoader,load:function(e,t,r,i){if(this.texturePath===""){this.texturePath=e.substring(0,e.lastIndexOf("/")+1)}var a=this;var o=new n.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){a.parse(JSON.parse(e),t)},r,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries);var i=this.parseImages(e.images,function(){if(t!==undefined)t(o)});var n=this.parseTextures(e.textures,i);var a=this.parseMaterials(e.materials,n);var o=this.parseObject(e.object,r,a);if(e.images===undefined||e.images.length===0){if(t!==undefined)t(o)}return o},parseGeometries:function(e){var t={};if(e!==undefined){var r=new n.JSONLoader;var i=new n.BufferGeometryLoader;for(var a=0,o=e.length;a<o;a++){var s;var h=e[a];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new n[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new n.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":s=new n.CircleGeometry(h.radius,h.segments);break;

case"CylinderGeometry":s=new n.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);break;case"SphereGeometry":s=new n.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"IcosahedronGeometry":s=new n.IcosahedronGeometry(h.radius,h.detail);break;case"TorusGeometry":s=new n.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new n.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":s=i.parse(h);break;case"Geometry":s=r.parse(h.data).geometry;break}s.uuid=h.uuid;if(h.name!==undefined)s.name=h.name;t[h.uuid]=s}}return t},parseMaterials:function(e,t){var r={};if(e!==undefined){var i=function(e){if(t[e]===undefined){n.warn("THREE.ObjectLoader: Undefined texture",e)}return t[e]};var a=new n.MaterialLoader;for(var o=0,s=e.length;o<s;o++){var h=e[o];var l=a.parse(h);l.uuid=h.uuid;if(h.name!==undefined)l.name=h.name;if(h.map!==undefined){l.map=i(h.map)}if(h.bumpMap!==undefined){l.bumpMap=i(h.bumpMap);if(h.bumpScale){l.bumpScale=new n.Vector2(h.bumpScale,h.bumpScale)}}if(h.alphaMap!==undefined){l.alphaMap=i(h.alphaMap)}if(h.envMap!==undefined){l.envMap=i(h.envMap)}if(h.normalMap!==undefined){l.normalMap=i(h.normalMap);if(h.normalScale){l.normalScale=new n.Vector2(h.normalScale,h.normalScale)}}if(h.lightMap!==undefined){l.lightMap=i(h.lightMap)}if(h.specularMap!==undefined){l.specularMap=i(h.specularMap)}r[h.uuid]=l}}return r},parseImages:function(e,t){var r=this;var i={};if(e!==undefined&&e.length>0){var a=new n.LoadingManager(t);var o=new n.ImageLoader(a);o.setCrossOrigin(this.crossOrigin);var s=function(e){r.manager.itemStart(e);return o.load(e,function(){r.manager.itemEnd(e)})};for(var h=0,l=e.length;h<l;h++){var u=e[h];var c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.texturePath+u.url;i[u.uuid]=s(c)}}return i},parseTextures:function(e,t){var r={};if(e!==undefined){for(var i=0,a=e.length;i<a;i++){var o=e[i];if(o.image===undefined){n.warn('THREE.ObjectLoader: No "image" speficied for',o.uuid)}if(t[o.image]===undefined){n.warn("THREE.ObjectLoader: Undefined image",o.image)}var s=new n.Texture(t[o.image]);s.needsUpdate=true;s.uuid=o.uuid;if(o.name!==undefined)s.name=o.name;if(o.repeat!==undefined)s.repeat=new n.Vector2(o.repeat[0],o.repeat[1]);if(o.minFilter!==undefined)s.minFilter=n[o.minFilter];if(o.magFilter!==undefined)s.magFilter=n[o.magFilter];if(o.anisotropy!==undefined)s.anisotropy=o.anisotropy;if(o.wrap instanceof Array){s.wrapS=n[o.wrap[0]];s.wrapT=n[o.wrap[1]]}r[o.uuid]=s}}return r},parseObject:function(){var e=new n.Matrix4;return function(t,r,i){var a;var o=function(e){if(r[e]===undefined){n.warn("THREE.ObjectLoader: Undefined geometry",e)}return r[e]};var s=function(e){if(i[e]===undefined){n.warn("THREE.ObjectLoader: Undefined material",e)}return i[e]};switch(t.type){case"Scene":a=new n.Scene;break;case"PerspectiveCamera":a=new n.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new n.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new n.AmbientLight(t.color);break;case"DirectionalLight":a=new n.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new n.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new n.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":a=new n.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":a=new n.Mesh(o(t.geometry),s(t.material));break;case"Line":a=new n.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":a=new n.PointCloud(o(t.geometry),s(t.material));break;case"Sprite":a=new n.Sprite(s(t.material));break;case"Group":a=new n.Group;break;default:a=new n.Object3D}a.uuid=t.uuid;if(t.name!==undefined)a.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(a.position,a.quaternion,a.scale)}else{if(t.position!==undefined)a.position.fromArray(t.position);if(t.rotation!==undefined)a.rotation.fromArray(t.rotation);if(t.scale!==undefined)a.scale.fromArray(t.scale)}if(t.visible!==undefined)a.visible=t.visible;if(t.userData!==undefined)a.userData=t.userData;if(t.children!==undefined){for(var h in t.children){a.add(this.parseObject(t.children[h],r,i))}}return a}}()};n.TextureLoader=function(e){this.manager=e!==undefined?e:n.DefaultLoadingManager};n.TextureLoader.prototype={constructor:n.TextureLoader,load:function(e,t,r,i){var a=this;var o=new n.ImageLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){var r=new n.Texture(e);r.needsUpdate=true;if(t!==undefined){t(r)}},r,i)},setCrossOrigin:function(e){this.crossOrigin=e}};n.DataTextureLoader=n.BinaryTextureLoader=function(){this._parser=null};n.BinaryTextureLoader.prototype={constructor:n.BinaryTextureLoader,load:function(e,t,r,i){var a=this;var o=new n.DataTexture;var s=new n.XHRLoader;s.setResponseType("arraybuffer");s.load(e,function(e){var r=a._parser(e);if(!r)return;if(undefined!==r.image){o.image=r.image}else if(undefined!==r.data){o.image.width=r.width;o.image.height=r.height;o.image.data=r.data}o.wrapS=undefined!==r.wrapS?r.wrapS:n.ClampToEdgeWrapping;o.wrapT=undefined!==r.wrapT?r.wrapT:n.ClampToEdgeWrapping;o.magFilter=undefined!==r.magFilter?r.magFilter:n.LinearFilter;o.minFilter=undefined!==r.minFilter?r.minFilter:n.LinearMipMapLinearFilter;o.anisotropy=undefined!==r.anisotropy?r.anisotropy:1;if(undefined!==r.format){o.format=r.format}if(undefined!==r.type){o.type=r.type}if(undefined!==r.mipmaps){o.mipmaps=r.mipmaps}if(1===r.mipmapCount){o.minFilter=n.LinearFilter}o.needsUpdate=true;if(t)t(o,r)},r,i);return o}};n.CompressedTextureLoader=function(){this._parser=null};n.CompressedTextureLoader.prototype={constructor:n.CompressedTextureLoader,load:function(e,t,r){var i=this;var a=[];var o=new n.CompressedTexture;o.image=a;var s=new n.XHRLoader;s.setResponseType("arraybuffer");if(e instanceof Array){var h=0;var l=function(r){s.load(e[r],function(e){var s=i._parser(e,true);a[r]={width:s.width,height:s.height,format:s.format,mipmaps:s.mipmaps};h+=1;if(h===6){if(s.mipmapCount==1)o.minFilter=n.LinearFilter;o.format=s.format;o.needsUpdate=true;if(t)t(o)}})};for(var u=0,c=e.length;u<c;++u){l(u)}}else{s.load(e,function(e){var r=i._parser(e,true);if(r.isCubemap){var s=r.mipmaps.length/r.mipmapCount;for(var h=0;h<s;h++){a[h]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++){a[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+l]);a[h].format=r.format;a[h].width=r.width;a[h].height=r.height}}}else{o.image.width=r.width;o.image.height=r.height;o.mipmaps=r.mipmaps}if(r.mipmapCount===1){o.minFilter=n.LinearFilter}o.format=r.format;o.needsUpdate=true;if(t)t(o)})}return o}};n.Material=function(){Object.defineProperty(this,"id",{value:n.MaterialIdCount++});this.uuid=n.Math.generateUUID();this.name="";this.type="Material";this.side=n.FrontSide;this.opacity=1;this.transparent=false;this.blending=n.NormalBlending;this.blendSrc=n.SrcAlphaFactor;this.blendDst=n.OneMinusSrcAlphaFactor;this.blendEquation=n.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};n.Material.prototype={constructor:n.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},setValues:function(e){if(e===undefined)return;for(var t in e){var r=e[t];if(r===undefined){n.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var i=this[t];if(i instanceof n.Color){i.set(r)}else if(i instanceof n.Vector3&&r instanceof n.Vector3){i.copy(r)}else if(t=="overdraw"){this[t]=Number(r)}else{this[t]=r}}}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this instanceof n.MeshBasicMaterial){e.color=this.color.getHex();if(this.vertexColors!==n.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==n.NormalBlending)e.blending=this.blending;if(this.side!==n.FrontSide)e.side=this.side}else if(this instanceof n.MeshLambertMaterial){e.color=this.color.getHex();e.emissive=this.emissive.getHex();if(this.vertexColors!==n.NoColors)e.vertexColors=this.vertexColors;if(this.shading!==n.SmoothShading)e.shading=this.shading;if(this.blending!==n.NormalBlending)e.blending=this.blending;if(this.side!==n.FrontSide)e.side=this.side}else if(this instanceof n.MeshPhongMaterial){e.color=this.color.getHex();e.emissive=this.emissive.getHex();e.specular=this.specular.getHex();e.shininess=this.shininess;if(this.vertexColors!==n.NoColors)e.vertexColors=this.vertexColors;if(this.shading!==n.SmoothShading)e.shading=this.shading;if(this.blending!==n.NormalBlending)e.blending=this.blending;if(this.side!==n.FrontSide)e.side=this.side}else if(this instanceof n.MeshNormalMaterial){if(this.blending!==n.NormalBlending)e.blending=this.blending;if(this.side!==n.FrontSide)e.side=this.side}else if(this instanceof n.MeshDepthMaterial){if(this.blending!==n.NormalBlending)e.blending=this.blending;if(this.side!==n.FrontSide)e.side=this.side}else if(this instanceof n.PointCloudMaterial){e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.color=this.color.getHex();if(this.vertexColors!==n.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==n.NormalBlending)e.blending=this.blending}else if(this instanceof n.ShaderMaterial){e.uniforms=this.uniforms;e.vertexShader=this.vertexShader;e.fragmentShader=this.fragmentShader}else if(this instanceof n.SpriteMaterial){e.color=this.color.getHex()}if(this.opacity<1)e.opacity=this.opacity;if(this.transparent!==false)e.transparent=this.transparent;if(this.wireframe!==false)e.wireframe=this.wireframe;return e},clone:function(e){if(e===undefined)e=new n.Material;e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.blendSrcAlpha=this.blendSrcAlpha;e.blendDstAlpha=this.blendDstAlpha;e.blendEquationAlpha=this.blendEquationAlpha;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};n.EventDispatcher.prototype.apply(n.Material.prototype);n.MaterialIdCount=0;n.LineBasicMaterial=function(e){n.Material.call(this);this.type="LineBasicMaterial";this.color=new n.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=n.NoColors;this.fog=true;this.setValues(e)};n.LineBasicMaterial.prototype=Object.create(n.Material.prototype);n.LineBasicMaterial.prototype.constructor=n.LineBasicMaterial;n.LineBasicMaterial.prototype.clone=function(){var e=new n.LineBasicMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};n.LineDashedMaterial=function(e){n.Material.call(this);this.type="LineDashedMaterial";this.color=new n.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};n.LineDashedMaterial.prototype=Object.create(n.Material.prototype);n.LineDashedMaterial.prototype.constructor=n.LineDashedMaterial;n.LineDashedMaterial.prototype.clone=function(){var e=new n.LineDashedMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};n.MeshBasicMaterial=function(e){n.Material.call(this);this.type="MeshBasicMaterial";this.color=new n.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=n.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=n.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=n.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};n.MeshBasicMaterial.prototype=Object.create(n.Material.prototype);n.MeshBasicMaterial.prototype.constructor=n.MeshBasicMaterial;n.MeshBasicMaterial.prototype.clone=function(){var e=new n.MeshBasicMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};n.MeshLambertMaterial=function(e){n.Material.call(this);this.type="MeshLambertMaterial";this.color=new n.Color(16777215);this.emissive=new n.Color(0);this.wrapAround=false;this.wrapRGB=new n.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=n.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=n.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=n.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};n.MeshLambertMaterial.prototype=Object.create(n.Material.prototype);n.MeshLambertMaterial.prototype.constructor=n.MeshLambertMaterial;n.MeshLambertMaterial.prototype.clone=function(){var e=new n.MeshLambertMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};n.MeshPhongMaterial=function(e){n.Material.call(this);this.type="MeshPhongMaterial";this.color=new n.Color(16777215);this.emissive=new n.Color(0);this.specular=new n.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new n.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new n.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=n.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=n.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=n.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};n.MeshPhongMaterial.prototype=Object.create(n.Material.prototype);n.MeshPhongMaterial.prototype.constructor=n.MeshPhongMaterial;n.MeshPhongMaterial.prototype.clone=function(){var e=new n.MeshPhongMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};n.MeshDepthMaterial=function(e){n.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};n.MeshDepthMaterial.prototype=Object.create(n.Material.prototype);n.MeshDepthMaterial.prototype.constructor=n.MeshDepthMaterial;n.MeshDepthMaterial.prototype.clone=function(){var e=new n.MeshDepthMaterial;n.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};n.MeshNormalMaterial=function(e){n.Material.call(this,e);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};n.MeshNormalMaterial.prototype=Object.create(n.Material.prototype);n.MeshNormalMaterial.prototype.constructor=n.MeshNormalMaterial;n.MeshNormalMaterial.prototype.clone=function(){var e=new n.MeshNormalMaterial;n.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};n.MeshFaceMaterial=function(e){this.uuid=n.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=e instanceof Array?e:[]};n.MeshFaceMaterial.prototype={constructor:n.MeshFaceMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,r=this.materials.length;t<r;t++){e.materials.push(this.materials[t].toJSON())}return e},clone:function(){var e=new n.MeshFaceMaterial;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}return e}};n.PointCloudMaterial=function(e){n.Material.call(this);this.type="PointCloudMaterial";this.color=new n.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=n.NoColors;this.fog=true;this.setValues(e)};n.PointCloudMaterial.prototype=Object.create(n.Material.prototype);n.PointCloudMaterial.prototype.constructor=n.PointCloudMaterial;n.PointCloudMaterial.prototype.clone=function(){var e=new n.PointCloudMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};n.ParticleBasicMaterial=function(e){n.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new n.PointCloudMaterial(e)};n.ParticleSystemMaterial=function(e){n.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new n.PointCloudMaterial(e)};n.ShaderMaterial=function(e){n.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=n.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=n.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(e)};n.ShaderMaterial.prototype=Object.create(n.Material.prototype);n.ShaderMaterial.prototype.constructor=n.ShaderMaterial;n.ShaderMaterial.prototype.clone=function(){var e=new n.ShaderMaterial;n.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=n.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};n.RawShaderMaterial=function(e){n.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};n.RawShaderMaterial.prototype=Object.create(n.ShaderMaterial.prototype);n.RawShaderMaterial.prototype.constructor=n.RawShaderMaterial;n.RawShaderMaterial.prototype.clone=function(){var e=new n.RawShaderMaterial;n.ShaderMaterial.prototype.clone.call(this,e);return e};n.SpriteMaterial=function(e){n.Material.call(this);this.type="SpriteMaterial";this.color=new n.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};n.SpriteMaterial.prototype=Object.create(n.Material.prototype);n.SpriteMaterial.prototype.constructor=n.SpriteMaterial;n.SpriteMaterial.prototype.clone=function(){var e=new n.SpriteMaterial;n.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.rotation=this.rotation;e.fog=this.fog;return e};n.Texture=function(e,t,r,i,a,o,s,h,l){Object.defineProperty(this,"id",{value:n.TextureIdCount++});this.uuid=n.Math.generateUUID();this.name="";this.sourceFile="";this.image=e!==undefined?e:n.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:n.Texture.DEFAULT_MAPPING;this.wrapS=r!==undefined?r:n.ClampToEdgeWrapping;this.wrapT=i!==undefined?i:n.ClampToEdgeWrapping;this.magFilter=a!==undefined?a:n.LinearFilter;this.minFilter=o!==undefined?o:n.LinearMipMapLinearFilter;this.anisotropy=l!==undefined?l:1;this.format=s!==undefined?s:n.RGBAFormat;this.type=h!==undefined?h:n.UnsignedByteType;this.offset=new n.Vector2(0,0);this.repeat=new n.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};n.Texture.DEFAULT_IMAGE=undefined;n.Texture.DEFAULT_MAPPING=n.UVMapping;n.Texture.prototype={constructor:n.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},clone:function(e){if(e===undefined)e=new n.Texture;e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};n.EventDispatcher.prototype.apply(n.Texture.prototype);n.TextureIdCount=0;n.CubeTexture=function(e,t,r,i,a,o,s,h,l){t=t!==undefined?t:n.CubeReflectionMapping;n.Texture.call(this,e,t,r,i,a,o,s,h,l);this.images=e};n.CubeTexture.prototype=Object.create(n.Texture.prototype);n.CubeTexture.prototype.constructor=n.CubeTexture;n.CubeTexture.clone=function(e){if(e===undefined)e=new n.CubeTexture;n.Texture.prototype.clone.call(this,e);e.images=this.images;return e};n.CompressedTexture=function(e,t,r,i,a,o,s,h,l,u,c){n.Texture.call(this,null,o,s,h,l,u,i,a,c);this.image={width:t,height:r};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false};n.CompressedTexture.prototype=Object.create(n.Texture.prototype);n.CompressedTexture.prototype.constructor=n.CompressedTexture;n.CompressedTexture.prototype.clone=function(){var e=new n.CompressedTexture;n.Texture.prototype.clone.call(this,e);return e};n.DataTexture=function(e,t,r,i,a,o,s,h,l,u,c){n.Texture.call(this,null,o,s,h,l,u,i,a,c);this.image={data:e,width:t,height:r}};n.DataTexture.prototype=Object.create(n.Texture.prototype);n.DataTexture.prototype.constructor=n.DataTexture;n.DataTexture.prototype.clone=function(){var e=new n.DataTexture;n.Texture.prototype.clone.call(this,e);return e};n.VideoTexture=function(e,t,r,i,a,o,s,h,l){n.Texture.call(this,e,t,r,i,a,o,s,h,l);this.generateMipmaps=false;var u=this;var c=function(){requestAnimationFrame(c);if(e.readyState===e.HAVE_ENOUGH_DATA){u.needsUpdate=true}};c()};n.VideoTexture.prototype=Object.create(n.Texture.prototype);n.VideoTexture.prototype.constructor=n.VideoTexture;n.Group=function(){n.Object3D.call(this);this.type="Group"};n.Group.prototype=Object.create(n.Object3D.prototype);n.Group.prototype.constructor=n.Group;n.PointCloud=function(e,t){n.Object3D.call(this);this.type="PointCloud";this.geometry=e!==undefined?e:new n.Geometry;this.material=t!==undefined?t:new n.PointCloudMaterial({color:Math.random()*16777215})};n.PointCloud.prototype=Object.create(n.Object3D.prototype);n.PointCloud.prototype.constructor=n.PointCloud;n.PointCloud.prototype.raycast=function(){var e=new n.Matrix4;var t=new n.Ray;return function(r,i){var a=this;var o=a.geometry;var s=r.params.PointCloud.threshold;e.getInverse(this.matrixWorld);t.copy(r.ray).applyMatrix4(e);if(o.boundingBox!==null){if(t.isIntersectionBox(o.boundingBox)===false){return}}var h=s/((this.scale.x+this.scale.y+this.scale.z)/3);var l=new n.Vector3;var u=function(e,n){var o=t.distanceToPoint(e);if(o<h){var s=t.closestPointToPoint(e);s.applyMatrix4(a.matrixWorld);var l=r.ray.origin.distanceTo(s);i.push({distance:l,distanceToRay:o,point:s.clone(),index:n,face:null,object:a})}};if(o instanceof n.BufferGeometry){var c=o.attributes;var f=c.position.array;if(c.index!==undefined){var d=c.index.array;var p=o.offsets;if(p.length===0){var m={start:0,count:d.length,index:0};p=[m]}for(var v=0,g=p.length;v<g;++v){var y=p[v].start;var x=p[v].count;var _=p[v].index;for(var b=y,w=y+x;b<w;b++){var M=_+d[b];l.fromArray(f,M*3);u(l,M)}}}else{var S=f.length/3;for(var b=0;b<S;b++){l.set(f[3*b],f[3*b+1],f[3*b+2]);u(l,b)}}}else{var C=this.geometry.vertices;for(var b=0;b<C.length;b++){u(C[b],b)}}}}();n.PointCloud.prototype.clone=function(e){if(e===undefined)e=new n.PointCloud(this.geometry,this.material);n.Object3D.prototype.clone.call(this,e);return e};n.ParticleSystem=function(e,t){n.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new n.PointCloud(e,t)};n.Line=function(e,t,r){n.Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new n.Geometry;this.material=t!==undefined?t:new n.LineBasicMaterial({color:Math.random()*16777215});this.mode=r!==undefined?r:n.LineStrip};n.LineStrip=0;n.LinePieces=1;n.Line.prototype=Object.create(n.Object3D.prototype);n.Line.prototype.constructor=n.Line;n.Line.prototype.raycast=function(){var e=new n.Matrix4;var t=new n.Ray;var r=new n.Sphere;return function(i,a){var o=i.linePrecision;var s=o*o;var h=this.geometry;if(h.boundingSphere===null)h.computeBoundingSphere();r.copy(h.boundingSphere);r.applyMatrix4(this.matrixWorld);if(i.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(i.ray).applyMatrix4(e);var l=new n.Vector3;var u=new n.Vector3;var c=new n.Vector3;var f=new n.Vector3;var d=this.mode===n.LineStrip?1:2;if(h instanceof n.BufferGeometry){var p=h.attributes;if(p.index!==undefined){var m=p.index.array;var v=p.position.array;var g=h.offsets;if(g.length===0){g=[{start:0,count:m.length,index:0}]}for(var y=0;y<g.length;y++){var x=g[y].start;var _=g[y].count;var b=g[y].index;for(var w=x;w<x+_-1;w+=d){var M=b+m[w];var S=b+m[w+1];l.fromArray(v,M*3);u.fromArray(v,S*3);var C=t.distanceSqToSegment(l,u,f,c);if(C>s)continue;var T=t.origin.distanceTo(f);if(T<i.near||T>i.far)continue;a.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:w,offsetIndex:y,face:null,faceIndex:null,object:this})}}}else{var v=p.position.array;for(var w=0;w<v.length/3-1;w+=d){l.fromArray(v,3*w);u.fromArray(v,3*w+3);var C=t.distanceSqToSegment(l,u,f,c);if(C>s)continue;var T=t.origin.distanceTo(f);if(T<i.near||T>i.far)continue;a.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}else if(h instanceof n.Geometry){var E=h.vertices;var A=E.length;for(var w=0;w<A-1;w+=d){var C=t.distanceSqToSegment(E[w],E[w+1],f,c);if(C>s)continue;var T=t.origin.distanceTo(f);if(T<i.near||T>i.far)continue;a.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}}();n.Line.prototype.clone=function(e){if(e===undefined)e=new n.Line(this.geometry,this.material,this.mode);n.Object3D.prototype.clone.call(this,e);return e};n.Mesh=function(e,t){n.Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new n.Geometry;this.material=t!==undefined?t:new n.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};n.Mesh.prototype=Object.create(n.Object3D.prototype);n.Mesh.prototype.constructor=n.Mesh;n.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};n.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}n.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};n.Mesh.prototype.raycast=function(){var e=new n.Matrix4;var t=new n.Ray;var r=new n.Sphere;var i=new n.Vector3;var a=new n.Vector3;var o=new n.Vector3;return function(s,h){var l=this.geometry;if(l.boundingSphere===null)l.computeBoundingSphere();r.copy(l.boundingSphere);r.applyMatrix4(this.matrixWorld);if(s.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(s.ray).applyMatrix4(e);if(l.boundingBox!==null){if(t.isIntersectionBox(l.boundingBox)===false){return}}if(l instanceof n.BufferGeometry){var u=this.material;if(u===undefined)return;var c=l.attributes;var f,d,p;var m=s.precision;if(c.index!==undefined){var v=c.index.array;var g=c.position.array;var y=l.offsets;if(y.length===0){y=[{start:0,count:v.length,index:0}]}for(var x=0,_=y.length;x<_;++x){var b=y[x].start;var w=y[x].count;var M=y[x].index;for(var S=b,C=b+w;S<C;S+=3){f=M+v[S];d=M+v[S+1];p=M+v[S+2];i.fromArray(g,f*3);a.fromArray(g,d*3);o.fromArray(g,p*3);if(u.side===n.BackSide){var T=t.intersectTriangle(o,a,i,true)}else{var T=t.intersectTriangle(i,a,o,u.side!==n.DoubleSide)}if(T===null)continue;T.applyMatrix4(this.matrixWorld);var E=s.ray.origin.distanceTo(T);if(E<m||E<s.near||E>s.far)continue;h.push({distance:E,point:T,face:new n.Face3(f,d,p,n.Triangle.normal(i,a,o)),faceIndex:null,object:this})}}}else{var g=c.position.array;for(var S=0,A=0,C=g.length;S<C;S+=3,A+=9){f=S;d=S+1;p=S+2;i.fromArray(g,A);a.fromArray(g,A+3);o.fromArray(g,A+6);if(u.side===n.BackSide){var T=t.intersectTriangle(o,a,i,true)}else{var T=t.intersectTriangle(i,a,o,u.side!==n.DoubleSide)}if(T===null)continue;T.applyMatrix4(this.matrixWorld);var E=s.ray.origin.distanceTo(T);if(E<m||E<s.near||E>s.far)continue;h.push({distance:E,point:T,face:new n.Face3(f,d,p,n.Triangle.normal(i,a,o)),faceIndex:null,object:this})}}}else if(l instanceof n.Geometry){var L=this.material instanceof n.MeshFaceMaterial;var P=L===true?this.material.materials:null;var f,d,p;var m=s.precision;var R=l.vertices;for(var F=0,B=l.faces.length;F<B;F++){var U=l.faces[F];var u=L===true?P[U.materialIndex]:this.material;if(u===undefined)continue;f=R[U.a];d=R[U.b];

p=R[U.c];if(u.morphTargets===true){var D=l.morphTargets;var k=this.morphTargetInfluences;i.set(0,0,0);a.set(0,0,0);o.set(0,0,0);for(var V=0,N=D.length;V<N;V++){var O=k[V];if(O===0)continue;var z=D[V].vertices;i.x+=(z[U.a].x-f.x)*O;i.y+=(z[U.a].y-f.y)*O;i.z+=(z[U.a].z-f.z)*O;a.x+=(z[U.b].x-d.x)*O;a.y+=(z[U.b].y-d.y)*O;a.z+=(z[U.b].z-d.z)*O;o.x+=(z[U.c].x-p.x)*O;o.y+=(z[U.c].y-p.y)*O;o.z+=(z[U.c].z-p.z)*O}i.add(f);a.add(d);o.add(p);f=i;d=a;p=o}if(u.side===n.BackSide){var T=t.intersectTriangle(p,d,f,true)}else{var T=t.intersectTriangle(f,d,p,u.side!==n.DoubleSide)}if(T===null)continue;T.applyMatrix4(this.matrixWorld);var E=s.ray.origin.distanceTo(T);if(E<m||E<s.near||E>s.far)continue;h.push({distance:E,point:T,face:U,faceIndex:F,object:this})}}}}();n.Mesh.prototype.clone=function(e,t){if(e===undefined)e=new n.Mesh(this.geometry,this.material);n.Object3D.prototype.clone.call(this,e,t);return e};n.Bone=function(e){n.Object3D.call(this);this.type="Bone";this.skin=e};n.Bone.prototype=Object.create(n.Object3D.prototype);n.Bone.prototype.constructor=n.Bone;n.Skeleton=function(e,t,r){this.useVertexTexture=r!==undefined?r:true;this.identityMatrix=new n.Matrix4;e=e||[];this.bones=e.slice(0);if(this.useVertexTexture){var i;if(this.bones.length>256)i=64;else if(this.bones.length>64)i=32;else if(this.bones.length>16)i=16;else i=8;this.boneTextureWidth=i;this.boneTextureHeight=i;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new n.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,n.RGBAFormat,n.FloatType);this.boneTexture.minFilter=n.NearestFilter;this.boneTexture.magFilter=n.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{n.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var a=0,o=this.bones.length;a<o;a++){this.boneInverses.push(new n.Matrix4)}}}};n.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new n.Matrix4;if(this.bones[e]){r.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(r)}};n.Skeleton.prototype.pose=function(){var e;for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){if(e.parent){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}};n.Skeleton.prototype.update=function(){var e=new n.Matrix4;return function(){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]);e.flattenToArrayOffset(this.boneMatrices,t*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();n.SkinnedMesh=function(e,t,r){n.Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new n.Matrix4;this.bindMatrixInverse=new n.Matrix4;var i=[];if(this.geometry&&this.geometry.bones!==undefined){var a,o,s,h,l;for(var u=0,c=this.geometry.bones.length;u<c;++u){o=this.geometry.bones[u];s=o.pos;h=o.rotq;l=o.scl;a=new n.Bone(this);i.push(a);a.name=o.name;a.position.set(s[0],s[1],s[2]);a.quaternion.set(h[0],h[1],h[2],h[3]);if(l!==undefined){a.scale.set(l[0],l[1],l[2])}else{a.scale.set(1,1,1)}}for(var u=0,c=this.geometry.bones.length;u<c;++u){o=this.geometry.bones[u];if(o.parent!==-1){i[o.parent].add(i[u])}else{this.add(i[u])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new n.Skeleton(i,undefined,r))};n.SkinnedMesh.prototype=Object.create(n.Mesh.prototype);n.SkinnedMesh.prototype.constructor=n.SkinnedMesh;n.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)};n.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};n.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof n.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var r=1/t.lengthManhattan();if(r!==Infinity){t.multiplyScalar(r)}else{t.set(1)}}}else{}};n.SkinnedMesh.prototype.updateMatrixWorld=function(e){n.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{n.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};n.SkinnedMesh.prototype.clone=function(e){if(e===undefined){e=new n.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}n.Mesh.prototype.clone.call(this,e);return e};n.MorphAnimMesh=function(e,t){n.Mesh.call(this,e,t);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};n.MorphAnimMesh.prototype=Object.create(n.Mesh.prototype);n.MorphAnimMesh.prototype.constructor=n.MorphAnimMesh;n.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};n.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};n.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};n.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};var t,r=e.animations;var i=/([a-z]+)_?(\d+)/;for(var n=0,a=e.morphTargets.length;n<a;n++){var o=e.morphTargets[n];var s=o.name.match(i);if(s&&s.length>1){var h=s[1];if(!r[h])r[h]={start:Infinity,end:-Infinity};var l=r[h];if(n<l.start)l.start=n;if(n>l.end)l.end=n;if(!t)t=h}}e.firstAnimation=t};n.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:r}};n.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];if(r){this.setFrameRange(r.start,r.end);this.duration=1e3*((r.end-r.start)/t);this.time=0}else{n.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")}};n.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var r=this.startKeyframe+n.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(r!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[r]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=r}var i=this.time%t/t;if(this.directionBackwards){i=1-i}this.morphTargetInfluences[this.currentKeyframe]=i;this.morphTargetInfluences[this.lastKeyframe]=1-i};n.MorphAnimMesh.prototype.interpolateTargets=function(e,t,r){var i=this.morphTargetInfluences;for(var n=0,a=i.length;n<a;n++){i[n]=0}if(e>-1)i[e]=1-r;if(t>-1)i[t]=r};n.MorphAnimMesh.prototype.clone=function(e){if(e===undefined)e=new n.MorphAnimMesh(this.geometry,this.material);e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;n.Mesh.prototype.clone.call(this,e);return e};n.LOD=function(){n.Object3D.call(this);this.objects=[]};n.LOD.prototype=Object.create(n.Object3D.prototype);n.LOD.prototype.constructor=n.LOD;n.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);for(var r=0;r<this.objects.length;r++){if(t<this.objects[r].distance){break}}this.objects.splice(r,0,{distance:t,object:e});this.add(e)};n.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;t<r;t++){if(e<this.objects[t].distance){break}}return this.objects[t-1].object};n.LOD.prototype.raycast=function(){var e=new n.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}();n.LOD.prototype.update=function(){var e=new n.Vector3;var t=new n.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=true;for(var n=1,a=this.objects.length;n<a;n++){if(i>=this.objects[n].distance){this.objects[n-1].object.visible=false;this.objects[n].object.visible=true}else{break}}for(;n<a;n++){this.objects[n].object.visible=false}}}}();n.LOD.prototype.clone=function(e){if(e===undefined)e=new n.LOD;n.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;t<r;t++){var i=this.objects[t].object.clone();i.visible=t===0;e.addLevel(i,this.objects[t].distance)}return e};n.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]);var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var r=new Float32Array([0,0,1,0,1,1,0,1]);var i=new n.BufferGeometry;i.addAttribute("index",new n.BufferAttribute(e,1));i.addAttribute("position",new n.BufferAttribute(t,3));i.addAttribute("uv",new n.BufferAttribute(r,2));return function(e){n.Object3D.call(this);this.type="Sprite";this.geometry=i;this.material=e!==undefined?e:new n.SpriteMaterial}}();n.Sprite.prototype=Object.create(n.Object3D.prototype);n.Sprite.prototype.constructor=n.Sprite;n.Sprite.prototype.raycast=function(){var e=new n.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);if(i>this.scale.x){return}r.push({distance:i,point:this.position,face:null,object:this})}}();n.Sprite.prototype.clone=function(e){if(e===undefined)e=new n.Sprite(this.material);n.Object3D.prototype.clone.call(this,e);return e};n.Particle=n.Sprite;n.LensFlare=function(e,t,r,i,a){n.Object3D.call(this);this.lensFlares=[];this.positionScreen=new n.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,r,i,a)}};n.LensFlare.prototype=Object.create(n.Object3D.prototype);n.LensFlare.prototype.constructor=n.LensFlare;n.LensFlare.prototype.add=function(e,t,r,i,a,o){if(t===undefined)t=-1;if(r===undefined)r=0;if(o===undefined)o=1;if(a===undefined)a=new n.Color(16777215);if(i===undefined)i=n.NormalBlending;r=Math.min(r,Math.max(0,r));this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:a,blending:i})};n.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var r;var i=-this.positionScreen.x*2;var n=-this.positionScreen.y*2;for(e=0;e<t;e++){r=this.lensFlares[e];r.x=this.positionScreen.x+i*r.distance;r.y=this.positionScreen.y+n*r.distance;r.wantedRotation=r.x*Math.PI*.25;r.rotation+=(r.wantedRotation-r.rotation)*.25}};n.Scene=function(){n.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};n.Scene.prototype=Object.create(n.Object3D.prototype);n.Scene.prototype.constructor=n.Scene;n.Scene.prototype.clone=function(e){if(e===undefined)e=new n.Scene;n.Object3D.prototype.clone.call(this,e);if(this.fog!==null)e.fog=this.fog.clone();if(this.overrideMaterial!==null)e.overrideMaterial=this.overrideMaterial.clone();e.autoUpdate=this.autoUpdate;e.matrixAutoUpdate=this.matrixAutoUpdate;return e};n.Fog=function(e,t,r){this.name="";this.color=new n.Color(e);this.near=t!==undefined?t:1;this.far=r!==undefined?r:1e3};n.Fog.prototype.clone=function(){return new n.Fog(this.color.getHex(),this.near,this.far)};n.FogExp2=function(e,t){this.name="";this.color=new n.Color(e);this.density=t!==undefined?t:25e-5};n.FogExp2.prototype.clone=function(){return new n.FogExp2(this.color.getHex(),this.density)};n.ShaderChunk={};n.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n	float distance = dot( planeNormal, point-pointOnPlane );\n	return point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n	return pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n	if ( decayExponent > 0.0 ) {\n	  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n	}\n	return 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n	return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n	return a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n	return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n	return a;\n#endif\n}\n";n.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";n.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack += ambientLightColor;\n\n#endif\n";n.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n";n.ShaderChunk["default_vertex"]="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n	vec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";n.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";n.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n";n.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";n.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif";n.ShaderChunk["lights_phong_fragment"]="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		totalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		totalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			totalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n			// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			totalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n		// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		totalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		totalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalDiffuseLight += hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		totalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\n#ifdef METAL\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n";n.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";n.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif";n.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n";n.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";n.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";n.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n";n.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif";n.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";n.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif";n.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif";n.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif";n.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";

n.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";n.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n	vColor.xyz = inputToLinear( color.xyz );\n\n#endif";n.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";n.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n";n.ShaderChunk["linear_to_gamma_fragment"]="\n	outgoingLight = linearToOutput( outgoingLight );\n";n.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";n.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n";n.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";n.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n";n.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";n.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";n.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";n.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";n.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n		fogFactor = whiteCompliment( fogFactor );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";n.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n";n.ShaderChunk["defaultnormal_vertex"]="#ifdef USE_SKINNING\n\n	vec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n	vec3 objectNormal = morphedNormal;\n\n#else\n\n	vec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";n.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n";n.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";n.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";n.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n	outgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif";n.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";n.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif";n.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif";n.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n";n.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n	shadowColor = inputToLinear( shadowColor );\n\n	outgoingLight = outgoingLight * shadowColor;\n\n#endif\n";n.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#elif defined( USE_MORPHTARGETS )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif\n";n.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif";n.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";n.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif";n.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";n.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";n.UniformsUtils={merge:function(e){var t={};for(var r=0;r<e.length;r++){var i=this.clone(e[r]);for(var n in i){t[n]=i[n]}}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var a=e[r][i];if(a instanceof n.Color||a instanceof n.Vector2||a instanceof n.Vector3||a instanceof n.Vector4||a instanceof n.Matrix4||a instanceof n.Texture){t[r][i]=a.clone()}else if(a instanceof Array){t[r][i]=a.slice()}else{t[r][i]=a}}}return t}};n.UniformsLib={common:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new n.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};n.ShaderLib={basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib["common"],n.UniformsLib["fog"],n.UniformsLib["shadowmap"]]),vertexShader:[n.ShaderChunk["common"],n.ShaderChunk["map_pars_vertex"],n.ShaderChunk["lightmap_pars_vertex"],n.ShaderChunk["envmap_pars_vertex"],n.ShaderChunk["color_pars_vertex"],n.ShaderChunk["morphtarget_pars_vertex"],n.ShaderChunk["skinning_pars_vertex"],n.ShaderChunk["shadowmap_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["map_vertex"],n.ShaderChunk["lightmap_vertex"],n.ShaderChunk["color_vertex"],n.ShaderChunk["skinbase_vertex"],"	#ifdef USE_ENVMAP",n.ShaderChunk["morphnormal_vertex"],n.ShaderChunk["skinnormal_vertex"],n.ShaderChunk["defaultnormal_vertex"],"	#endif",n.ShaderChunk["morphtarget_vertex"],n.ShaderChunk["skinning_vertex"],n.ShaderChunk["default_vertex"],n.ShaderChunk["logdepthbuf_vertex"],n.ShaderChunk["worldpos_vertex"],n.ShaderChunk["envmap_vertex"],n.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",n.ShaderChunk["common"],n.ShaderChunk["color_pars_fragment"],n.ShaderChunk["map_pars_fragment"],n.ShaderChunk["alphamap_pars_fragment"],n.ShaderChunk["lightmap_pars_fragment"],n.ShaderChunk["envmap_pars_fragment"],n.ShaderChunk["fog_pars_fragment"],n.ShaderChunk["shadowmap_pars_fragment"],n.ShaderChunk["specularmap_pars_fragment"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",n.ShaderChunk["logdepthbuf_fragment"],n.ShaderChunk["map_fragment"],n.ShaderChunk["color_fragment"],n.ShaderChunk["alphamap_fragment"],n.ShaderChunk["alphatest_fragment"],n.ShaderChunk["specularmap_fragment"],"	outgoingLight = diffuseColor.rgb;",n.ShaderChunk["lightmap_fragment"],n.ShaderChunk["envmap_fragment"],n.ShaderChunk["shadowmap_fragment"],n.ShaderChunk["linear_to_gamma_fragment"],n.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib["common"],n.UniformsLib["fog"],n.UniformsLib["lights"],n.UniformsLib["shadowmap"],{emissive:{type:"c",value:new n.Color(0)},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",n.ShaderChunk["common"],n.ShaderChunk["map_pars_vertex"],n.ShaderChunk["lightmap_pars_vertex"],n.ShaderChunk["envmap_pars_vertex"],n.ShaderChunk["lights_lambert_pars_vertex"],n.ShaderChunk["color_pars_vertex"],n.ShaderChunk["morphtarget_pars_vertex"],n.ShaderChunk["skinning_pars_vertex"],n.ShaderChunk["shadowmap_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["map_vertex"],n.ShaderChunk["lightmap_vertex"],n.ShaderChunk["color_vertex"],n.ShaderChunk["morphnormal_vertex"],n.ShaderChunk["skinbase_vertex"],n.ShaderChunk["skinnormal_vertex"],n.ShaderChunk["defaultnormal_vertex"],n.ShaderChunk["morphtarget_vertex"],n.ShaderChunk["skinning_vertex"],n.ShaderChunk["default_vertex"],n.ShaderChunk["logdepthbuf_vertex"],n.ShaderChunk["worldpos_vertex"],n.ShaderChunk["envmap_vertex"],n.ShaderChunk["lights_lambert_vertex"],n.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",n.ShaderChunk["common"],n.ShaderChunk["color_pars_fragment"],n.ShaderChunk["map_pars_fragment"],n.ShaderChunk["alphamap_pars_fragment"],n.ShaderChunk["lightmap_pars_fragment"],n.ShaderChunk["envmap_pars_fragment"],n.ShaderChunk["fog_pars_fragment"],n.ShaderChunk["shadowmap_pars_fragment"],n.ShaderChunk["specularmap_pars_fragment"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",n.ShaderChunk["logdepthbuf_fragment"],n.ShaderChunk["map_fragment"],n.ShaderChunk["color_fragment"],n.ShaderChunk["alphamap_fragment"],n.ShaderChunk["alphatest_fragment"],n.ShaderChunk["specularmap_fragment"],"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * vLightFront + emissive;","		else","			outgoingLight += diffuseColor.rgb * vLightBack + emissive;","	#else","		outgoingLight += diffuseColor.rgb * vLightFront + emissive;","	#endif",n.ShaderChunk["lightmap_fragment"],n.ShaderChunk["envmap_fragment"],n.ShaderChunk["shadowmap_fragment"],n.ShaderChunk["linear_to_gamma_fragment"],n.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib["common"],n.UniformsLib["bump"],n.UniformsLib["normalmap"],n.UniformsLib["fog"],n.UniformsLib["lights"],n.UniformsLib["shadowmap"],{emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",n.ShaderChunk["common"],n.ShaderChunk["map_pars_vertex"],n.ShaderChunk["lightmap_pars_vertex"],n.ShaderChunk["envmap_pars_vertex"],n.ShaderChunk["lights_phong_pars_vertex"],n.ShaderChunk["color_pars_vertex"],n.ShaderChunk["morphtarget_pars_vertex"],n.ShaderChunk["skinning_pars_vertex"],n.ShaderChunk["shadowmap_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["map_vertex"],n.ShaderChunk["lightmap_vertex"],n.ShaderChunk["color_vertex"],n.ShaderChunk["morphnormal_vertex"],n.ShaderChunk["skinbase_vertex"],n.ShaderChunk["skinnormal_vertex"],n.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",n.ShaderChunk["morphtarget_vertex"],n.ShaderChunk["skinning_vertex"],n.ShaderChunk["default_vertex"],n.ShaderChunk["logdepthbuf_vertex"],"	vViewPosition = -mvPosition.xyz;",n.ShaderChunk["worldpos_vertex"],n.ShaderChunk["envmap_vertex"],n.ShaderChunk["lights_phong_vertex"],n.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",n.ShaderChunk["common"],n.ShaderChunk["color_pars_fragment"],n.ShaderChunk["map_pars_fragment"],n.ShaderChunk["alphamap_pars_fragment"],n.ShaderChunk["lightmap_pars_fragment"],n.ShaderChunk["envmap_pars_fragment"],n.ShaderChunk["fog_pars_fragment"],n.ShaderChunk["lights_phong_pars_fragment"],n.ShaderChunk["shadowmap_pars_fragment"],n.ShaderChunk["bumpmap_pars_fragment"],n.ShaderChunk["normalmap_pars_fragment"],n.ShaderChunk["specularmap_pars_fragment"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",n.ShaderChunk["logdepthbuf_fragment"],n.ShaderChunk["map_fragment"],n.ShaderChunk["color_fragment"],n.ShaderChunk["alphamap_fragment"],n.ShaderChunk["alphatest_fragment"],n.ShaderChunk["specularmap_fragment"],n.ShaderChunk["lights_phong_fragment"],n.ShaderChunk["lightmap_fragment"],n.ShaderChunk["envmap_fragment"],n.ShaderChunk["shadowmap_fragment"],n.ShaderChunk["linear_to_gamma_fragment"],n.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib["particle"],n.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",n.ShaderChunk["common"],n.ShaderChunk["color_pars_vertex"],n.ShaderChunk["shadowmap_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["color_vertex"],"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk["logdepthbuf_vertex"],n.ShaderChunk["worldpos_vertex"],n.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",n.ShaderChunk["common"],n.ShaderChunk["color_pars_fragment"],n.ShaderChunk["map_particle_pars_fragment"],n.ShaderChunk["fog_pars_fragment"],n.ShaderChunk["shadowmap_pars_fragment"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );",n.ShaderChunk["logdepthbuf_fragment"],n.ShaderChunk["map_particle_fragment"],n.ShaderChunk["color_fragment"],n.ShaderChunk["alphatest_fragment"],"	outgoingLight = diffuseColor.rgb;",n.ShaderChunk["shadowmap_fragment"],n.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib["common"],n.UniformsLib["fog"],{
scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",n.ShaderChunk["common"],n.ShaderChunk["color_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["color_vertex"],"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",n.ShaderChunk["common"],n.ShaderChunk["color_pars_fragment"],n.ShaderChunk["fog_pars_fragment"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",n.ShaderChunk["logdepthbuf_fragment"],n.ShaderChunk["color_fragment"],"	outgoingLight = diffuseColor.rgb;",n.ShaderChunk["fog_fragment"],"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[n.ShaderChunk["common"],n.ShaderChunk["morphtarget_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["morphtarget_vertex"],n.ShaderChunk["default_vertex"],n.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",n.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",n.ShaderChunk["common"],n.ShaderChunk["morphtarget_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vNormal = normalize( normalMatrix * normal );",n.ShaderChunk["morphtarget_vertex"],n.ShaderChunk["default_vertex"],n.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",n.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",n.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",n.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",n.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",n.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[n.ShaderChunk["common"],n.ShaderChunk["morphtarget_pars_vertex"],n.ShaderChunk["skinning_pars_vertex"],n.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",n.ShaderChunk["skinbase_vertex"],n.ShaderChunk["morphtarget_vertex"],n.ShaderChunk["skinning_vertex"],n.ShaderChunk["default_vertex"],n.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[n.ShaderChunk["common"],n.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",n.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}};n.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",n.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),r=e.context!==undefined?e.context:null,i=1,a=e.precision!==undefined?e.precision:"highp",o=e.alpha!==undefined?e.alpha:false,s=e.depth!==undefined?e.depth:true,h=e.stencil!==undefined?e.stencil:true,l=e.antialias!==undefined?e.antialias:false,u=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,c=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,f=e.logarithmicDepthBuffer!==undefined?e.logarithmicDepthBuffer:false,d=new n.Color(0),p=0;var m=[];var v={};var g=[];var y=[];var x=[];var _=[];var b=[];this.domElement=t;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=n.PCFShadowMap;this.shadowMapCullFace=n.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var w=this,M=[],S=null,C=null,T=-1,E="",A=null,L=0,P=0,R=0,F=t.width,B=t.height,U=0,D=0,k=new n.Frustum,V=new n.Matrix4,N=new n.Vector3,O=new n.Vector3,z=true,I={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var G;try{var H={alpha:o,depth:s,stencil:h,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:c};G=r||t.getContext("webgl",H)||t.getContext("experimental-webgl",H);if(G===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}t.addEventListener("webglcontextlost",function(e){e.preventDefault();K();Y();v={}},false)}catch(W){n.error("THREE.WebGLRenderer: "+W)}var j=new n.WebGLState(G,Pt);if(G.getShaderPrecisionFormat===undefined){G.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var X=new n.WebGLExtensions(G);X.get("OES_texture_float");X.get("OES_texture_float_linear");X.get("OES_texture_half_float");X.get("OES_texture_half_float_linear");X.get("OES_standard_derivatives");if(f){X.get("EXT_frag_depth")}var q=function(e,t,r,i){if(u===true){e*=i;t*=i;r*=i}G.clearColor(e,t,r,i)};var Y=function(){G.clearColor(0,0,0,1);G.clearDepth(1);G.clearStencil(0);G.enable(G.DEPTH_TEST);G.depthFunc(G.LEQUAL);G.frontFace(G.CCW);G.cullFace(G.BACK);G.enable(G.CULL_FACE);G.enable(G.BLEND);G.blendEquation(G.FUNC_ADD);G.blendFunc(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA);G.viewport(P,R,F,B);q(d.r,d.g,d.b,p)};var K=function(){S=null;A=null;E="";T=-1;z=true;j.reset()};Y();this.context=G;this.state=j;var Q=G.getParameter(G.MAX_TEXTURE_IMAGE_UNITS);var Z=G.getParameter(G.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var J=G.getParameter(G.MAX_TEXTURE_SIZE);var $=G.getParameter(G.MAX_CUBE_MAP_TEXTURE_SIZE);var ee=Z>0;var te=ee&&X.get("OES_texture_float");var re=G.getShaderPrecisionFormat(G.VERTEX_SHADER,G.HIGH_FLOAT);var ie=G.getShaderPrecisionFormat(G.VERTEX_SHADER,G.MEDIUM_FLOAT);var ne=G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.HIGH_FLOAT);var ae=G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.MEDIUM_FLOAT);var oe=function(){var e;return function(){if(e!==undefined){return e}e=[];if(X.get("WEBGL_compressed_texture_pvrtc")||X.get("WEBGL_compressed_texture_s3tc")){var t=G.getParameter(G.COMPRESSED_TEXTURE_FORMATS);for(var r=0;r<t.length;r++){e.push(t[r])}}return e}}();var se=re.precision>0&&ne.precision>0;var he=ie.precision>0&&ae.precision>0;if(a==="highp"&&!se){if(he){a="mediump";n.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{a="lowp";n.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(a==="mediump"&&!he){a="lowp";n.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var le=new n.ShadowMapPlugin(this,m,v,g);var ue=new n.SpritePlugin(this,_);var ce=new n.LensFlarePlugin(this,b);this.getContext=function(){return G};this.forceContextLoss=function(){X.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return ee};this.supportsFloatTextures=function(){return X.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return X.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){return X.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return X.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return X.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return X.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var e;return function(){if(e!==undefined){return e}var t=X.get("EXT_texture_filter_anisotropic");e=t!==null?G.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return e}}();this.getPrecision=function(){return a};this.getPixelRatio=function(){return i};this.setPixelRatio=function(e){i=e};this.setSize=function(e,r,n){t.width=e*i;t.height=r*i;if(n!==false){t.style.width=e+"px";t.style.height=r+"px"}this.setViewport(0,0,e,r)};this.setViewport=function(e,t,r,n){P=e*i;R=t*i;F=r*i;B=n*i;G.viewport(P,R,F,B)};this.setScissor=function(e,t,r,n){G.scissor(e*i,t*i,r*i,n*i)};this.enableScissorTest=function(e){e?G.enable(G.SCISSOR_TEST):G.disable(G.SCISSOR_TEST)};this.getClearColor=function(){return d};this.setClearColor=function(e,t){d.set(e);p=t!==undefined?t:1;q(d.r,d.g,d.b,p)};this.getClearAlpha=function(){return p};this.setClearAlpha=function(e){p=e;q(d.r,d.g,d.b,p)};this.clear=function(e,t,r){var i=0;if(e===undefined||e)i|=G.COLOR_BUFFER_BIT;if(t===undefined||t)i|=G.DEPTH_BUFFER_BIT;if(r===undefined||r)i|=G.STENCIL_BUFFER_BIT;G.clear(i)};this.clearColor=function(){G.clear(G.COLOR_BUFFER_BIT)};this.clearDepth=function(){G.clear(G.DEPTH_BUFFER_BIT)};this.clearStencil=function(){G.clear(G.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,r,i){this.setRenderTarget(e);this.clear(t,r,i)};this.resetGLState=K;function fe(e){e.__webglVertexBuffer=G.createBuffer();e.__webglColorBuffer=G.createBuffer();w.info.memory.geometries++}function de(e){e.__webglVertexBuffer=G.createBuffer();e.__webglColorBuffer=G.createBuffer();e.__webglLineDistanceBuffer=G.createBuffer();w.info.memory.geometries++}function pe(e){e.__webglVertexBuffer=G.createBuffer();e.__webglNormalBuffer=G.createBuffer();e.__webglTangentBuffer=G.createBuffer();e.__webglColorBuffer=G.createBuffer();e.__webglUVBuffer=G.createBuffer();e.__webglUV2Buffer=G.createBuffer();e.__webglSkinIndicesBuffer=G.createBuffer();e.__webglSkinWeightsBuffer=G.createBuffer();e.__webglFaceBuffer=G.createBuffer();e.__webglLineBuffer=G.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var r=0,i=t;r<i;r++){e.__webglMorphTargetsBuffers.push(G.createBuffer())}}var n=e.numMorphNormals;if(n){e.__webglMorphNormalsBuffers=[];for(var r=0,i=n;r<i;r++){e.__webglMorphNormalsBuffers.push(G.createBuffer())}}w.info.memory.geometries++}var me=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",me);et(e)})};var ve=function(e){var t=e.target;t.removeEventListener("dispose",ve);be(t)};var ge=function(e){var t=e.target;t.removeEventListener("dispose",ge);we(t);w.info.memory.textures--};var ye=function(e){var t=e.target;t.removeEventListener("dispose",ye);Me(t);w.info.memory.textures--};var xe=function(e){var t=e.target;t.removeEventListener("dispose",xe);Se(t)};var _e=function(e){var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var r=0,i=t.length;r<i;r++){var n=t[r];if(e[n]!==undefined){G.deleteBuffer(e[n]);delete e[n]}}if(e.__webglCustomAttributesList!==undefined){for(var n in e.__webglCustomAttributesList){G.deleteBuffer(e.__webglCustomAttributesList[n].buffer)}delete e.__webglCustomAttributesList}w.info.memory.geometries--};var be=function(e){delete e.__webglInit;if(e instanceof n.BufferGeometry){for(var t in e.attributes){var r=e.attributes[t];if(r.buffer!==undefined){G.deleteBuffer(r.buffer);delete r.buffer}}w.info.memory.geometries--}else{var i=je[e.id];if(i!==undefined){for(var a=0,o=i.length;a<o;a++){var s=i[a];if(s.numMorphTargets!==undefined){for(var h=0,l=s.numMorphTargets;h<l;h++){G.deleteBuffer(s.__webglMorphTargetsBuffers[h])}delete s.__webglMorphTargetsBuffers}if(s.numMorphNormals!==undefined){for(var h=0,l=s.numMorphNormals;h<l;h++){G.deleteBuffer(s.__webglMorphNormalsBuffers[h])}delete s.__webglMorphNormalsBuffers}_e(s)}delete je[e.id]}else{_e(e)}}E=""};var we=function(e){if(e.image&&e.image.__webglTextureCube){G.deleteTexture(e.image.__webglTextureCube);delete e.image.__webglTextureCube}else{if(e.__webglInit===undefined)return;G.deleteTexture(e.__webglTexture);delete e.__webglTexture;delete e.__webglInit}};var Me=function(e){if(!e||e.__webglTexture===undefined)return;G.deleteTexture(e.__webglTexture);delete e.__webglTexture;if(e instanceof n.WebGLRenderTargetCube){for(var t=0;t<6;t++){G.deleteFramebuffer(e.__webglFramebuffer[t]);G.deleteRenderbuffer(e.__webglRenderbuffer[t])}}else{G.deleteFramebuffer(e.__webglFramebuffer);G.deleteRenderbuffer(e.__webglRenderbuffer)}delete e.__webglFramebuffer;delete e.__webglRenderbuffer};var Se=function(e){var t=e.program.program;if(t===undefined)return;e.program=undefined;var r,i,n;var a=false;for(r=0,i=M.length;r<i;r++){n=M[r];if(n.program===t){n.usedTimes--;if(n.usedTimes===0){a=true}break}}if(a===true){var o=[];for(r=0,i=M.length;r<i;r++){n=M[r];if(n.program!==t){o.push(n)}}M=o;G.deleteProgram(t);w.info.memory.programs--}};function Ce(e){var t=e.geometry;var r=e.material;var i=t.vertices.length;if(r.attributes){if(t.__webglCustomAttributesList===undefined){t.__webglCustomAttributesList=[]}for(var n in r.attributes){var a=r.attributes[n];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=true;var o=1;if(a.type==="v2")o=2;else if(a.type==="v3")o=3;else if(a.type==="v4")o=4;else if(a.type==="c")o=3;a.size=o;a.array=new Float32Array(i*o);a.buffer=G.createBuffer();a.buffer.belongsToAttribute=n;a.needsUpdate=true}t.__webglCustomAttributesList.push(a)}}}function Te(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(r*3);e.__colorArray=new Float32Array(r*3);e.__webglParticleCount=r;Ce(t)}function Ee(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(r*3);e.__colorArray=new Float32Array(r*3);e.__lineDistanceArray=new Float32Array(r*1);e.__webglLineCount=r;Ce(t)}function Ae(e,t){var r=t.geometry,i=e.faces3,n=i.length*3,a=i.length*1,o=i.length*3,s=Le(t,e);e.__vertexArray=new Float32Array(n*3);e.__normalArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__uvArray=new Float32Array(n*2);if(r.faceVertexUvs.length>1){e.__uv2Array=new Float32Array(n*2)}if(r.hasTangents){e.__tangentArray=new Float32Array(n*4)}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(n*4);e.__skinWeightArray=new Float32Array(n*4)}var h=X.get("OES_element_index_uint")!==null&&a>21845?Uint32Array:Uint16Array;e.__typeArray=h;e.__faceArray=new h(a*3);e.__lineArray=new h(o*2);var l=e.numMorphTargets;if(l){e.__morphTargetsArrays=[];for(var u=0,c=l;u<c;u++){e.__morphTargetsArrays.push(new Float32Array(n*3))}}var f=e.numMorphNormals;if(f){e.__morphNormalsArrays=[];for(var u=0,c=f;u<c;u++){e.__morphNormalsArrays.push(new Float32Array(n*3))}}e.__webglFaceCount=a*3;e.__webglLineCount=o*2;if(s.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var d in s.attributes){var p=s.attributes[d];var m={};for(var v in p){m[v]=p[v]}if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=true;var g=1;if(m.type==="v2")g=2;else if(m.type==="v3")g=3;else if(m.type==="v4")g=4;else if(m.type==="c")g=3;m.size=g;m.array=new Float32Array(n*g);m.buffer=G.createBuffer();m.buffer.belongsToAttribute=d;p.needsUpdate=true;m.__original=p}e.__webglCustomAttributesList.push(m)}}e.__inittedArrays=true}function Le(e,t){return e.material instanceof n.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Pe(e){return e instanceof n.MeshPhongMaterial===false&&e.shading===n.FlatShading}function Re(e,t,r){var i,n,a,o,s,h=e.vertices,l=h.length,u=e.colors,c=u.length,f=e.__vertexArray,d=e.__colorArray,p=e.verticesNeedUpdate,m=e.colorsNeedUpdate,v=e.__webglCustomAttributesList,g,y,x,_,b,w;if(p){for(i=0;i<l;i++){a=h[i];o=i*3;f[o]=a.x;f[o+1]=a.y;f[o+2]=a.z}G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer);G.bufferData(G.ARRAY_BUFFER,f,t)}if(m){for(n=0;n<c;n++){s=u[n];o=n*3;d[o]=s.r;d[o+1]=s.g;d[o+2]=s.b}G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer);G.bufferData(G.ARRAY_BUFFER,d,t)}if(v){for(g=0,y=v.length;g<y;g++){w=v[g];if(w.needsUpdate&&(w.boundTo===undefined||w.boundTo==="vertices")){_=w.value.length;o=0;if(w.size===1){for(x=0;x<_;x++){w.array[x]=w.value[x]}}else if(w.size===2){for(x=0;x<_;x++){b=w.value[x];w.array[o]=b.x;w.array[o+1]=b.y;o+=2}}else if(w.size===3){if(w.type==="c"){for(x=0;x<_;x++){b=w.value[x];w.array[o]=b.r;w.array[o+1]=b.g;w.array[o+2]=b.b;o+=3}}else{for(x=0;x<_;x++){b=w.value[x];w.array[o]=b.x;w.array[o+1]=b.y;w.array[o+2]=b.z;o+=3}}}else if(w.size===4){for(x=0;x<_;x++){b=w.value[x];w.array[o]=b.x;w.array[o+1]=b.y;w.array[o+2]=b.z;w.array[o+3]=b.w;o+=4}}}G.bindBuffer(G.ARRAY_BUFFER,w.buffer);G.bufferData(G.ARRAY_BUFFER,w.array,t);w.needsUpdate=false}}}function Fe(e,t){var r,i,n,a,o,s,h=e.vertices,l=e.colors,u=e.lineDistances,c=h.length,f=l.length,d=u.length,p=e.__vertexArray,m=e.__colorArray,v=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,x=e.lineDistancesNeedUpdate,_=e.__webglCustomAttributesList,b,w,M,S,C,T;if(g){for(r=0;r<c;r++){a=h[r];o=r*3;p[o]=a.x;p[o+1]=a.y;p[o+2]=a.z}G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer);G.bufferData(G.ARRAY_BUFFER,p,t)}if(y){for(i=0;i<f;i++){s=l[i];o=i*3;m[o]=s.r;m[o+1]=s.g;m[o+2]=s.b}G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer);G.bufferData(G.ARRAY_BUFFER,m,t)}if(x){for(n=0;n<d;n++){v[n]=u[n]}G.bindBuffer(G.ARRAY_BUFFER,e.__webglLineDistanceBuffer);G.bufferData(G.ARRAY_BUFFER,v,t)}if(_){for(b=0,w=_.length;b<w;b++){T=_[b];if(T.needsUpdate&&(T.boundTo===undefined||T.boundTo==="vertices")){o=0;S=T.value.length;if(T.size===1){for(M=0;M<S;M++){T.array[M]=T.value[M]}}else if(T.size===2){for(M=0;M<S;M++){C=T.value[M];T.array[o]=C.x;T.array[o+1]=C.y;o+=2}}else if(T.size===3){if(T.type==="c"){for(M=0;M<S;M++){C=T.value[M];T.array[o]=C.r;T.array[o+1]=C.g;T.array[o+2]=C.b;o+=3}}else{for(M=0;M<S;M++){C=T.value[M];T.array[o]=C.x;T.array[o+1]=C.y;T.array[o+2]=C.z;o+=3}}}else if(T.size===4){for(M=0;M<S;M++){C=T.value[M];T.array[o]=C.x;T.array[o+1]=C.y;T.array[o+2]=C.z;T.array[o+3]=C.w;o+=4}}G.bindBuffer(G.ARRAY_BUFFER,T.buffer);G.bufferData(G.ARRAY_BUFFER,T.array,t);T.needsUpdate=false}}}}function Be(e,t,r,i,a){if(!e.__inittedArrays){return}var o=Pe(a);var s,h,l,u,c,f,d,p,m,v,g,y,x,_,b,w,M,S,C,T,E,A,L,P,R,F,B,U,D,k,V,N,O,z,I,H,W,j,X,q,Y=0,K=0,Q=0,Z=0,J=0,$=0,ee=0,te=0,re=0,ie=0,ne=0,ae=0,oe,se=e.__vertexArray,he=e.__uvArray,le=e.__uv2Array,ue=e.__normalArray,ce=e.__tangentArray,fe=e.__colorArray,de=e.__skinIndexArray,pe=e.__skinWeightArray,me=e.__morphTargetsArrays,ve=e.__morphNormalsArrays,ge=e.__webglCustomAttributesList,ye,xe=e.__faceArray,_e=e.__lineArray,be=t.geometry,we=be.verticesNeedUpdate,Me=be.elementsNeedUpdate,Se=be.uvsNeedUpdate,Ce=be.normalsNeedUpdate,Te=be.tangentsNeedUpdate,Ee=be.colorsNeedUpdate,Ae=be.morphTargetsNeedUpdate,Le=be.vertices,Re=e.faces3,Fe=be.faces,Be=be.faceVertexUvs[0],Ue=be.faceVertexUvs[1],De=be.skinIndices,ke=be.skinWeights,Ve=be.morphTargets,Ne=be.morphNormals;if(we){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];y=Le[u.a];x=Le[u.b];_=Le[u.c];se[K]=y.x;se[K+1]=y.y;se[K+2]=y.z;se[K+3]=x.x;se[K+4]=x.y;se[K+5]=x.z;se[K+6]=_.x;se[K+7]=_.y;se[K+8]=_.z;K+=9}G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer);G.bufferData(G.ARRAY_BUFFER,se,r)}if(Ae){for(I=0,H=Ve.length;I<H;I++){ne=0;for(s=0,h=Re.length;s<h;s++){X=Re[s];u=Fe[X];y=Ve[I].vertices[u.a];x=Ve[I].vertices[u.b];_=Ve[I].vertices[u.c];W=me[I];W[ne]=y.x;W[ne+1]=y.y;W[ne+2]=y.z;W[ne+3]=x.x;W[ne+4]=x.y;W[ne+5]=x.z;W[ne+6]=_.x;W[ne+7]=_.y;W[ne+8]=_.z;if(a.morphNormals){if(o){S=Ne[I].faceNormals[X];C=S;T=S}else{q=Ne[I].vertexNormals[X];S=q.a;C=q.b;T=q.c}j=ve[I];j[ne]=S.x;j[ne+1]=S.y;j[ne+2]=S.z;j[ne+3]=C.x;j[ne+4]=C.y;j[ne+5]=C.z;j[ne+6]=T.x;j[ne+7]=T.y;j[ne+8]=T.z}ne+=9}G.bindBuffer(G.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[I]);G.bufferData(G.ARRAY_BUFFER,me[I],r);if(a.morphNormals){G.bindBuffer(G.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[I]);G.bufferData(G.ARRAY_BUFFER,ve[I],r)}}}if(ke.length){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];P=ke[u.a];R=ke[u.b];F=ke[u.c];pe[ie]=P.x;pe[ie+1]=P.y;pe[ie+2]=P.z;pe[ie+3]=P.w;pe[ie+4]=R.x;pe[ie+5]=R.y;pe[ie+6]=R.z;pe[ie+7]=R.w;pe[ie+8]=F.x;pe[ie+9]=F.y;pe[ie+10]=F.z;pe[ie+11]=F.w;B=De[u.a];U=De[u.b];D=De[u.c];de[ie]=B.x;de[ie+1]=B.y;de[ie+2]=B.z;de[ie+3]=B.w;de[ie+4]=U.x;de[ie+5]=U.y;de[ie+6]=U.z;de[ie+7]=U.w;de[ie+8]=D.x;de[ie+9]=D.y;de[ie+10]=D.z;de[ie+11]=D.w;ie+=12}if(ie>0){G.bindBuffer(G.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);G.bufferData(G.ARRAY_BUFFER,de,r);G.bindBuffer(G.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);G.bufferData(G.ARRAY_BUFFER,pe,r)}}if(Ee){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];d=u.vertexColors;p=u.color;if(d.length===3&&a.vertexColors===n.VertexColors){E=d[0];A=d[1];L=d[2]}else{E=p;A=p;L=p}fe[re]=E.r;fe[re+1]=E.g;fe[re+2]=E.b;fe[re+3]=A.r;fe[re+4]=A.g;fe[re+5]=A.b;fe[re+6]=L.r;fe[re+7]=L.g;fe[re+8]=L.b;re+=9}if(re>0){G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer);G.bufferData(G.ARRAY_BUFFER,fe,r)}}if(Te&&be.hasTangents){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];m=u.vertexTangents;b=m[0];w=m[1];M=m[2];ce[ee]=b.x;ce[ee+1]=b.y;ce[ee+2]=b.z;ce[ee+3]=b.w;ce[ee+4]=w.x;ce[ee+5]=w.y;ce[ee+6]=w.z;ce[ee+7]=w.w;ce[ee+8]=M.x;ce[ee+9]=M.y;ce[ee+10]=M.z;ce[ee+11]=M.w;ee+=12}G.bindBuffer(G.ARRAY_BUFFER,e.__webglTangentBuffer);G.bufferData(G.ARRAY_BUFFER,ce,r)}if(Ce){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];c=u.vertexNormals;f=u.normal;if(c.length===3&&o===false){for(k=0;k<3;k++){N=c[k];ue[$]=N.x;ue[$+1]=N.y;ue[$+2]=N.z;$+=3}}else{for(k=0;k<3;k++){ue[$]=f.x;ue[$+1]=f.y;ue[$+2]=f.z;$+=3}}}G.bindBuffer(G.ARRAY_BUFFER,e.__webglNormalBuffer);G.bufferData(G.ARRAY_BUFFER,ue,r)}if(Se&&Be){for(s=0,h=Re.length;s<h;s++){l=Re[s];v=Be[l];if(v===undefined)continue;for(k=0;k<3;k++){O=v[k];he[Q]=O.x;he[Q+1]=O.y;Q+=2}}if(Q>0){G.bindBuffer(G.ARRAY_BUFFER,e.__webglUVBuffer);G.bufferData(G.ARRAY_BUFFER,he,r)}}if(Se&&Ue){for(s=0,h=Re.length;s<h;s++){l=Re[s];g=Ue[l];if(g===undefined)continue;for(k=0;k<3;k++){z=g[k];le[Z]=z.x;le[Z+1]=z.y;Z+=2}}if(Z>0){G.bindBuffer(G.ARRAY_BUFFER,e.__webglUV2Buffer);G.bufferData(G.ARRAY_BUFFER,le,r)}}if(Me){for(s=0,h=Re.length;s<h;s++){xe[J]=Y;xe[J+1]=Y+1;xe[J+2]=Y+2;J+=3;_e[te]=Y;_e[te+1]=Y+1;_e[te+2]=Y;_e[te+3]=Y+2;_e[te+4]=Y+1;_e[te+5]=Y+2;te+=6;Y+=3}G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);G.bufferData(G.ELEMENT_ARRAY_BUFFER,xe,r);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);G.bufferData(G.ELEMENT_ARRAY_BUFFER,_e,r)}if(ge){for(k=0,V=ge.length;k<V;k++){ye=ge[k];if(!ye.__original.needsUpdate)continue;ae=0;if(ye.size===1){if(ye.boundTo===undefined||ye.boundTo==="vertices"){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];ye.array[ae]=ye.value[u.a];ye.array[ae+1]=ye.value[u.b];ye.array[ae+2]=ye.value[u.c];ae+=3}}else if(ye.boundTo==="faces"){for(s=0,h=Re.length;s<h;s++){oe=ye.value[Re[s]];ye.array[ae]=oe;ye.array[ae+1]=oe;ye.array[ae+2]=oe;ae+=3}}}else if(ye.size===2){if(ye.boundTo===undefined||ye.boundTo==="vertices"){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];y=ye.value[u.a];x=ye.value[u.b];_=ye.value[u.c];ye.array[ae]=y.x;ye.array[ae+1]=y.y;ye.array[ae+2]=x.x;ye.array[ae+3]=x.y;ye.array[ae+4]=_.x;ye.array[ae+5]=_.y;ae+=6}}else if(ye.boundTo==="faces"){for(s=0,h=Re.length;s<h;s++){oe=ye.value[Re[s]];y=oe;x=oe;_=oe;ye.array[ae]=y.x;ye.array[ae+1]=y.y;ye.array[ae+2]=x.x;ye.array[ae+3]=x.y;ye.array[ae+4]=_.x;ye.array[ae+5]=_.y;ae+=6}}}else if(ye.size===3){var Oe;if(ye.type==="c"){Oe=["r","g","b"]}else{Oe=["x","y","z"]}if(ye.boundTo===undefined||ye.boundTo==="vertices"){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];y=ye.value[u.a];x=ye.value[u.b];_=ye.value[u.c];ye.array[ae]=y[Oe[0]];ye.array[ae+1]=y[Oe[1]];ye.array[ae+2]=y[Oe[2]];ye.array[ae+3]=x[Oe[0]];ye.array[ae+4]=x[Oe[1]];ye.array[ae+5]=x[Oe[2]];ye.array[ae+6]=_[Oe[0]];ye.array[ae+7]=_[Oe[1]];ye.array[ae+8]=_[Oe[2]];ae+=9}}else if(ye.boundTo==="faces"){for(s=0,h=Re.length;s<h;s++){oe=ye.value[Re[s]];y=oe;x=oe;_=oe;ye.array[ae]=y[Oe[0]];ye.array[ae+1]=y[Oe[1]];ye.array[ae+2]=y[Oe[2]];ye.array[ae+3]=x[Oe[0]];ye.array[ae+4]=x[Oe[1]];ye.array[ae+5]=x[Oe[2]];ye.array[ae+6]=_[Oe[0]];ye.array[ae+7]=_[Oe[1]];ye.array[ae+8]=_[Oe[2]];ae+=9}}else if(ye.boundTo==="faceVertices"){for(s=0,h=Re.length;s<h;s++){oe=ye.value[Re[s]];y=oe[0];x=oe[1];_=oe[2];ye.array[ae]=y[Oe[0]];ye.array[ae+1]=y[Oe[1]];ye.array[ae+2]=y[Oe[2]];ye.array[ae+3]=x[Oe[0]];ye.array[ae+4]=x[Oe[1]];ye.array[ae+5]=x[Oe[2]];ye.array[ae+6]=_[Oe[0]];ye.array[ae+7]=_[Oe[1]];ye.array[ae+8]=_[Oe[2]];ae+=9}}}else if(ye.size===4){if(ye.boundTo===undefined||ye.boundTo==="vertices"){for(s=0,h=Re.length;s<h;s++){u=Fe[Re[s]];y=ye.value[u.a];x=ye.value[u.b];_=ye.value[u.c];ye.array[ae]=y.x;ye.array[ae+1]=y.y;ye.array[ae+2]=y.z;ye.array[ae+3]=y.w;ye.array[ae+4]=x.x;ye.array[ae+5]=x.y;ye.array[ae+6]=x.z;ye.array[ae+7]=x.w;ye.array[ae+8]=_.x;ye.array[ae+9]=_.y;ye.array[ae+10]=_.z;ye.array[ae+11]=_.w;ae+=12}}else if(ye.boundTo==="faces"){for(s=0,h=Re.length;s<h;s++){oe=ye.value[Re[s]];y=oe;x=oe;_=oe;ye.array[ae]=y.x;ye.array[ae+1]=y.y;ye.array[ae+2]=y.z;ye.array[ae+3]=y.w;ye.array[ae+4]=x.x;ye.array[ae+5]=x.y;ye.array[ae+6]=x.z;ye.array[ae+7]=x.w;ye.array[ae+8]=_.x;ye.array[ae+9]=_.y;ye.array[ae+10]=_.z;ye.array[ae+11]=_.w;ae+=12}}else if(ye.boundTo==="faceVertices"){for(s=0,h=Re.length;s<h;s++){oe=ye.value[Re[s]];y=oe[0];x=oe[1];_=oe[2];ye.array[ae]=y.x;ye.array[ae+1]=y.y;ye.array[ae+2]=y.z;ye.array[ae+3]=y.w;ye.array[ae+4]=x.x;ye.array[ae+5]=x.y;ye.array[ae+6]=x.z;ye.array[ae+7]=x.w;ye.array[ae+8]=_.x;ye.array[ae+9]=_.y;ye.array[ae+10]=_.z;ye.array[ae+11]=_.w;ae+=12}}}G.bindBuffer(G.ARRAY_BUFFER,ye.buffer);G.bufferData(G.ARRAY_BUFFER,ye.array,r)}}if(i){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}this.renderBufferImmediate=function(e,t,r){j.initAttributes();if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=G.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=G.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=G.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=G.createBuffer();if(e.hasPositions){G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer);G.bufferData(G.ARRAY_BUFFER,e.positionArray,G.DYNAMIC_DRAW);j.enableAttribute(t.attributes.position);G.vertexAttribPointer(t.attributes.position,3,G.FLOAT,false,0,0)}if(e.hasNormals){G.bindBuffer(G.ARRAY_BUFFER,e.__webglNormalBuffer);if(r instanceof n.MeshPhongMaterial===false&&r.shading===n.FlatShading){var i,a,o,s,h,l,u,c,f,d,p,m,v,g,y=e.count*3;for(g=0;g<y;g+=9){v=e.normalArray;s=v[g];u=v[g+1];d=v[g+2];h=v[g+3];c=v[g+4];p=v[g+5];l=v[g+6];f=v[g+7];m=v[g+8];i=(s+h+l)/3;a=(u+c+f)/3;o=(d+p+m)/3;v[g]=i;v[g+1]=a;v[g+2]=o;v[g+3]=i;v[g+4]=a;v[g+5]=o;v[g+6]=i;v[g+7]=a;v[g+8]=o}}G.bufferData(G.ARRAY_BUFFER,e.normalArray,G.DYNAMIC_DRAW);j.enableAttribute(t.attributes.normal);G.vertexAttribPointer(t.attributes.normal,3,G.FLOAT,false,0,0)}if(e.hasUvs&&r.map){G.bindBuffer(G.ARRAY_BUFFER,e.__webglUvBuffer);G.bufferData(G.ARRAY_BUFFER,e.uvArray,G.DYNAMIC_DRAW);j.enableAttribute(t.attributes.uv);G.vertexAttribPointer(t.attributes.uv,2,G.FLOAT,false,0,0)}if(e.hasColors&&r.vertexColors!==n.NoColors){G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer);G.bufferData(G.ARRAY_BUFFER,e.colorArray,G.DYNAMIC_DRAW);j.enableAttribute(t.attributes.color);G.vertexAttribPointer(t.attributes.color,3,G.FLOAT,false,0,0)}j.disableUnusedAttributes();G.drawArrays(G.TRIANGLES,0,e.count);e.count=0};function Ue(e,t,r,i){var n=r.attributes;var a=t.attributes;var o=t.attributesKeys;for(var s=0,h=o.length;s<h;s++){var l=o[s];var u=a[l];if(u>=0){var c=n[l];if(c!==undefined){var f=c.itemSize;G.bindBuffer(G.ARRAY_BUFFER,c.buffer);j.enableAttribute(u);G.vertexAttribPointer(u,f,G.FLOAT,false,0,i*f*4)}else if(e.defaultAttributeValues!==undefined){if(e.defaultAttributeValues[l].length===2){G.vertexAttrib2fv(u,e.defaultAttributeValues[l])}else if(e.defaultAttributeValues[l].length===3){G.vertexAttrib3fv(u,e.defaultAttributeValues[l])}}}}j.disableUnusedAttributes()}this.renderBufferDirect=function(e,t,r,a,o,s){if(a.visible===false)return;Ze(s);var h=at(e,t,r,a,s);var l=false,u=a.wireframe?1:0,c="direct_"+o.id+"_"+h.id+"_"+u;if(c!==E){E=c;l=true}if(l){j.initAttributes()}if(s instanceof n.Mesh){var f=a.wireframe===true?G.LINES:G.TRIANGLES;var d=o.attributes.index;if(d){var p,m;if(d.array instanceof Uint32Array&&X.get("OES_element_index_uint")){p=G.UNSIGNED_INT;m=4}else{p=G.UNSIGNED_SHORT;m=2}var v=o.offsets;if(v.length===0){if(l){Ue(a,h,o,0);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,d.buffer)}G.drawElements(f,d.array.length,p,0);w.info.render.calls++;w.info.render.vertices+=d.array.length;w.info.render.faces+=d.array.length/3}else{l=true;for(var g=0,y=v.length;g<y;g++){var x=v[g].index;if(l){Ue(a,h,o,x);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,d.buffer)}G.drawElements(f,v[g].count,p,v[g].start*m);w.info.render.calls++;w.info.render.vertices+=v[g].count;w.info.render.faces+=v[g].count/3}}}else{if(l){Ue(a,h,o,0)}var _=o.attributes["position"];G.drawArrays(f,0,_.array.length/_.itemSize);w.info.render.calls++;w.info.render.vertices+=_.array.length/_.itemSize;w.info.render.faces+=_.array.length/(3*_.itemSize)}}else if(s instanceof n.PointCloud){var f=G.POINTS;var d=o.attributes.index;if(d){var p,m;if(d.array instanceof Uint32Array&&X.get("OES_element_index_uint")){p=G.UNSIGNED_INT;m=4}else{p=G.UNSIGNED_SHORT;m=2}var v=o.offsets;if(v.length===0){if(l){Ue(a,h,o,0);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,d.buffer)}G.drawElements(f,d.array.length,p,0);

w.info.render.calls++;w.info.render.points+=d.array.length}else{if(v.length>1)l=true;for(var g=0,y=v.length;g<y;g++){var x=v[g].index;if(l){Ue(a,h,o,x);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,d.buffer)}G.drawElements(f,v[g].count,p,v[g].start*m);w.info.render.calls++;w.info.render.points+=v[g].count}}}else{if(l){Ue(a,h,o,0)}var _=o.attributes.position;var v=o.offsets;if(v.length===0){G.drawArrays(f,0,_.array.length/3);w.info.render.calls++;w.info.render.points+=_.array.length/3}else{for(var g=0,y=v.length;g<y;g++){G.drawArrays(f,v[g].index,v[g].count);w.info.render.calls++;w.info.render.points+=v[g].count}}}}else if(s instanceof n.Line){var f=s.mode===n.LineStrip?G.LINE_STRIP:G.LINES;j.setLineWidth(a.linewidth*i);var d=o.attributes.index;if(d){var p,m;if(d.array instanceof Uint32Array){p=G.UNSIGNED_INT;m=4}else{p=G.UNSIGNED_SHORT;m=2}var v=o.offsets;if(v.length===0){if(l){Ue(a,h,o,0);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,d.buffer)}G.drawElements(f,d.array.length,p,0);w.info.render.calls++;w.info.render.vertices+=d.array.length}else{if(v.length>1)l=true;for(var g=0,y=v.length;g<y;g++){var x=v[g].index;if(l){Ue(a,h,o,x);G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,d.buffer)}G.drawElements(f,v[g].count,p,v[g].start*m);w.info.render.calls++;w.info.render.vertices+=v[g].count}}}else{if(l){Ue(a,h,o,0)}var _=o.attributes.position;var v=o.offsets;if(v.length===0){G.drawArrays(f,0,_.array.length/3);w.info.render.calls++;w.info.render.vertices+=_.array.length/3}else{for(var g=0,y=v.length;g<y;g++){G.drawArrays(f,v[g].index,v[g].count);w.info.render.calls++;w.info.render.vertices+=v[g].count}}}}};this.renderBuffer=function(e,t,r,a,o,s){if(a.visible===false)return;Ze(s);var h=at(e,t,r,a,s);var l=h.attributes;var u=false,c=a.wireframe?1:0,f=o.id+"_"+h.id+"_"+c;if(f!==E){E=f;u=true}if(u){j.initAttributes()}if(!a.morphTargets&&l.position>=0){if(u){G.bindBuffer(G.ARRAY_BUFFER,o.__webglVertexBuffer);j.enableAttribute(l.position);G.vertexAttribPointer(l.position,3,G.FLOAT,false,0,0)}}else{if(s.morphTargetBase){De(a,o,s)}}if(u){if(o.__webglCustomAttributesList){for(var d=0,p=o.__webglCustomAttributesList.length;d<p;d++){var m=o.__webglCustomAttributesList[d];if(l[m.buffer.belongsToAttribute]>=0){G.bindBuffer(G.ARRAY_BUFFER,m.buffer);j.enableAttribute(l[m.buffer.belongsToAttribute]);G.vertexAttribPointer(l[m.buffer.belongsToAttribute],m.size,G.FLOAT,false,0,0)}}}if(l.color>=0){if(s.geometry.colors.length>0||s.geometry.faces.length>0){G.bindBuffer(G.ARRAY_BUFFER,o.__webglColorBuffer);j.enableAttribute(l.color);G.vertexAttribPointer(l.color,3,G.FLOAT,false,0,0)}else if(a.defaultAttributeValues!==undefined){G.vertexAttrib3fv(l.color,a.defaultAttributeValues.color)}}if(l.normal>=0){G.bindBuffer(G.ARRAY_BUFFER,o.__webglNormalBuffer);j.enableAttribute(l.normal);G.vertexAttribPointer(l.normal,3,G.FLOAT,false,0,0)}if(l.tangent>=0){G.bindBuffer(G.ARRAY_BUFFER,o.__webglTangentBuffer);j.enableAttribute(l.tangent);G.vertexAttribPointer(l.tangent,4,G.FLOAT,false,0,0)}if(l.uv>=0){if(s.geometry.faceVertexUvs[0]){G.bindBuffer(G.ARRAY_BUFFER,o.__webglUVBuffer);j.enableAttribute(l.uv);G.vertexAttribPointer(l.uv,2,G.FLOAT,false,0,0)}else if(a.defaultAttributeValues!==undefined){G.vertexAttrib2fv(l.uv,a.defaultAttributeValues.uv)}}if(l.uv2>=0){if(s.geometry.faceVertexUvs[1]){G.bindBuffer(G.ARRAY_BUFFER,o.__webglUV2Buffer);j.enableAttribute(l.uv2);G.vertexAttribPointer(l.uv2,2,G.FLOAT,false,0,0)}else if(a.defaultAttributeValues!==undefined){G.vertexAttrib2fv(l.uv2,a.defaultAttributeValues.uv2)}}if(a.skinning&&l.skinIndex>=0&&l.skinWeight>=0){G.bindBuffer(G.ARRAY_BUFFER,o.__webglSkinIndicesBuffer);j.enableAttribute(l.skinIndex);G.vertexAttribPointer(l.skinIndex,4,G.FLOAT,false,0,0);G.bindBuffer(G.ARRAY_BUFFER,o.__webglSkinWeightsBuffer);j.enableAttribute(l.skinWeight);G.vertexAttribPointer(l.skinWeight,4,G.FLOAT,false,0,0)}if(l.lineDistance>=0){G.bindBuffer(G.ARRAY_BUFFER,o.__webglLineDistanceBuffer);j.enableAttribute(l.lineDistance);G.vertexAttribPointer(l.lineDistance,1,G.FLOAT,false,0,0)}}j.disableUnusedAttributes();if(s instanceof n.Mesh){var v=o.__typeArray===Uint32Array?G.UNSIGNED_INT:G.UNSIGNED_SHORT;if(a.wireframe){j.setLineWidth(a.wireframeLinewidth*i);if(u)G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer);G.drawElements(G.LINES,o.__webglLineCount,v,0)}else{if(u)G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer);G.drawElements(G.TRIANGLES,o.__webglFaceCount,v,0)}w.info.render.calls++;w.info.render.vertices+=o.__webglFaceCount;w.info.render.faces+=o.__webglFaceCount/3}else if(s instanceof n.Line){var g=s.mode===n.LineStrip?G.LINE_STRIP:G.LINES;j.setLineWidth(a.linewidth*i);G.drawArrays(g,0,o.__webglLineCount);w.info.render.calls++}else if(s instanceof n.PointCloud){G.drawArrays(G.POINTS,0,o.__webglParticleCount);w.info.render.calls++;w.info.render.points+=o.__webglParticleCount}};function De(e,t,r){var i=e.program.attributes;if(r.morphTargetBase!==-1&&i.position>=0){G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]);j.enableAttribute(i.position);G.vertexAttribPointer(i.position,3,G.FLOAT,false,0,0)}else if(i.position>=0){G.bindBuffer(G.ARRAY_BUFFER,t.__webglVertexBuffer);j.enableAttribute(i.position);G.vertexAttribPointer(i.position,3,G.FLOAT,false,0,0)}if(r.morphTargetForcedOrder.length){var n=0;var a=r.morphTargetForcedOrder;var o=r.morphTargetInfluences;var s;while(n<e.numSupportedMorphTargets&&n<a.length){s=i["morphTarget"+n];if(s>=0){G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[a[n]]);j.enableAttribute(s);G.vertexAttribPointer(s,3,G.FLOAT,false,0,0)}s=i["morphNormal"+n];if(s>=0&&e.morphNormals){G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[a[n]]);j.enableAttribute(s);G.vertexAttribPointer(s,3,G.FLOAT,false,0,0)}r.__webglMorphTargetInfluences[n]=o[a[n]];n++}}else{var h=[];var o=r.morphTargetInfluences;var l=r.geometry.morphTargets;if(o.length>l.length){console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array.");o.length=l.length}for(var u=0,c=o.length;u<c;u++){var f=o[u];h.push([f,u])}if(h.length>e.numSupportedMorphTargets){h.sort(Ne);h.length=e.numSupportedMorphTargets}else if(h.length>e.numSupportedMorphNormals){h.sort(Ne)}else if(h.length===0){h.push([0,0])}var s;for(var n=0,d=e.numSupportedMorphTargets;n<d;n++){if(h[n]){var p=h[n][1];s=i["morphTarget"+n];if(s>=0){G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]);j.enableAttribute(s);G.vertexAttribPointer(s,3,G.FLOAT,false,0,0)}s=i["morphNormal"+n];if(s>=0&&e.morphNormals){G.bindBuffer(G.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[p]);j.enableAttribute(s);G.vertexAttribPointer(s,3,G.FLOAT,false,0,0)}r.__webglMorphTargetInfluences[n]=o[p]}else{r.__webglMorphTargetInfluences[n]=0}}}if(e.program.uniforms.morphTargetInfluences!==null){G.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}}function ke(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function Ve(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function Ne(e,t){return t[0]-e[0]}this.render=function(e,t,r,i){if(t instanceof n.Camera===false){n.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var a=e.fog;E="";T=-1;A=null;z=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();e.traverse(function(e){if(e instanceof n.SkinnedMesh){e.skeleton.update()}});t.matrixWorldInverse.getInverse(t.matrixWorld);V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);k.setFromMatrix(V);m.length=0;y.length=0;x.length=0;_.length=0;b.length=0;Oe(e);if(w.sortObjects===true){y.sort(ke);x.sort(Ve)}le.render(e,t);w.info.render.calls=0;w.info.render.vertices=0;w.info.render.faces=0;w.info.render.points=0;this.setRenderTarget(r);if(this.autoClear||i){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var o=0,s=g.length;o<s;o++){var h=g[o];var l=h.object;if(l.visible){xt(l,t);Ge(h)}}if(e.overrideMaterial){var u=e.overrideMaterial;nt(u);ze(y,t,m,a,u);ze(x,t,m,a,u);Ie(g,"",t,m,a,u)}else{j.setBlending(n.NoBlending);ze(y,t,m,a,null);Ie(g,"opaque",t,m,a,null);ze(x,t,m,a,null);Ie(g,"transparent",t,m,a,null)}ue.render(e,t);ce.render(e,t,U,D);if(r&&r.generateMipmaps&&r.minFilter!==n.NearestFilter&&r.minFilter!==n.LinearFilter){At(r)}j.setDepthTest(true);j.setDepthWrite(true);j.setColorWrite(true)};function Oe(e){if(e.visible===false)return;if(e instanceof n.Scene||e instanceof n.Group){}else{We(e);if(e instanceof n.Light){m.push(e)}else if(e instanceof n.Sprite){_.push(e)}else if(e instanceof n.LensFlare){b.push(e)}else{var t=v[e.id];if(t&&(e.frustumCulled===false||k.intersectsObject(e)===true)){for(var r=0,i=t.length;r<i;r++){var a=t[r];He(a);a.render=true;if(w.sortObjects===true){N.setFromMatrixPosition(e.matrixWorld);N.applyProjection(V);a.z=N.z}}}}}for(var r=0,i=e.children.length;r<i;r++){Oe(e.children[r])}}function ze(e,t,r,i,a){var o;for(var s=0,h=e.length;s<h;s++){var l=e[s];var u=l.object;var c=l.buffer;xt(u,t);if(a){o=a}else{o=l.material;if(!o)continue;nt(o)}w.setMaterialFaces(o);if(c instanceof n.BufferGeometry){w.renderBufferDirect(t,r,i,o,c,u)}else{w.renderBuffer(t,r,i,o,c,u)}}}function Ie(e,t,r,i,n,a){var o;for(var s=0,h=e.length;s<h;s++){var l=e[s];var u=l.object;if(u.visible){if(a){o=a}else{o=l[t];if(!o)continue;nt(o)}w.renderImmediateObject(r,i,n,o,u)}}}this.renderImmediateObject=function(e,t,r,i,n){var a=at(e,t,r,i,n);E="";w.setMaterialFaces(i);if(n.immediateRenderCallback){n.immediateRenderCallback(a,G,k)}else{n.render(function(e){w.renderBufferImmediate(e,a,i)})}};function Ge(e){var t=e.object,r=t.material;if(r.transparent){e.transparent=r;e.opaque=null}else{e.opaque=r;e.transparent=null}}function He(e){var t=e.object;var r=e.buffer;var i=t.geometry;var a=t.material;if(a instanceof n.MeshFaceMaterial){var o=i instanceof n.BufferGeometry?0:r.materialIndex;a=a.materials[o];e.material=a;if(a.transparent){x.push(e)}else{y.push(e)}}else if(a){e.material=a;if(a.transparent){x.push(e)}else{y.push(e)}}}function We(e){if(e.__webglInit===undefined){e.__webglInit=true;e._modelViewMatrix=new n.Matrix4;e._normalMatrix=new n.Matrix3;e.addEventListener("removed",me)}var t=e.geometry;if(t===undefined){}else if(t.__webglInit===undefined){t.__webglInit=true;t.addEventListener("dispose",ve);if(t instanceof n.BufferGeometry){w.info.memory.geometries++}else if(e instanceof n.Mesh){Ye(e,t)}else if(e instanceof n.Line){if(t.__webglVertexBuffer===undefined){de(t);Ee(t,e);t.verticesNeedUpdate=true;t.colorsNeedUpdate=true;t.lineDistancesNeedUpdate=true}}else if(e instanceof n.PointCloud){if(t.__webglVertexBuffer===undefined){fe(t);Te(t,e);t.verticesNeedUpdate=true;t.colorsNeedUpdate=true}}}if(e.__webglActive===undefined){e.__webglActive=true;if(e instanceof n.Mesh){if(t instanceof n.BufferGeometry){Ke(v,t,e)}else if(t instanceof n.Geometry){var r=je[t.id];for(var i=0,a=r.length;i<a;i++){Ke(v,r[i],e)}}}else if(e instanceof n.Line||e instanceof n.PointCloud){Ke(v,t,e)}else if(e instanceof n.ImmediateRenderObject||e.immediateRenderCallback){Qe(g,e)}}}var je={};var Xe=0;function qe(e,t){var r=X.get("OES_element_index_uint")?4294967296:65535;var i,n={};var a=e.morphTargets.length;var o=e.morphNormals.length;var s;var h={};var l=[];for(var u=0,c=e.faces.length;u<c;u++){var f=e.faces[u];var d=t?f.materialIndex:0;if(!(d in n)){n[d]={hash:d,counter:0}}i=n[d].hash+"_"+n[d].counter;if(!(i in h)){s={id:Xe++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:a,numMorphNormals:o};h[i]=s;l.push(s)}if(h[i].vertices+3>r){n[d].counter+=1;i=n[d].hash+"_"+n[d].counter;if(!(i in h)){s={id:Xe++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:a,numMorphNormals:o};h[i]=s;l.push(s)}}h[i].faces3.push(u);h[i].vertices+=3}return l}function Ye(e,t){var r=e.material,i=false;if(je[t.id]===undefined||t.groupsNeedUpdate===true){delete v[e.id];je[t.id]=qe(t,r instanceof n.MeshFaceMaterial);t.groupsNeedUpdate=false}var a=je[t.id];for(var o=0,s=a.length;o<s;o++){var h=a[o];if(h.__webglVertexBuffer===undefined){pe(h);Ae(h,e);t.verticesNeedUpdate=true;t.morphTargetsNeedUpdate=true;t.elementsNeedUpdate=true;t.uvsNeedUpdate=true;t.normalsNeedUpdate=true;t.tangentsNeedUpdate=true;t.colorsNeedUpdate=true;i=true}else{i=false}if(i||e.__webglActive===undefined){Ke(v,h,e)}}e.__webglActive=true}function Ke(e,t,r){var i=r.id;e[i]=e[i]||[];e[i].push({id:i,buffer:t,object:r,material:null,z:0})}function Qe(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function Ze(e){var t=e.geometry;if(t instanceof n.BufferGeometry){var r=t.attributes;var i=t.attributesKeys;for(var a=0,o=i.length;a<o;a++){var s=i[a];var h=r[s];var l=s==="index"?G.ELEMENT_ARRAY_BUFFER:G.ARRAY_BUFFER;if(h.buffer===undefined){h.buffer=G.createBuffer();G.bindBuffer(l,h.buffer);G.bufferData(l,h.array,h instanceof n.DynamicBufferAttribute?G.DYNAMIC_DRAW:G.STATIC_DRAW);h.needsUpdate=false}else if(h.needsUpdate===true){G.bindBuffer(l,h.buffer);if(h.updateRange===undefined||h.updateRange.count===-1){G.bufferSubData(l,0,h.array)}else if(h.updateRange.count===0){console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.")}else{G.bufferSubData(l,h.updateRange.offset*h.array.BYTES_PER_ELEMENT,h.array.subarray(h.updateRange.offset,h.updateRange.offset+h.updateRange.count));h.updateRange.count=0}h.needsUpdate=false}}}else if(e instanceof n.Mesh){if(t.groupsNeedUpdate===true){Ye(e,t)}var u=je[t.id];for(var a=0,c=u.length;a<c;a++){var f=u[a];var d=Le(e,f);var p=d.attributes&&Je(d);if(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||p){Be(f,e,G.DYNAMIC_DRAW,!t.dynamic,d)}}t.verticesNeedUpdate=false;t.morphTargetsNeedUpdate=false;t.elementsNeedUpdate=false;t.uvsNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.tangentsNeedUpdate=false;d.attributes&&$e(d)}else if(e instanceof n.Line){var d=Le(e,t);var p=d.attributes&&Je(d);if(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||p){Fe(t,G.DYNAMIC_DRAW)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;t.lineDistancesNeedUpdate=false;d.attributes&&$e(d)}else if(e instanceof n.PointCloud){var d=Le(e,t);var p=d.attributes&&Je(d);if(t.verticesNeedUpdate||t.colorsNeedUpdate||p){Re(t,G.DYNAMIC_DRAW,e)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;d.attributes&&$e(d)}}function Je(e){for(var t in e.attributes){if(e.attributes[t].needsUpdate)return true}return false}function $e(e){for(var t in e.attributes){e.attributes[t].needsUpdate=false}}function et(e){if(e instanceof n.Mesh||e instanceof n.PointCloud||e instanceof n.Line){delete v[e.id]}else if(e instanceof n.ImmediateRenderObject||e.immediateRenderCallback){tt(g,e)}delete e.__webglInit;delete e._modelViewMatrix;delete e._normalMatrix;delete e.__webglActive}function tt(e,t){for(var r=e.length-1;r>=0;r--){if(e[r].object===t){e.splice(r,1)}}}var rt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function it(e,t,r,i){e.addEventListener("dispose",xe);var o=rt[e.type];if(o){var s=n.ShaderLib[o];e.__webglShader={uniforms:n.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else{e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}var h=Ft(t);var l=Bt(t);var u=Rt(i);var c={precision:a,supportsVertexTextures:ee,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof n.FogExp2,flatShading:e.shading===n.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:f,skinning:e.skinning,maxBones:u,useVertexTexture:te&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:w.maxMorphTargets,maxMorphNormals:w.maxMorphNormals,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,maxShadows:l,shadowMapEnabled:w.shadowMapEnabled&&i.receiveShadow&&l>0,shadowMapType:w.shadowMapType,shadowMapDebug:w.shadowMapDebug,shadowMapCascade:w.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===n.DoubleSide,flipSided:e.side===n.BackSide};var d=[];if(o){d.push(o)}else{d.push(e.fragmentShader);d.push(e.vertexShader)}if(e.defines!==undefined){for(var p in e.defines){d.push(p);d.push(e.defines[p])}}for(var p in c){d.push(p);d.push(c[p])}var m=d.join();var v;for(var g=0,y=M.length;g<y;g++){var x=M[g];if(x.code===m){v=x;v.usedTimes++;break}}if(v===undefined){v=new n.WebGLProgram(w,m,e,c);M.push(v);w.info.memory.programs=M.length}e.program=v;var _=v.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var b,S="morphTarget";for(var C=0;C<w.maxMorphTargets;C++){b=S+C;if(_[b]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;var b,S="morphNormal";for(C=0;C<w.maxMorphNormals;C++){b=S+C;if(_[b]>=0){e.numSupportedMorphNormals++}}}e.uniformsList=[];for(var T in e.__webglShader.uniforms){var E=e.program.uniforms[T];if(E){e.uniformsList.push([e.__webglShader.uniforms[T],E])}}}function nt(e){if(e.transparent===true){j.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha)}else{j.setBlending(n.NoBlending)}j.setDepthTest(e.depthTest);j.setDepthWrite(e.depthWrite);j.setColorWrite(e.colorWrite);j.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function at(e,t,r,i,a){L=0;if(i.needsUpdate){if(i.program)Se(i);it(i,t,r,a);i.needsUpdate=false}if(i.morphTargets){if(!a.__webglMorphTargetInfluences){a.__webglMorphTargetInfluences=new Float32Array(w.maxMorphTargets)}}var o=false;var s=false;var h=false;var l=i.program,u=l.uniforms,c=i.__webglShader.uniforms;if(l.id!==S){G.useProgram(l.program);S=l.id;o=true;s=true;h=true}if(i.id!==T){if(T===-1)h=true;T=i.id;s=true}if(o||e!==A){G.uniformMatrix4fv(u.projectionMatrix,false,e.projectionMatrix.elements);if(f){G.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2))}if(e!==A)A=e;if(i instanceof n.ShaderMaterial||i instanceof n.MeshPhongMaterial||i.envMap){if(u.cameraPosition!==null){N.setFromMatrixPosition(e.matrixWorld);G.uniform3f(u.cameraPosition,N.x,N.y,N.z)}}if(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshBasicMaterial||i instanceof n.ShaderMaterial||i.skinning){if(u.viewMatrix!==null){G.uniformMatrix4fv(u.viewMatrix,false,e.matrixWorldInverse.elements)}}}if(i.skinning){if(a.bindMatrix&&u.bindMatrix!==null){G.uniformMatrix4fv(u.bindMatrix,false,a.bindMatrix.elements)}if(a.bindMatrixInverse&&u.bindMatrixInverse!==null){G.uniformMatrix4fv(u.bindMatrixInverse,false,a.bindMatrixInverse.elements)}if(te&&a.skeleton&&a.skeleton.useVertexTexture){if(u.boneTexture!==null){var d=gt();G.uniform1i(u.boneTexture,d);w.setTexture(a.skeleton.boneTexture,d)}if(u.boneTextureWidth!==null){G.uniform1i(u.boneTextureWidth,a.skeleton.boneTextureWidth)}if(u.boneTextureHeight!==null){G.uniform1i(u.boneTextureHeight,a.skeleton.boneTextureHeight)}}else if(a.skeleton&&a.skeleton.boneMatrices){if(u.boneGlobalMatrices!==null){G.uniformMatrix4fv(u.boneGlobalMatrices,false,a.skeleton.boneMatrices)}}}if(s){if(r&&i.fog){ut(c,r)}if(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i.lights){if(z){h=true;bt(t);z=false}if(h){dt(c,I);pt(c,true)}else{pt(c,false)}}if(i instanceof n.MeshBasicMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhongMaterial){ot(c,i)}if(i instanceof n.LineBasicMaterial){st(c,i)}else if(i instanceof n.LineDashedMaterial){st(c,i);ht(c,i)}else if(i instanceof n.PointCloudMaterial){lt(c,i)}else if(i instanceof n.MeshPhongMaterial){ct(c,i)}else if(i instanceof n.MeshLambertMaterial){ft(c,i)}else if(i instanceof n.MeshDepthMaterial){c.mNear.value=e.near;c.mFar.value=e.far;c.opacity.value=i.opacity}else if(i instanceof n.MeshNormalMaterial){c.opacity.value=i.opacity}if(a.receiveShadow&&!i._shadowPass){mt(c,t)}yt(i.uniformsList)}vt(u,a);if(u.modelMatrix!==null){G.uniformMatrix4fv(u.modelMatrix,false,a.matrixWorld.elements)}return l}function ot(e,t){e.opacity.value=t.opacity;e.diffuse.value=t.color;e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;e.alphaMap.value=t.alphaMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var r;if(t.map){r=t.map}else if(t.specularMap){r=t.specularMap}else if(t.normalMap){r=t.normalMap}else if(t.bumpMap){r=t.bumpMap}else if(t.alphaMap){r=t.alphaMap}if(r!==undefined){var i=r.offset;var a=r.repeat;e.offsetRepeat.value.set(i.x,i.y,a.x,a.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof n.WebGLRenderTargetCube?1:-1;e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio}function st(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function ht(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function lt(e,r){e.psColor.value=r.color;e.opacity.value=r.opacity;e.size.value=r.size;e.scale.value=t.height/2;e.map.value=r.map;if(r.map!==null){var i=r.map.offset;var n=r.map.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}function ut(e,t){e.fogColor.value=t.color;if(t instanceof n.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof n.FogExp2){e.fogDensity.value=t.density}}function ct(e,t){e.shininess.value=t.shininess;e.emissive.value=t.emissive;e.specular.value=t.specular;if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function ft(e,t){e.emissive.value=t.emissive;if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function dt(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.pointLightDecay.value=t.point.decays;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.spotLightDecay.value=t.spot.decays;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function pt(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLightColor.needsUpdate=t;e.directionalLightDirection.needsUpdate=t;e.pointLightColor.needsUpdate=t;e.pointLightPosition.needsUpdate=t;e.pointLightDistance.needsUpdate=t;e.pointLightDecay.needsUpdate=t;e.spotLightColor.needsUpdate=t;e.spotLightPosition.needsUpdate=t;e.spotLightDistance.needsUpdate=t;e.spotLightDirection.needsUpdate=t;e.spotLightAngleCos.needsUpdate=t;e.spotLightExponent.needsUpdate=t;e.spotLightDecay.needsUpdate=t;e.hemisphereLightSkyColor.needsUpdate=t;e.hemisphereLightGroundColor.needsUpdate=t;e.hemisphereLightDirection.needsUpdate=t}function mt(e,t){if(e.shadowMatrix){var r=0;for(var i=0,a=t.length;i<a;i++){var o=t[i];if(!o.castShadow)continue;if(o instanceof n.SpotLight||o instanceof n.DirectionalLight&&!o.shadowCascade){e.shadowMap.value[r]=o.shadowMap;e.shadowMapSize.value[r]=o.shadowMapSize;e.shadowMatrix.value[r]=o.shadowMatrix;e.shadowDarkness.value[r]=o.shadowDarkness;e.shadowBias.value[r]=o.shadowBias;r++}}}}function vt(e,t){G.uniformMatrix4fv(e.modelViewMatrix,false,t._modelViewMatrix.elements);if(e.normalMatrix){G.uniformMatrix3fv(e.normalMatrix,false,t._normalMatrix.elements)}}function gt(){var e=L;if(e>=Q){n.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Q)}L+=1;return e}function yt(e){var t,r,i;for(var a=0,o=e.length;a<o;a++){var s=e[a][0];if(s.needsUpdate===false)continue;var h=s.type;var l=s.value;var u=e[a][1];switch(h){case"1i":G.uniform1i(u,l);break;case"1f":G.uniform1f(u,l);break;case"2f":G.uniform2f(u,l[0],l[1]);break;case"3f":G.uniform3f(u,l[0],l[1],l[2]);break;case"4f":G.uniform4f(u,l[0],l[1],l[2],l[3]);break;case"1iv":G.uniform1iv(u,l);break;case"3iv":G.uniform3iv(u,l);break;case"1fv":G.uniform1fv(u,l);break;case"2fv":G.uniform2fv(u,l);break;case"3fv":G.uniform3fv(u,l);break;case"4fv":G.uniform4fv(u,l);break;case"Matrix3fv":G.uniformMatrix3fv(u,false,l);break;case"Matrix4fv":G.uniformMatrix4fv(u,false,l);break;case"i":G.uniform1i(u,l);break;case"f":G.uniform1f(u,l);break;case"v2":G.uniform2f(u,l.x,l.y);break;case"v3":G.uniform3f(u,l.x,l.y,l.z);break;case"v4":G.uniform4f(u,l.x,l.y,l.z,l.w);break;case"c":G.uniform3f(u,l.r,l.g,l.b);break;case"iv1":G.uniform1iv(u,l);break;case"iv":G.uniform3iv(u,l);break;case"fv1":G.uniform1fv(u,l);break;case"fv":G.uniform3fv(u,l);break;case"v2v":if(s._array===undefined){s._array=new Float32Array(2*l.length)}for(var c=0,f=l.length;c<f;c++){i=c*2;s._array[i]=l[c].x;s._array[i+1]=l[c].y}G.uniform2fv(u,s._array);break;case"v3v":if(s._array===undefined){s._array=new Float32Array(3*l.length)}for(var c=0,f=l.length;c<f;c++){i=c*3;s._array[i]=l[c].x;s._array[i+1]=l[c].y;s._array[i+2]=l[c].z}G.uniform3fv(u,s._array);break;case"v4v":if(s._array===undefined){s._array=new Float32Array(4*l.length)}for(var c=0,f=l.length;c<f;c++){i=c*4;s._array[i]=l[c].x;s._array[i+1]=l[c].y;s._array[i+2]=l[c].z;s._array[i+3]=l[c].w}G.uniform4fv(u,s._array);break;case"m3":G.uniformMatrix3fv(u,false,l.elements);break;case"m3v":if(s._array===undefined){s._array=new Float32Array(9*l.length)}for(var c=0,f=l.length;c<f;c++){l[c].flattenToArrayOffset(s._array,c*9)}G.uniformMatrix3fv(u,false,s._array);break;case"m4":G.uniformMatrix4fv(u,false,l.elements);break;case"m4v":if(s._array===undefined){s._array=new Float32Array(16*l.length)}for(var c=0,f=l.length;c<f;c++){l[c].flattenToArrayOffset(s._array,c*16)}G.uniformMatrix4fv(u,false,s._array);break;case"t":t=l;r=gt();G.uniform1i(u,r);if(!t)continue;if(t instanceof n.CubeTexture||t.image instanceof Array&&t.image.length===6){St(t,r)}else if(t instanceof n.WebGLRenderTargetCube){Ct(t,r)}else{w.setTexture(t,r)}break;case"tv":if(s._array===undefined){s._array=[]}for(var c=0,f=s.value.length;c<f;c++){s._array[c]=gt()}G.uniform1iv(u,s._array);for(var c=0,f=s.value.length;c<f;c++){t=s.value[c];r=s._array[c];if(!t)continue;w.setTexture(t,r)}break;default:n.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}}function xt(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function _t(e,t,r,i){e[t]=r.r*i;e[t+1]=r.g*i;e[t+2]=r.b*i}function bt(e){var t,r,i,a=0,o=0,s=0,h,l,u,c,f,d=I,p=d.directional.colors,m=d.directional.positions,v=d.point.colors,g=d.point.positions,y=d.point.distances,x=d.point.decays,_=d.spot.colors,b=d.spot.positions,w=d.spot.distances,M=d.spot.directions,S=d.spot.anglesCos,C=d.spot.exponents,T=d.spot.decays,E=d.hemi.skyColors,A=d.hemi.groundColors,L=d.hemi.positions,P=0,R=0,F=0,B=0,U=0,D=0,k=0,V=0,z=0,G=0,H=0,W=0;for(t=0,r=e.length;t<r;t++){i=e[t];if(i.onlyShadow)continue;h=i.color;c=i.intensity;f=i.distance;if(i instanceof n.AmbientLight){if(!i.visible)continue;a+=h.r;o+=h.g;s+=h.b}else if(i instanceof n.DirectionalLight){U+=1;if(!i.visible)continue;O.setFromMatrixPosition(i.matrixWorld);N.setFromMatrixPosition(i.target.matrixWorld);O.sub(N);O.normalize();z=P*3;m[z]=O.x;m[z+1]=O.y;m[z+2]=O.z;_t(p,z,h,c);P+=1}else if(i instanceof n.PointLight){D+=1;if(!i.visible)continue;G=R*3;_t(v,G,h,c);N.setFromMatrixPosition(i.matrixWorld);g[G]=N.x;g[G+1]=N.y;g[G+2]=N.z;y[R]=f;x[R]=i.distance===0?0:i.decay;R+=1}else if(i instanceof n.SpotLight){k+=1;if(!i.visible)continue;H=F*3;_t(_,H,h,c);O.setFromMatrixPosition(i.matrixWorld);b[H]=O.x;b[H+1]=O.y;b[H+2]=O.z;w[F]=f;N.setFromMatrixPosition(i.target.matrixWorld);O.sub(N);O.normalize();M[H]=O.x;M[H+1]=O.y;M[H+2]=O.z;S[F]=Math.cos(i.angle);C[F]=i.exponent;T[F]=i.distance===0?0:i.decay;F+=1}else if(i instanceof n.HemisphereLight){V+=1;if(!i.visible)continue;O.setFromMatrixPosition(i.matrixWorld);O.normalize();W=B*3;L[W]=O.x;L[W+1]=O.y;L[W+2]=O.z;l=i.color;u=i.groundColor;_t(E,W,l,c);_t(A,W,u,c);B+=1}}for(t=P*3,r=Math.max(p.length,U*3);t<r;t++)p[t]=0;for(t=R*3,r=Math.max(v.length,D*3);t<r;t++)v[t]=0;for(t=F*3,r=Math.max(_.length,k*3);t<r;t++)_[t]=0;for(t=B*3,r=Math.max(E.length,V*3);t<r;t++)E[t]=0;for(t=B*3,r=Math.max(A.length,V*3);t<r;t++)A[t]=0;d.directional.length=P;d.point.length=R;d.spot.length=F;d.hemi.length=B;d.ambient[0]=a;d.ambient[1]=o;d.ambient[2]=s}this.setFaceCulling=function(e,t){if(e===n.CullFaceNone){G.disable(G.CULL_FACE)}else{if(t===n.FrontFaceDirectionCW){G.frontFace(G.CW)}else{G.frontFace(G.CCW)}if(e===n.CullFaceBack){G.cullFace(G.BACK)}else if(e===n.CullFaceFront){G.cullFace(G.FRONT)}else{G.cullFace(G.FRONT_AND_BACK)}G.enable(G.CULL_FACE)}};this.setMaterialFaces=function(e){j.setDoubleSided(e.side===n.DoubleSide);j.setFlipSided(e.side===n.BackSide)};function wt(e,t,r){var i;if(r){G.texParameteri(e,G.TEXTURE_WRAP_S,Pt(t.wrapS));G.texParameteri(e,G.TEXTURE_WRAP_T,Pt(t.wrapT));G.texParameteri(e,G.TEXTURE_MAG_FILTER,Pt(t.magFilter));G.texParameteri(e,G.TEXTURE_MIN_FILTER,Pt(t.minFilter))}else{G.texParameteri(e,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE);G.texParameteri(e,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE);if(t.wrapS!==n.ClampToEdgeWrapping||t.wrapT!==n.ClampToEdgeWrapping){n.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )")}G.texParameteri(e,G.TEXTURE_MAG_FILTER,Lt(t.magFilter));G.texParameteri(e,G.TEXTURE_MIN_FILTER,Lt(t.minFilter));if(t.minFilter!==n.NearestFilter&&t.minFilter!==n.LinearFilter){n.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")}}i=X.get("EXT_texture_filter_anisotropic");if(i&&t.type!==n.FloatType&&t.type!==n.HalfFloatType){if(t.anisotropy>1||t.__currentAnisotropy){G.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,w.getMaxAnisotropy()));t.__currentAnisotropy=t.anisotropy}}}this.uploadTexture=function(e){if(e.__webglInit===undefined){e.__webglInit=true;e.addEventListener("dispose",ge);e.__webglTexture=G.createTexture();w.info.memory.textures++}G.bindTexture(G.TEXTURE_2D,e.__webglTexture);G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,e.flipY);G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);G.pixelStorei(G.UNPACK_ALIGNMENT,e.unpackAlignment);e.image=Mt(e.image,J);var t=e.image,r=n.Math.isPowerOfTwo(t.width)&&n.Math.isPowerOfTwo(t.height),i=Pt(e.format),a=Pt(e.type);wt(G.TEXTURE_2D,e,r);var o,s=e.mipmaps;if(e instanceof n.DataTexture){if(s.length>0&&r){for(var h=0,l=s.length;h<l;h++){o=s[h];G.texImage2D(G.TEXTURE_2D,h,i,o.width,o.height,0,i,a,o.data)}e.generateMipmaps=false}else{G.texImage2D(G.TEXTURE_2D,0,i,t.width,t.height,0,i,a,t.data)}}else if(e instanceof n.CompressedTexture){for(var h=0,l=s.length;h<l;h++){o=s[h];if(e.format!==n.RGBAFormat&&e.format!==n.RGBFormat){if(oe().indexOf(i)>-1){G.compressedTexImage2D(G.TEXTURE_2D,h,i,o.width,o.height,0,o.data)}else{n.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{G.texImage2D(G.TEXTURE_2D,h,i,o.width,o.height,0,i,a,o.data)}}}else{if(s.length>0&&r){
for(var h=0,l=s.length;h<l;h++){o=s[h];G.texImage2D(G.TEXTURE_2D,h,i,i,a,o)}e.generateMipmaps=false}else{G.texImage2D(G.TEXTURE_2D,0,i,i,a,e.image)}}if(e.generateMipmaps&&r)G.generateMipmap(G.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()};this.setTexture=function(e,t){G.activeTexture(G.TEXTURE0+t);if(e.needsUpdate){w.uploadTexture(e)}else{G.bindTexture(G.TEXTURE_2D,e.__webglTexture)}};function Mt(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height);var i=document.createElement("canvas");i.width=Math.floor(e.width*r);i.height=Math.floor(e.height*r);var a=i.getContext("2d");a.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height);n.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e);return i}return e}function St(e,t){if(e.image.length===6){if(e.needsUpdate){if(!e.image.__webglTextureCube){e.addEventListener("dispose",ge);e.image.__webglTextureCube=G.createTexture();w.info.memory.textures++}G.activeTexture(G.TEXTURE0+t);G.bindTexture(G.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,e.flipY);var r=e instanceof n.CompressedTexture;var i=e.image[0]instanceof n.DataTexture;var a=[];for(var o=0;o<6;o++){if(w.autoScaleCubemaps&&!r&&!i){a[o]=Mt(e.image[o],$)}else{a[o]=i?e.image[o].image:e.image[o]}}var s=a[0],h=n.Math.isPowerOfTwo(s.width)&&n.Math.isPowerOfTwo(s.height),l=Pt(e.format),u=Pt(e.type);wt(G.TEXTURE_CUBE_MAP,e,h);for(var o=0;o<6;o++){if(!r){if(i){G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,a[o].width,a[o].height,0,l,u,a[o].data)}else{G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,u,a[o])}}else{var c,f=a[o].mipmaps;for(var d=0,p=f.length;d<p;d++){c=f[d];if(e.format!==n.RGBAFormat&&e.format!==n.RGBFormat){if(oe().indexOf(l)>-1){G.compressedTexImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,c.width,c.height,0,c.data)}else{n.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,c.width,c.height,0,l,u,c.data)}}}}if(e.generateMipmaps&&h){G.generateMipmap(G.TEXTURE_CUBE_MAP)}e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{G.activeTexture(G.TEXTURE0+t);G.bindTexture(G.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}}function Ct(e,t){G.activeTexture(G.TEXTURE0+t);G.bindTexture(G.TEXTURE_CUBE_MAP,e.__webglTexture)}function Tt(e,t,r){G.bindFramebuffer(G.FRAMEBUFFER,e);G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function Et(e,t){G.bindRenderbuffer(G.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){G.renderbufferStorage(G.RENDERBUFFER,G.DEPTH_COMPONENT16,t.width,t.height);G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_ATTACHMENT,G.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){G.renderbufferStorage(G.RENDERBUFFER,G.DEPTH_STENCIL,t.width,t.height);G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_STENCIL_ATTACHMENT,G.RENDERBUFFER,e)}else{G.renderbufferStorage(G.RENDERBUFFER,G.RGBA4,t.width,t.height)}}this.setRenderTarget=function(e){var t=e instanceof n.WebGLRenderTargetCube;if(e&&e.__webglFramebuffer===undefined){if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",ye);e.__webglTexture=G.createTexture();w.info.memory.textures++;var r=n.Math.isPowerOfTwo(e.width)&&n.Math.isPowerOfTwo(e.height),i=Pt(e.format),a=Pt(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];G.bindTexture(G.TEXTURE_CUBE_MAP,e.__webglTexture);wt(G.TEXTURE_CUBE_MAP,e,r);for(var o=0;o<6;o++){e.__webglFramebuffer[o]=G.createFramebuffer();e.__webglRenderbuffer[o]=G.createRenderbuffer();G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i,e.width,e.height,0,i,a,null);Tt(e.__webglFramebuffer[o],e,G.TEXTURE_CUBE_MAP_POSITIVE_X+o);Et(e.__webglRenderbuffer[o],e)}if(r)G.generateMipmap(G.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=G.createFramebuffer();if(e.shareDepthFrom){e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{e.__webglRenderbuffer=G.createRenderbuffer()}G.bindTexture(G.TEXTURE_2D,e.__webglTexture);wt(G.TEXTURE_2D,e,r);G.texImage2D(G.TEXTURE_2D,0,i,e.width,e.height,0,i,a,null);Tt(e.__webglFramebuffer,e,G.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_ATTACHMENT,G.RENDERBUFFER,e.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_STENCIL_ATTACHMENT,G.RENDERBUFFER,e.__webglRenderbuffer)}}else{Et(e.__webglRenderbuffer,e)}if(r)G.generateMipmap(G.TEXTURE_2D)}if(t){G.bindTexture(G.TEXTURE_CUBE_MAP,null)}else{G.bindTexture(G.TEXTURE_2D,null)}G.bindRenderbuffer(G.RENDERBUFFER,null);G.bindFramebuffer(G.FRAMEBUFFER,null)}var s,h,l,u,c;if(e){if(t){s=e.__webglFramebuffer[e.activeCubeFace]}else{s=e.__webglFramebuffer}h=e.width;l=e.height;u=0;c=0}else{s=null;h=F;l=B;u=P;c=R}if(s!==C){G.bindFramebuffer(G.FRAMEBUFFER,s);G.viewport(u,c,h,l);C=s}U=h;D=l};this.readRenderTargetPixels=function(e,t,r,i,a,o){if(!(e instanceof n.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(e.__webglFramebuffer){if(e.format!==n.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");return}var s=false;if(e.__webglFramebuffer!==C){G.bindFramebuffer(G.FRAMEBUFFER,e.__webglFramebuffer);s=true}if(G.checkFramebufferStatus(G.FRAMEBUFFER)===G.FRAMEBUFFER_COMPLETE){G.readPixels(t,r,i,a,G.RGBA,G.UNSIGNED_BYTE,o)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}if(s){G.bindFramebuffer(G.FRAMEBUFFER,C)}}};function At(e){if(e instanceof n.WebGLRenderTargetCube){G.bindTexture(G.TEXTURE_CUBE_MAP,e.__webglTexture);G.generateMipmap(G.TEXTURE_CUBE_MAP);G.bindTexture(G.TEXTURE_CUBE_MAP,null)}else{G.bindTexture(G.TEXTURE_2D,e.__webglTexture);G.generateMipmap(G.TEXTURE_2D);G.bindTexture(G.TEXTURE_2D,null)}}function Lt(e){if(e===n.NearestFilter||e===n.NearestMipMapNearestFilter||e===n.NearestMipMapLinearFilter){return G.NEAREST}return G.LINEAR}function Pt(e){var t;if(e===n.RepeatWrapping)return G.REPEAT;if(e===n.ClampToEdgeWrapping)return G.CLAMP_TO_EDGE;if(e===n.MirroredRepeatWrapping)return G.MIRRORED_REPEAT;if(e===n.NearestFilter)return G.NEAREST;if(e===n.NearestMipMapNearestFilter)return G.NEAREST_MIPMAP_NEAREST;if(e===n.NearestMipMapLinearFilter)return G.NEAREST_MIPMAP_LINEAR;if(e===n.LinearFilter)return G.LINEAR;if(e===n.LinearMipMapNearestFilter)return G.LINEAR_MIPMAP_NEAREST;if(e===n.LinearMipMapLinearFilter)return G.LINEAR_MIPMAP_LINEAR;if(e===n.UnsignedByteType)return G.UNSIGNED_BYTE;if(e===n.UnsignedShort4444Type)return G.UNSIGNED_SHORT_4_4_4_4;if(e===n.UnsignedShort5551Type)return G.UNSIGNED_SHORT_5_5_5_1;if(e===n.UnsignedShort565Type)return G.UNSIGNED_SHORT_5_6_5;if(e===n.ByteType)return G.BYTE;if(e===n.ShortType)return G.SHORT;if(e===n.UnsignedShortType)return G.UNSIGNED_SHORT;if(e===n.IntType)return G.INT;if(e===n.UnsignedIntType)return G.UNSIGNED_INT;if(e===n.FloatType)return G.FLOAT;t=X.get("OES_texture_half_float");if(t!==null){if(e===n.HalfFloatType)return t.HALF_FLOAT_OES}if(e===n.AlphaFormat)return G.ALPHA;if(e===n.RGBFormat)return G.RGB;if(e===n.RGBAFormat)return G.RGBA;if(e===n.LuminanceFormat)return G.LUMINANCE;if(e===n.LuminanceAlphaFormat)return G.LUMINANCE_ALPHA;if(e===n.AddEquation)return G.FUNC_ADD;if(e===n.SubtractEquation)return G.FUNC_SUBTRACT;if(e===n.ReverseSubtractEquation)return G.FUNC_REVERSE_SUBTRACT;if(e===n.ZeroFactor)return G.ZERO;if(e===n.OneFactor)return G.ONE;if(e===n.SrcColorFactor)return G.SRC_COLOR;if(e===n.OneMinusSrcColorFactor)return G.ONE_MINUS_SRC_COLOR;if(e===n.SrcAlphaFactor)return G.SRC_ALPHA;if(e===n.OneMinusSrcAlphaFactor)return G.ONE_MINUS_SRC_ALPHA;if(e===n.DstAlphaFactor)return G.DST_ALPHA;if(e===n.OneMinusDstAlphaFactor)return G.ONE_MINUS_DST_ALPHA;if(e===n.DstColorFactor)return G.DST_COLOR;if(e===n.OneMinusDstColorFactor)return G.ONE_MINUS_DST_COLOR;if(e===n.SrcAlphaSaturateFactor)return G.SRC_ALPHA_SATURATE;t=X.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===n.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===n.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=X.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===n.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===n.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===n.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===n.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=X.get("EXT_blend_minmax");if(t!==null){if(e===n.MinEquation)return t.MIN_EXT;if(e===n.MaxEquation)return t.MAX_EXT}return 0}function Rt(e){if(te&&e&&e.skeleton&&e.skeleton.useVertexTexture){return 1024}else{var t=G.getParameter(G.MAX_VERTEX_UNIFORM_VECTORS);var r=Math.floor((t-20)/4);var i=r;if(e!==undefined&&e instanceof n.SkinnedMesh){i=Math.min(e.skeleton.bones.length,i);if(i<e.skeleton.bones.length){n.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")}}return i}}function Ft(e){var t=0;var r=0;var i=0;var a=0;for(var o=0,s=e.length;o<s;o++){var h=e[o];if(h.onlyShadow||h.visible===false)continue;if(h instanceof n.DirectionalLight)t++;if(h instanceof n.PointLight)r++;if(h instanceof n.SpotLight)i++;if(h instanceof n.HemisphereLight)a++}return{directional:t,point:r,spot:i,hemi:a}}function Bt(e){var t=0;for(var r=0,i=e.length;r<i;r++){var a=e[r];if(!a.castShadow)continue;if(a instanceof n.SpotLight)t++;if(a instanceof n.DirectionalLight&&!a.shadowCascade)t++}return t}this.initMaterial=function(){n.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){n.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){n.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){n.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};n.WebGLRenderTarget=function(e,t,r){this.width=e;this.height=t;r=r||{};this.wrapS=r.wrapS!==undefined?r.wrapS:n.ClampToEdgeWrapping;this.wrapT=r.wrapT!==undefined?r.wrapT:n.ClampToEdgeWrapping;this.magFilter=r.magFilter!==undefined?r.magFilter:n.LinearFilter;this.minFilter=r.minFilter!==undefined?r.minFilter:n.LinearMipMapLinearFilter;this.anisotropy=r.anisotropy!==undefined?r.anisotropy:1;this.offset=new n.Vector2(0,0);this.repeat=new n.Vector2(1,1);this.format=r.format!==undefined?r.format:n.RGBAFormat;this.type=r.type!==undefined?r.type:n.UnsignedByteType;this.depthBuffer=r.depthBuffer!==undefined?r.depthBuffer:true;this.stencilBuffer=r.stencilBuffer!==undefined?r.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=r.shareDepthFrom!==undefined?r.shareDepthFrom:null};n.WebGLRenderTarget.prototype={constructor:n.WebGLRenderTarget,setSize:function(e,t){this.width=e;this.height=t},clone:function(){var e=new n.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};n.EventDispatcher.prototype.apply(n.WebGLRenderTarget.prototype);n.WebGLRenderTargetCube=function(e,t,r){n.WebGLRenderTarget.call(this,e,t,r);this.activeCubeFace=0};n.WebGLRenderTargetCube.prototype=Object.create(n.WebGLRenderTarget.prototype);n.WebGLRenderTargetCube.prototype.constructor=n.WebGLRenderTargetCube;n.WebGLExtensions=function(e){var t={};this.get=function(r){if(t[r]!==undefined){return t[r]}var i;switch(r){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}if(i===null){n.warn("THREE.WebGLRenderer: "+r+" extension not supported.")}t[r]=i;return i}};n.WebGLProgram=function(){var e=0;var t=function(e){var t,r,i=[];for(var n in e){t=e[n];if(t===false)continue;r="#define "+n+" "+t;i.push(r)}return i.join("\n")};var r=function(e,t,r){var i={};for(var n=0,a=r.length;n<a;n++){var o=r[n];i[o]=e.getUniformLocation(t,o)}return i};var i=function(e,t,r){var i={};for(var n=0,a=r.length;n<a;n++){var o=r[n];i[o]=e.getAttribLocation(t,o)}return i};return function(a,o,s,h){var l=a;var u=l.context;var c=s.defines;var f=s.__webglShader.uniforms;var d=s.attributes;var p=s.__webglShader.vertexShader;var m=s.__webglShader.fragmentShader;var v=s.index0AttributeName;if(v===undefined&&h.morphTargets===true){v="position"}var g="SHADOWMAP_TYPE_BASIC";if(h.shadowMapType===n.PCFShadowMap){g="SHADOWMAP_TYPE_PCF"}else if(h.shadowMapType===n.PCFSoftShadowMap){g="SHADOWMAP_TYPE_PCF_SOFT"}var y="ENVMAP_TYPE_CUBE";var x="ENVMAP_MODE_REFLECTION";var _="ENVMAP_BLENDING_MULTIPLY";if(h.envMap){switch(s.envMap.mapping){case n.CubeReflectionMapping:case n.CubeRefractionMapping:y="ENVMAP_TYPE_CUBE";break;case n.EquirectangularReflectionMapping:case n.EquirectangularRefractionMapping:y="ENVMAP_TYPE_EQUIREC";break;case n.SphericalReflectionMapping:y="ENVMAP_TYPE_SPHERE";break}switch(s.envMap.mapping){case n.CubeRefractionMapping:case n.EquirectangularRefractionMapping:x="ENVMAP_MODE_REFRACTION";break}switch(s.combine){case n.MultiplyOperation:_="ENVMAP_BLENDING_MULTIPLY";break;case n.MixOperation:_="ENVMAP_BLENDING_MIX";break;case n.AddOperation:_="ENVMAP_BLENDING_ADD";break}}var b=a.gammaFactor>0?a.gammaFactor:1;var w=t(c);var M=u.createProgram();var S,C;if(s instanceof n.RawShaderMaterial){S="";C=""}else{S=["precision "+h.precision+" float;","precision "+h.precision+" int;",w,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+b,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+x:"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+g:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n");C=["precision "+h.precision+" float;","precision "+h.precision+" int;",h.bumpMap||h.normalMap||h.flatShading?"#extension GL_OES_standard_derivatives : enable":"",w,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+b,h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+y:"",h.envMap?"#define "+x:"",h.envMap?"#define "+_:"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.metal?"#define METAL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+g:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var T=new n.WebGLShader(u,u.VERTEX_SHADER,S+p);var E=new n.WebGLShader(u,u.FRAGMENT_SHADER,C+m);u.attachShader(M,T);u.attachShader(M,E);if(v!==undefined){u.bindAttribLocation(M,0,v)}u.linkProgram(M);var A=u.getProgramInfoLog(M);if(u.getProgramParameter(M,u.LINK_STATUS)===false){n.error("THREE.WebGLProgram: shader error: "+u.getError(),"gl.VALIDATE_STATUS",u.getProgramParameter(M,u.VALIDATE_STATUS),"gl.getPRogramInfoLog",A)}if(A!==""){n.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+A)}u.deleteShader(T);u.deleteShader(E);var L=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(h.useVertexTexture){L.push("boneTexture");L.push("boneTextureWidth");L.push("boneTextureHeight")}else{L.push("boneGlobalMatrices")}if(h.logarithmicDepthBuffer){L.push("logDepthBufFC")}for(var P in f){L.push(P)}this.uniforms=r(u,M,L);L=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var R=0;R<h.maxMorphTargets;R++){L.push("morphTarget"+R)}for(var R=0;R<h.maxMorphNormals;R++){L.push("morphNormal"+R)}for(var F in d){L.push(F)}this.attributes=i(u,M,L);this.attributesKeys=Object.keys(this.attributes);this.id=e++;this.code=o;this.usedTimes=1;this.program=M;this.vertexShader=T;this.fragmentShader=E;return this}}();n.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var r=0;r<t.length;r++){t[r]=r+1+": "+t[r]}return t.join("\n")};return function(t,r,i){var a=t.createShader(r);t.shaderSource(a,i);t.compileShader(a);if(t.getShaderParameter(a,t.COMPILE_STATUS)===false){n.error("THREE.WebGLShader: Shader couldn't compile.")}if(t.getShaderInfoLog(a)!==""){n.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(a),e(i))}return a}}();n.WebGLState=function(e,t){var r=new Uint8Array(16);var i=new Uint8Array(16);var a=null;var o=null;var s=null;var h=null;var l=null;var u=null;var c=null;var f=null;var d=null;var p=null;var m=null;var v=null;var g=null;var y=null;var x=null;var _=null;this.initAttributes=function(){for(var e=0,t=r.length;e<t;e++){r[e]=0}};this.enableAttribute=function(t){r[t]=1;if(i[t]===0){e.enableVertexAttribArray(t);i[t]=1}};this.disableUnusedAttributes=function(){for(var t=0,n=i.length;t<n;t++){if(i[t]!==r[t]){e.disableVertexAttribArray(t);i[t]=0}}};this.setBlending=function(r,i,f,d,p,m,v){if(r!==a){if(r===n.NoBlending){e.disable(e.BLEND)}else if(r===n.AdditiveBlending){e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE)}else if(r===n.SubtractiveBlending){e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)}else if(r===n.MultiplyBlending){e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.SRC_COLOR)}else if(r===n.CustomBlending){e.enable(e.BLEND)}else{e.enable(e.BLEND);e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}a=r}if(r===n.CustomBlending){p=p||i;m=m||f;v=v||d;if(i!==o||p!==l){e.blendEquationSeparate(t(i),t(p));o=i;l=p}if(f!==s||d!==h||m!==u||v!==c){e.blendFuncSeparate(t(f),t(d),t(m),t(v));s=f;h=d;u=m;c=v}}else{o=null;s=null;h=null;l=null;u=null;c=null}};this.setDepthTest=function(t){if(f!==t){if(t){e.enable(e.DEPTH_TEST)}else{e.disable(e.DEPTH_TEST)}f=t}};this.setDepthWrite=function(t){if(d!==t){e.depthMask(t);d=t}};this.setColorWrite=function(t){if(p!==t){e.colorMask(t,t,t,t);p=t}};this.setDoubleSided=function(t){if(m!==t){if(t){e.disable(e.CULL_FACE)}else{e.enable(e.CULL_FACE)}m=t}};this.setFlipSided=function(t){if(v!==t){if(t){e.frontFace(e.CW)}else{e.frontFace(e.CCW)}v=t}};this.setLineWidth=function(t){if(t!==g){e.lineWidth(t);g=t}};this.setPolygonOffset=function(t,r,i){if(y!==t){if(t){e.enable(e.POLYGON_OFFSET_FILL)}else{e.disable(e.POLYGON_OFFSET_FILL)}y=t}if(t&&(x!==r||_!==i)){e.polygonOffset(r,i);x=r;_=i}};this.reset=function(){for(var e=0;e<i.length;e++){i[e]=0}a=null;f=null;d=null;p=null;m=null;v=null}};n.LensFlarePlugin=function(e,t){var r=e.context;var i,a;var o,s,h;var l;var u,c;var f=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);i=r.createBuffer();a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);u=r.createTexture();c=r.createTexture();r.bindTexture(r.TEXTURE_2D,u);r.texImage2D(r.TEXTURE_2D,0,r.RGB,16,16,0,r.RGB,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);r.bindTexture(r.TEXTURE_2D,c);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,16,16,0,r.RGBA,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);l=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var n;if(l){n={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{n={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}o=d(n);s={vertex:r.getAttribLocation(o,"position"),uv:r.getAttribLocation(o,"uv")};h={renderType:r.getUniformLocation(o,"renderType"),map:r.getUniformLocation(o,"map"),occlusionMap:r.getUniformLocation(o,"occlusionMap"),opacity:r.getUniformLocation(o,"opacity"),color:r.getUniformLocation(o,"color"),scale:r.getUniformLocation(o,"scale"),rotation:r.getUniformLocation(o,"rotation"),screenPosition:r.getUniformLocation(o,"screenPosition")}};this.render=function(d,p,m,v){if(t.length===0)return;var g=new n.Vector3;var y=v/m,x=m*.5,_=v*.5;var b=16/v,w=new n.Vector2(b*y,b);var M=new n.Vector3(1,1,0),S=new n.Vector2(1,1);if(o===undefined){f()}r.useProgram(o);r.enableVertexAttribArray(s.vertex);r.enableVertexAttribArray(s.uv);r.uniform1i(h.occlusionMap,0);r.uniform1i(h.map,1);r.bindBuffer(r.ARRAY_BUFFER,i);r.vertexAttribPointer(s.vertex,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(s.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.disable(r.CULL_FACE);r.depthMask(false);for(var C=0,T=t.length;C<T;C++){b=16/v;w.set(b*y,b);var E=t[C];g.set(E.matrixWorld.elements[12],E.matrixWorld.elements[13],E.matrixWorld.elements[14]);g.applyMatrix4(p.matrixWorldInverse);g.applyProjection(p.projectionMatrix);M.copy(g);S.x=M.x*x+x;S.y=M.y*_+_;if(l||S.x>0&&S.x<m&&S.y>0&&S.y<v){r.activeTexture(r.TEXTURE1);r.bindTexture(r.TEXTURE_2D,u);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGB,S.x-8,S.y-8,16,16,0);r.uniform1i(h.renderType,0);r.uniform2f(h.scale,w.x,w.y);r.uniform3f(h.screenPosition,M.x,M.y,M.z);r.disable(r.BLEND);r.enable(r.DEPTH_TEST);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);r.activeTexture(r.TEXTURE0);r.bindTexture(r.TEXTURE_2D,c);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,S.x-8,S.y-8,16,16,0);r.uniform1i(h.renderType,1);r.disable(r.DEPTH_TEST);r.activeTexture(r.TEXTURE1);r.bindTexture(r.TEXTURE_2D,u);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);E.positionScreen.copy(M);if(E.customUpdateCallback){E.customUpdateCallback(E)}else{E.updateLensFlares()}r.uniform1i(h.renderType,2);r.enable(r.BLEND);for(var A=0,L=E.lensFlares.length;A<L;A++){var P=E.lensFlares[A];if(P.opacity>.001&&P.scale>.001){M.x=P.x;M.y=P.y;M.z=P.z;b=P.size*P.scale/v;w.x=b*y;w.y=b;r.uniform3f(h.screenPosition,M.x,M.y,M.z);r.uniform2f(h.scale,w.x,w.y);r.uniform1f(h.rotation,P.rotation);r.uniform1f(h.opacity,P.opacity);r.uniform3f(h.color,P.color.r,P.color.g,P.color.b);e.state.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst);e.setTexture(P.texture,1);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}}}}r.enable(r.CULL_FACE);r.enable(r.DEPTH_TEST);r.depthMask(true);e.resetGLState()};function d(t){var i=r.createProgram();var n=r.createShader(r.FRAGMENT_SHADER);var a=r.createShader(r.VERTEX_SHADER);var o="precision "+e.getPrecision()+" float;\n";r.shaderSource(n,o+t.fragmentShader);r.shaderSource(a,o+t.vertexShader);r.compileShader(n);r.compileShader(a);r.attachShader(i,n);r.attachShader(i,a);r.linkProgram(i);return i}};n.ShadowMapPlugin=function(e,t,r,i){var a=e.context;var o,s,h,l,u=new n.Frustum,c=new n.Matrix4,f=new n.Vector3,d=new n.Vector3,p=new n.Vector3,m=[];var v=n.ShaderLib["depthRGBA"];var g=n.UniformsUtils.clone(v.uniforms);o=new n.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader});s=new n.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:true});h=new n.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,skinning:true});l=new n.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:true,skinning:true});o._shadowPass=true;s._shadowPass=true;h._shadowPass=true;l._shadowPass=true;this.render=function(r,f){if(e.shadowMapEnabled===false)return;var d,v,g,M,S,C,T,E,A,L,P,R,F,B=[],U=0,D=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);if(e.shadowMapCullFace===n.CullFaceFront){a.cullFace(a.FRONT)}else{a.cullFace(a.BACK)}e.state.setDepthTest(true);for(d=0,v=t.length;d<v;d++){F=t[d];if(!F.castShadow)continue;if(F instanceof n.DirectionalLight&&F.shadowCascade){for(S=0;S<F.shadowCascadeCount;S++){var k;if(!F.shadowCascadeArray[S]){k=x(F,S);k.originalCamera=f;var V=new n.Gyroscope;V.position.copy(F.shadowCascadeOffset);V.add(k);V.add(k.target);f.add(V);F.shadowCascadeArray[S]=k}else{k=F.shadowCascadeArray[S]}_(F,S);B[U]=k;U++}}else{B[U]=F;U++}}for(d=0,v=B.length;d<v;d++){F=B[d];if(!F.shadowMap){var N=n.LinearFilter;if(e.shadowMapType===n.PCFSoftShadowMap){N=n.NearestFilter}var O={minFilter:N,magFilter:N,format:n.RGBAFormat};F.shadowMap=new n.WebGLRenderTarget(F.shadowMapWidth,F.shadowMapHeight,O);F.shadowMapSize=new n.Vector2(F.shadowMapWidth,F.shadowMapHeight);F.shadowMatrix=new n.Matrix4}if(!F.shadowCamera){if(F instanceof n.SpotLight){F.shadowCamera=new n.PerspectiveCamera(F.shadowCameraFov,F.shadowMapWidth/F.shadowMapHeight,F.shadowCameraNear,F.shadowCameraFar)}else if(F instanceof n.DirectionalLight){F.shadowCamera=new n.OrthographicCamera(F.shadowCameraLeft,F.shadowCameraRight,F.shadowCameraTop,F.shadowCameraBottom,F.shadowCameraNear,F.shadowCameraFar)}else{n.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",F);continue}r.add(F.shadowCamera);if(r.autoUpdate===true)r.updateMatrixWorld()}if(F.shadowCameraVisible&&!F.cameraHelper){F.cameraHelper=new n.CameraHelper(F.shadowCamera);r.add(F.cameraHelper)}if(F.isVirtual&&k.originalCamera==f){b(f,F)}
C=F.shadowMap;T=F.shadowMatrix;E=F.shadowCamera;E.position.setFromMatrixPosition(F.matrixWorld);p.setFromMatrixPosition(F.target.matrixWorld);E.lookAt(p);E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);if(F.cameraHelper)F.cameraHelper.visible=F.shadowCameraVisible;if(F.shadowCameraVisible)F.cameraHelper.update();T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);T.multiply(E.projectionMatrix);T.multiply(E.matrixWorldInverse);c.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse);u.setFromMatrix(c);e.setRenderTarget(C);e.clear();m.length=0;y(r,r,E);var z,I,G;for(g=0,M=m.length;g<M;g++){P=m[g];R=P.object;A=P.buffer;z=w(R);I=R.geometry.morphTargets!==undefined&&R.geometry.morphTargets.length>0&&z.morphTargets;G=R instanceof n.SkinnedMesh&&z.skinning;if(R.customDepthMaterial){L=R.customDepthMaterial}else if(G){L=I?l:h}else if(I){L=s}else{L=o}e.setMaterialFaces(z);if(A instanceof n.BufferGeometry){e.renderBufferDirect(E,t,D,L,A,R)}else{e.renderBuffer(E,t,D,L,A,R)}}for(g=0,M=i.length;g<M;g++){P=i[g];R=P.object;if(R.visible&&R.castShadow){R._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,R.matrixWorld);e.renderImmediateObject(E,t,D,o,R)}}}var H=e.getClearColor(),W=e.getClearAlpha();a.clearColor(H.r,H.g,H.b,W);a.enable(a.BLEND);if(e.shadowMapCullFace===n.CullFaceFront){a.cullFace(a.BACK)}e.resetGLState()};function y(e,t,i){if(t.visible){var n=r[t.id];if(n&&t.castShadow&&(t.frustumCulled===false||u.intersectsObject(t)===true)){for(var a=0,o=n.length;a<o;a++){var s=n[a];t._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld);m.push(s)}}for(var a=0,o=t.children.length;a<o;a++){y(e,t.children[a],i)}}}function x(e,t){var r=new n.DirectionalLight;r.isVirtual=true;r.onlyShadow=true;r.castShadow=true;r.shadowCameraNear=e.shadowCameraNear;r.shadowCameraFar=e.shadowCameraFar;r.shadowCameraLeft=e.shadowCameraLeft;r.shadowCameraRight=e.shadowCameraRight;r.shadowCameraBottom=e.shadowCameraBottom;r.shadowCameraTop=e.shadowCameraTop;r.shadowCameraVisible=e.shadowCameraVisible;r.shadowDarkness=e.shadowDarkness;r.shadowBias=e.shadowCascadeBias[t];r.shadowMapWidth=e.shadowCascadeWidth[t];r.shadowMapHeight=e.shadowCascadeHeight[t];r.pointsWorld=[];r.pointsFrustum=[];var i=r.pointsWorld,a=r.pointsFrustum;for(var o=0;o<8;o++){i[o]=new n.Vector3;a[o]=new n.Vector3}var s=e.shadowCascadeNearZ[t];var h=e.shadowCascadeFarZ[t];a[0].set(-1,-1,s);a[1].set(1,-1,s);a[2].set(-1,1,s);a[3].set(1,1,s);a[4].set(-1,-1,h);a[5].set(1,-1,h);a[6].set(-1,1,h);a[7].set(1,1,h);return r}function _(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position);r.target.position.copy(e.target.position);r.lookAt(r.target);r.shadowCameraVisible=e.shadowCameraVisible;r.shadowDarkness=e.shadowDarkness;r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t];var n=e.shadowCascadeFarZ[t];var a=r.pointsFrustum;a[0].z=i;a[1].z=i;a[2].z=i;a[3].z=i;a[4].z=n;a[5].z=n;a[6].z=n;a[7].z=n}function b(e,t){var r=t.shadowCamera,i=t.pointsFrustum,n=t.pointsWorld;f.set(Infinity,Infinity,Infinity);d.set(-Infinity,-Infinity,-Infinity);for(var a=0;a<8;a++){var o=n[a];o.copy(i[a]);o.unproject(e);o.applyMatrix4(r.matrixWorldInverse);if(o.x<f.x)f.x=o.x;if(o.x>d.x)d.x=o.x;if(o.y<f.y)f.y=o.y;if(o.y>d.y)d.y=o.y;if(o.z<f.z)f.z=o.z;if(o.z>d.z)d.z=o.z}r.left=f.x;r.right=d.x;r.top=d.y;r.bottom=f.y;r.updateProjectionMatrix()}function w(e){return e.material instanceof n.MeshFaceMaterial?e.material.materials[0]:e.material}};n.SpritePlugin=function(e,t){var r=e.context;var i,a;var o,s,h;var l;var u=new n.Vector3;var c=new n.Quaternion;var f=new n.Vector3;var d=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);i=r.createBuffer();a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);o=p();s={position:r.getAttribLocation(o,"position"),uv:r.getAttribLocation(o,"uv")};h={uvOffset:r.getUniformLocation(o,"uvOffset"),uvScale:r.getUniformLocation(o,"uvScale"),rotation:r.getUniformLocation(o,"rotation"),scale:r.getUniformLocation(o,"scale"),color:r.getUniformLocation(o,"color"),map:r.getUniformLocation(o,"map"),opacity:r.getUniformLocation(o,"opacity"),modelViewMatrix:r.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(o,"projectionMatrix"),fogType:r.getUniformLocation(o,"fogType"),fogDensity:r.getUniformLocation(o,"fogDensity"),fogNear:r.getUniformLocation(o,"fogNear"),fogFar:r.getUniformLocation(o,"fogFar"),fogColor:r.getUniformLocation(o,"fogColor"),alphaTest:r.getUniformLocation(o,"alphaTest")};var u=document.createElement("canvas");u.width=8;u.height=8;var c=u.getContext("2d");c.fillStyle="white";c.fillRect(0,0,8,8);l=new n.Texture(u);l.needsUpdate=true};this.render=function(p,v){if(t.length===0)return;if(o===undefined){d()}r.useProgram(o);r.enableVertexAttribArray(s.position);r.enableVertexAttribArray(s.uv);r.disable(r.CULL_FACE);r.enable(r.BLEND);r.bindBuffer(r.ARRAY_BUFFER,i);r.vertexAttribPointer(s.position,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(s.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.uniformMatrix4fv(h.projectionMatrix,false,v.projectionMatrix.elements);r.activeTexture(r.TEXTURE0);r.uniform1i(h.map,0);var g=0;var y=0;var x=p.fog;if(x){r.uniform3f(h.fogColor,x.color.r,x.color.g,x.color.b);if(x instanceof n.Fog){r.uniform1f(h.fogNear,x.near);r.uniform1f(h.fogFar,x.far);r.uniform1i(h.fogType,1);g=1;y=1}else if(x instanceof n.FogExp2){r.uniform1f(h.fogDensity,x.density);r.uniform1i(h.fogType,2);g=2;y=2}}else{r.uniform1i(h.fogType,0);g=0;y=0}for(var _=0,b=t.length;_<b;_++){var w=t[_];w._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,w.matrixWorld);w.z=-w._modelViewMatrix.elements[14]}t.sort(m);var M=[];for(var _=0,b=t.length;_<b;_++){var w=t[_];var S=w.material;r.uniform1f(h.alphaTest,S.alphaTest);r.uniformMatrix4fv(h.modelViewMatrix,false,w._modelViewMatrix.elements);w.matrixWorld.decompose(u,c,f);M[0]=f.x;M[1]=f.y;var C=0;if(p.fog&&S.fog){C=y}if(g!==C){r.uniform1i(h.fogType,C);g=C}if(S.map!==null){r.uniform2f(h.uvOffset,S.map.offset.x,S.map.offset.y);r.uniform2f(h.uvScale,S.map.repeat.x,S.map.repeat.y)}else{r.uniform2f(h.uvOffset,0,0);r.uniform2f(h.uvScale,1,1)}r.uniform1f(h.opacity,S.opacity);r.uniform3f(h.color,S.color.r,S.color.g,S.color.b);r.uniform1f(h.rotation,S.rotation);r.uniform2fv(h.scale,M);e.state.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst);e.state.setDepthTest(S.depthTest);e.state.setDepthWrite(S.depthWrite);if(S.map&&S.map.image&&S.map.image.width){e.setTexture(S.map,0)}else{e.setTexture(l,0)}r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}r.enable(r.CULL_FACE);e.resetGLState()};function p(){var t=r.createProgram();var i=r.createShader(r.VERTEX_SHADER);var n=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));r.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));r.compileShader(i);r.compileShader(n);r.attachShader(t,i);r.attachShader(t,n);r.linkProgram(t);return t}function m(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}};n.GeometryUtils={merge:function(e,t,r){n.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;if(t instanceof n.Mesh){t.matrixAutoUpdate&&t.updateMatrix();i=t.matrix;t=t.geometry}e.merge(t,i,r)},center:function(e){n.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};n.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,r,i){var a=new n.ImageLoader;a.crossOrigin=this.crossOrigin;var o=new n.Texture(undefined,t);a.load(e,function(e){o.image=e;o.needsUpdate=true;if(r)r(o)},undefined,function(e){if(i)i(e)});o.sourceFile=e;return o},loadTextureCube:function(e,t,r,i){var a=[];var o=new n.ImageLoader;o.crossOrigin=this.crossOrigin;var s=new n.CubeTexture(a,t);s.flipY=false;var h=0;var l=function(t){o.load(e[t],function(e){s.images[t]=e;h+=1;if(h===6){s.needsUpdate=true;if(r)r(s)}},undefined,i)};for(var u=0,c=e.length;u<c;++u){l(u)}return s},loadCompressedTexture:function(){n.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){n.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var a=e.width;var o=e.height;var s=document.createElement("canvas");s.width=a;s.height=o;var h=s.getContext("2d");h.drawImage(e,0,0);var l=h.getImageData(0,0,a,o).data;var u=h.createImageData(a,o);var c=u.data;for(var f=0;f<a;f++){for(var d=0;d<o;d++){var p=d-1<0?0:d-1;var m=d+1>o-1?o-1:d+1;var v=f-1<0?0:f-1;var g=f+1>a-1?a-1:f+1;var y=[];var x=[0,0,l[(d*a+f)*4]/255*t];y.push([-1,0,l[(d*a+v)*4]/255*t]);y.push([-1,-1,l[(p*a+v)*4]/255*t]);y.push([0,-1,l[(p*a+f)*4]/255*t]);y.push([1,-1,l[(p*a+g)*4]/255*t]);y.push([1,0,l[(d*a+g)*4]/255*t]);y.push([1,1,l[(m*a+g)*4]/255*t]);y.push([0,1,l[(m*a+f)*4]/255*t]);y.push([-1,1,l[(m*a+v)*4]/255*t]);var _=[];var b=y.length;for(var w=0;w<b;w++){var M=y[w];var S=y[(w+1)%b];M=i(M,x);S=i(S,x);_.push(n(r(M,S)))}var C=[0,0,0];for(var w=0;w<_.length;w++){C[0]+=_[w][0];C[1]+=_[w][1];C[2]+=_[w][2]}C[0]/=_.length;C[1]/=_.length;C[2]/=_.length;var T=(d*a+f)*4;c[T]=(C[0]+1)/2*255|0;c[T+1]=(C[1]+1)/2*255|0;c[T+2]=C[2]*255|0;c[T+3]=255}}h.putImageData(u,0,0);return s},generateDataTexture:function(e,t,r){var i=e*t;var a=new Uint8Array(3*i);var o=Math.floor(r.r*255);var s=Math.floor(r.g*255);var h=Math.floor(r.b*255);for(var l=0;l<i;l++){a[l*3]=o;a[l*3+1]=s;a[l*3+2]=h}var u=new n.DataTexture(a,e,t,n.RGBFormat);u.needsUpdate=true;return u}};n.SceneUtils={createMultiMaterialObject:function(e,t){var r=new n.Object3D;for(var i=0,a=t.length;i<a;i++){r.add(new n.Mesh(e,t[i]))}return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld);t.remove(e);r.add(e)},attach:function(e,t,r){var i=new n.Matrix4;i.getInverse(r.matrixWorld);e.applyMatrix(i);t.remove(e);r.add(e)}};n.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();var r=this;r.faces[t]=r.faces[t]||{};r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{};r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),i=this.size/r.resolution,a=0,o=String(e).split(""),s=o.length;var h=[];for(t=0;t<s;t++){var l=new n.Path;var u=this.extractGlyphPoints(o[t],r,i,a,l);a+=u.offset;h.push(u.path)}var c=a/2;return{paths:h,offset:c}},extractGlyphPoints:function(e,t,r,i,a){var o=[];var s,h,l,u,c,f,d,p,m,v,g,y,x,_,b,w,M,S,C,T=t.glyphs[e]||t.glyphs["?"];if(!T)return;if(T.o){u=T._cachedOutline||(T._cachedOutline=T.o.split(" "));f=u.length;d=r;p=r;for(s=0;s<f;){c=u[s++];switch(c){case"m":m=u[s++]*d+i;v=u[s++]*p;a.moveTo(m,v);break;case"l":m=u[s++]*d+i;v=u[s++]*p;a.lineTo(m,v);break;case"q":g=u[s++]*d+i;y=u[s++]*p;b=u[s++]*d+i;w=u[s++]*p;a.quadraticCurveTo(b,w,g,y);C=o[o.length-1];if(C){x=C.x;_=C.y;for(h=1,l=this.divisions;h<=l;h++){var E=h/l;n.Shape.Utils.b2(E,x,b,g);n.Shape.Utils.b2(E,_,w,y)}}break;case"b":g=u[s++]*d+i;y=u[s++]*p;b=u[s++]*d+i;w=u[s++]*p;M=u[s++]*d+i;S=u[s++]*p;a.bezierCurveTo(b,w,M,S,g,y);C=o[o.length-1];if(C){x=C.x;_=C.y;for(h=1,l=this.divisions;h<=l;h++){var E=h/l;n.Shape.Utils.b3(E,x,b,M,g);n.Shape.Utils.b3(E,_,w,S,y)}}break}}}return{offset:T.ha*r,path:a}}};n.FontUtils.generateShapes=function(e,t){t=t||{};var r=t.size!==undefined?t.size:100;var i=t.curveSegments!==undefined?t.curveSegments:4;var a=t.font!==undefined?t.font:"helvetiker";var o=t.weight!==undefined?t.weight:"normal";var s=t.style!==undefined?t.style:"normal";n.FontUtils.size=r;n.FontUtils.divisions=i;n.FontUtils.face=a;n.FontUtils.weight=o;n.FontUtils.style=s;var h=n.FontUtils.drawText(e);var l=h.paths;var u=[];for(var c=0,f=l.length;c<f;c++){Array.prototype.push.apply(u,l[c].toShapes())}return u};(function(e){var t=1e-10;var r=function(e,t){var r=e.length;if(r<3)return null;var o=[],s=[],h=[];var l,u,c;if(i(e)>0){for(u=0;u<r;u++)s[u]=u}else{for(u=0;u<r;u++)s[u]=r-1-u}var f=r;var d=2*f;for(u=f-1;f>2;){if(d--<=0){n.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");if(t)return h;return o}l=u;if(f<=l)l=0;u=l+1;if(f<=u)u=0;c=u+1;if(f<=c)c=0;if(a(e,l,u,c,f,s)){var p,m,v,g,y;p=s[l];m=s[u];v=s[c];o.push([e[p],e[m],e[v]]);h.push([s[l],s[u],s[c]]);for(g=u,y=u+1;y<f;g++,y++){s[g]=s[y]}f--;d=2*f}}if(t)return h;return o};var i=function(e){var t=e.length;var r=0;for(var i=t-1,n=0;n<t;i=n++){r+=e[i].x*e[n].y-e[n].x*e[i].y}return r*.5};var a=function(e,r,i,n,a,o){var s;var h,l,u,c;var f,d,p,m;h=e[o[r]].x;l=e[o[r]].y;u=e[o[i]].x;c=e[o[i]].y;f=e[o[n]].x;d=e[o[n]].y;if(t>(u-h)*(d-l)-(c-l)*(f-h))return false;var v,g,y,x,_,b;var w,M,S,C,T,E;var A,L,P;v=f-u;g=d-c;y=h-f;x=l-d;_=u-h;b=c-l;for(s=0;s<a;s++){p=e[o[s]].x;m=e[o[s]].y;if(p===h&&m===l||p===u&&m===c||p===f&&m===d)continue;w=p-h;M=m-l;S=p-u;C=m-c;T=p-f;E=m-d;P=v*C-g*S;A=_*M-b*w;L=y*E-x*T;if(P>=-t&&L>=-t&&A>=-t)return false}return true};e.Triangulate=r;e.Triangulate.area=i;return e})(n.FontUtils);i._typeface_js={faces:n.FontUtils.faces,loadFace:n.FontUtils.loadFace};n.typeface_js=i._typeface_js;n.Audio=function(e){n.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.isPlaying=false};n.Audio.prototype=Object.create(n.Object3D.prototype);n.Audio.prototype.constructor=n.Audio;n.Audio.prototype.load=function(e){var t=this;var r=new XMLHttpRequest;r.open("GET",e,true);r.responseType="arraybuffer";r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e;if(t.autoplay)t.play()})};r.send();return this};n.Audio.prototype.play=function(){if(this.isPlaying===true){n.warn("THREE.Audio: Audio is already playing.");return}var e=this.context.createBufferSource();e.buffer=this.source.buffer;e.loop=this.source.loop;e.onended=this.source.onended;e.connect(this.panner);e.start(0,this.startTime);this.isPlaying=true;this.source=e};n.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};n.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};n.Audio.prototype.onEnded=function(){this.isPlaying=false};n.Audio.prototype.setLoop=function(e){this.source.loop=e};n.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e};n.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e};n.Audio.prototype.setVolume=function(e){this.gain.gain.value=e};n.Audio.prototype.updateMatrixWorld=function(){var e=new n.Vector3;return function(t){n.Object3D.prototype.updateMatrixWorld.call(this,t);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();n.AudioListener=function(){n.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};n.AudioListener.prototype=Object.create(n.Object3D.prototype);n.AudioListener.prototype.constructor=n.AudioListener;n.AudioListener.prototype.updateMatrixWorld=function(){var e=new n.Vector3;var t=new n.Quaternion;var r=new n.Vector3;var i=new n.Vector3;var a=new n.Vector3;var o=new n.Vector3;return function(s){n.Object3D.prototype.updateMatrixWorld.call(this,s);var h=this.context.listener;var l=this.up;this.matrixWorld.decompose(e,t,r);i.set(0,0,-1).applyQuaternion(t);a.subVectors(e,o);h.setPosition(e.x,e.y,e.z);h.setOrientation(i.x,i.y,i.z,l.x,l.y,l.z);h.setVelocity(a.x,a.y,a.z);o.copy(e)}}();n.Curve=function(){};n.Curve.prototype.getPoint=function(e){n.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};n.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};n.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPoint(t/e))}return r};n.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPointAt(t/e))}return r};n.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};n.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var r,i=this.getPoint(0);var n,a=0;t.push(0);for(n=1;n<=e;n++){r=this.getPoint(n/e);a+=r.distanceTo(i);t.push(a);i=r}this.cacheArcLengths=t;return t};n.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};n.Curve.prototype.getUtoTmapping=function(e,t){var r=this.getLengths();var i=0,n=r.length;var a;if(t){a=t}else{a=e*r[n-1]}var o=0,s=n-1,h;while(o<=s){i=Math.floor(o+(s-o)/2);h=r[i]-a;if(h<0){o=i+1}else if(h>0){s=i-1}else{s=i;break}}i=s;if(r[i]==a){var l=i/(n-1);return l}var u=r[i];var c=r[i+1];var f=c-u;var d=(a-u)/f;var l=(i+d)/(n-1);return l};n.Curve.prototype.getTangent=function(e){var t=1e-4;var r=e-t;var i=e+t;if(r<0)r=0;if(i>1)i=1;var n=this.getPoint(r);var a=this.getPoint(i);var o=a.clone().sub(n);return o.normalize()};n.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};n.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){var a=6*e*e-6*e;var o=3*e*e-4*e+1;var s=-6*e*e+6*e;var h=3*e*e-2*e;return a+o+s+h},interpolate:function(e,t,r,i,n){var a=(r-e)*.5;var o=(i-t)*.5;var s=n*n;var h=n*s;return(2*t-2*r+a+o)*h+(-3*t+3*r-2*a-o)*s+a*n+t}};n.Curve.create=function(e,t){e.prototype=Object.create(n.Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};n.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};n.CurvePath.prototype=Object.create(n.Curve.prototype);n.CurvePath.prototype.constructor=n.CurvePath;n.CurvePath.prototype.add=function(e){this.curves.push(e)};n.CurvePath.prototype.checkConnection=function(){};n.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new n.LineCurve(t,e))}};n.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var r=this.getCurveLengths();var i=0,n,a;while(i<r.length){if(r[i]>=t){n=r[i]-t;a=this.curves[i];var o=1-n/a.getLength();return a.getPointAt(o)}i++}return null};n.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};n.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var e=[],t=0;var r,i=this.curves.length;for(r=0;r<i;r++){t+=this.curves[r].getLength();e.push(t)}this.cacheLengths=e;return e};n.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,r,i;var a,o,s;t=r=Number.NEGATIVE_INFINITY;a=o=Number.POSITIVE_INFINITY;var h,l,u,c;var f=e[0]instanceof n.Vector3;c=f?new n.Vector3:new n.Vector2;for(l=0,u=e.length;l<u;l++){h=e[l];if(h.x>t)t=h.x;else if(h.x<a)a=h.x;if(h.y>r)r=h.y;else if(h.y<o)o=h.y;if(f){if(h.z>i)i=h.z;else if(h.z<s)s=h.z}c.add(h)}var d={minX:a,minY:o,maxX:t,maxY:r};if(f){d.maxZ=i;d.minZ=s}return d};n.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};n.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};n.CurvePath.prototype.createGeometry=function(e){var t=new n.Geometry;for(var r=0;r<e.length;r++){t.vertices.push(new n.Vector3(e[r].x,e[r].y,e[r].z||0))}return t};n.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};n.CurvePath.prototype.getTransformedPoints=function(e,t){var r=this.getPoints(e);var i,n;if(!t){t=this.bends}for(i=0,n=t.length;i<n;i++){r=this.getWrapPoints(r,t[i])}return r};n.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r=this.getSpacedPoints(e);var i,n;if(!t){t=this.bends}for(i=0,n=t.length;i<n;i++){r=this.getWrapPoints(r,t[i])}return r};n.CurvePath.prototype.getWrapPoints=function(e,t){var r=this.getBoundingBox();var i,n,a,o,s,h;for(i=0,n=e.length;i<n;i++){a=e[i];o=a.x;s=a.y;h=o/r.maxX;h=t.getUtoTmapping(h,o);var l=t.getPoint(h);var u=t.getTangent(h);u.set(-u.y,u.x).multiplyScalar(s);a.x=l.x+u.x;a.y=l.y+u.y}return e};n.Gyroscope=function(){n.Object3D.call(this)};n.Gyroscope.prototype=Object.create(n.Object3D.prototype);n.Gyroscope.prototype.constructor=n.Gyroscope;n.Gyroscope.prototype.updateMatrixWorld=function(){var e=new n.Vector3;var t=new n.Quaternion;var r=new n.Vector3;var i=new n.Vector3;var a=new n.Quaternion;var o=new n.Vector3;return function(n){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||n){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(i,a,o);this.matrix.decompose(e,t,r);this.matrixWorld.compose(i,t,o)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;n=true}for(var s=0,h=this.children.length;s<h;s++){this.children[s].updateMatrixWorld(n)}}}();n.Path=function(e){n.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};n.Path.prototype=Object.create(n.CurvePath.prototype);n.Path.prototype.constructor=n.Path;n.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};n.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++){this.lineTo(e[t].x,e[t].y)}};n.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:n.PathActions.MOVE_TO,args:r})};n.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments);var i=this.actions[this.actions.length-1].args;var a=i[i.length-2];var o=i[i.length-1];var s=new n.LineCurve(new n.Vector2(a,o),new n.Vector2(e,t));this.curves.push(s);this.actions.push({action:n.PathActions.LINE_TO,args:r})};n.Path.prototype.quadraticCurveTo=function(e,t,r,i){var a=Array.prototype.slice.call(arguments);var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];var l=new n.QuadraticBezierCurve(new n.Vector2(s,h),new n.Vector2(e,t),new n.Vector2(r,i));this.curves.push(l);this.actions.push({action:n.PathActions.QUADRATIC_CURVE_TO,args:a})};n.Path.prototype.bezierCurveTo=function(e,t,r,i,a,o){var s=Array.prototype.slice.call(arguments);var h=this.actions[this.actions.length-1].args;var l=h[h.length-2];var u=h[h.length-1];var c=new n.CubicBezierCurve(new n.Vector2(l,u),new n.Vector2(e,t),new n.Vector2(r,i),new n.Vector2(a,o));this.curves.push(c);this.actions.push({action:n.PathActions.BEZIER_CURVE_TO,args:s})};n.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var i=r[r.length-2];var a=r[r.length-1];var o=[new n.Vector2(i,a)];Array.prototype.push.apply(o,e);var s=new n.SplineCurve(o);this.curves.push(s);this.actions.push({action:n.PathActions.CSPLINE_THRU,args:t})};n.Path.prototype.arc=function(e,t,r,i,n,a){var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];this.absarc(e+s,t+h,r,i,n,a)};n.Path.prototype.absarc=function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)};n.Path.prototype.ellipse=function(e,t,r,i,n,a,o){var s=this.actions[this.actions.length-1].args;var h=s[s.length-2];var l=s[s.length-1];this.absellipse(e+h,t+l,r,i,n,a,o)};n.Path.prototype.absellipse=function(e,t,r,i,a,o,s){var h=Array.prototype.slice.call(arguments);var l=new n.EllipseCurve(e,t,r,i,a,o,s);this.curves.push(l);var u=l.getPoint(1);h.push(u.x);h.push(u.y);this.actions.push({action:n.PathActions.ELLIPSE,args:h})};n.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var r=[];for(var i=0;i<e;i++){r.push(this.getPoint(i/e))}return r};n.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}e=e||12;var r=[];var i,a,o,s,h;var l,u,c,f,d,p,m,v,g,y,x,_,b;for(i=0,a=this.actions.length;i<a;i++){o=this.actions[i];s=o.action;h=o.args;switch(s){case n.PathActions.MOVE_TO:r.push(new n.Vector2(h[0],h[1]));break;case n.PathActions.LINE_TO:r.push(new n.Vector2(h[0],h[1]));break;case n.PathActions.QUADRATIC_CURVE_TO:l=h[2];u=h[3];d=h[0];p=h[1];if(r.length>0){g=r[r.length-1];m=g.x;v=g.y}else{g=this.actions[i-1].args;m=g[g.length-2];v=g[g.length-1]}for(y=1;y<=e;y++){x=y/e;_=n.Shape.Utils.b2(x,m,d,l);b=n.Shape.Utils.b2(x,v,p,u);r.push(new n.Vector2(_,b))}break;case n.PathActions.BEZIER_CURVE_TO:l=h[4];u=h[5];d=h[0];p=h[1];c=h[2];f=h[3];if(r.length>0){g=r[r.length-1];m=g.x;v=g.y}else{g=this.actions[i-1].args;m=g[g.length-2];v=g[g.length-1]}for(y=1;y<=e;y++){x=y/e;_=n.Shape.Utils.b3(x,m,d,c,l);b=n.Shape.Utils.b3(x,v,p,f,u);r.push(new n.Vector2(_,b))}break;case n.PathActions.CSPLINE_THRU:g=this.actions[i-1].args;var w=new n.Vector2(g[g.length-2],g[g.length-1]);var M=[w];var S=e*h[0].length;M=M.concat(h[0]);var C=new n.SplineCurve(M);for(y=1;y<=S;y++){r.push(C.getPointAt(y/S))}break;case n.PathActions.ARC:var T=h[0],E=h[1],A=h[2],L=h[3],P=h[4],R=!!h[5];var F=P-L;var B;var U=e*2;for(y=1;y<=U;y++){x=y/U;if(!R){x=1-x}B=L+x*F;_=T+A*Math.cos(B);b=E+A*Math.sin(B);r.push(new n.Vector2(_,b))}break;case n.PathActions.ELLIPSE:var T=h[0],E=h[1],D=h[2],k=h[3],L=h[4],P=h[5],R=!!h[6];var F=P-L;var B;var U=e*2;for(y=1;y<=U;y++){x=y/U;if(!R){x=1-x}B=L+x*F;_=T+D*Math.cos(B);b=E+k*Math.sin(B);r.push(new n.Vector2(_,b))}break}}var V=r[r.length-1];var N=1e-10;if(Math.abs(V.x-r[0].x)<N&&Math.abs(V.y-r[0].y)<N)r.splice(r.length-1,1);if(t){r.push(r[0])}return r};n.Path.prototype.toShapes=function(e,t){function r(e){var t,r,i,a,o;var s=[],h=new n.Path;for(t=0,r=e.length;t<r;t++){i=e[t];o=i.args;a=i.action;if(a==n.PathActions.MOVE_TO){if(h.actions.length!=0){s.push(h);h=new n.Path}}h[a].apply(h,o)}if(h.actions.length!=0){s.push(h)}return s}function i(e){var t=[];for(var r=0,i=e.length;r<i;r++){var a=e[r];var o=new n.Shape;o.actions=a.actions;o.curves=a.curves;t.push(o)}return t}function a(e,t){var r=1e-10;var i=t.length;var n=false;for(var a=i-1,o=0;o<i;a=o++){var s=t[a];var h=t[o];var l=h.x-s.x;var u=h.y-s.y;if(Math.abs(u)>r){if(u<0){s=t[o];l=-l;h=t[a];u=-u}if(e.y<s.y||e.y>h.y)continue;if(e.y==s.y){if(e.x==s.x)return true}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(c==0)return true;if(c<0)continue;n=!n}}else{if(e.y!=s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return true}}return n}var o=r(this.actions);if(o.length==0)return[];if(t===true)return i(o);var s,h,l,u=[];if(o.length==1){h=o[0];l=new n.Shape;l.actions=h.actions;l.curves=h.curves;u.push(l);return u}var c=!n.Shape.Utils.isClockWise(o[0].getPoints());c=e?!c:c;var f=[];var d=[];var p=[];var m=0;var v;d[m]=undefined;p[m]=[];var g,y;for(g=0,y=o.length;g<y;g++){h=o[g];v=h.getPoints();s=n.Shape.Utils.isClockWise(v);s=e?!s:s;if(s){if(!c&&d[m])m++;d[m]={s:new n.Shape,p:v};d[m].s.actions=h.actions;d[m].s.curves=h.curves;if(c)m++;p[m]=[]}else{p[m].push({h:h,p:v[0]})}}if(!d[0])return i(o);if(d.length>1){var x=false;var _=[];for(var b=0,w=d.length;b<w;b++){f[b]=[]}for(var b=0,w=d.length;b<w;b++){var M=p[b];for(var S=0;S<M.length;S++){var C=M[S];var T=true;for(var E=0;E<d.length;E++){if(a(C.p,d[E].p)){if(b!=E)_.push({froms:b,tos:E,hole:S});if(T){T=false;f[E].push(C)}else{x=true}}}if(T){f[b].push(C)}}}if(_.length>0){if(!x)p=f}}var A,L,P;for(g=0,y=d.length;g<y;g++){l=d[g].s;u.push(l);A=p[g];for(L=0,P=A.length;L<P;L++){l.holes.push(A[L].h)}}return u};n.Shape=function(){n.Path.apply(this,arguments);this.holes=[]};n.Shape.prototype=Object.create(n.Path.prototype);n.Shape.prototype.constructor=n.Shape;n.Shape.prototype.extrude=function(e){var t=new n.ExtrudeGeometry(this,e);return t};n.Shape.prototype.makeGeometry=function(e){var t=new n.ShapeGeometry(this,e);return t};n.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++){i[t]=this.holes[t].getTransformedPoints(e,this.bends)}return i};n.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++){i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return i};n.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};n.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};n.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};n.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){if(e.x!=t.x){if(e.x<t.x){return e.x<=r.x&&r.x<=t.x}else{return t.x<=r.x&&r.x<=e.x}}else{if(e.y<t.y){return e.y<=r.y&&r.y<=t.y}else{return t.y<=r.y&&r.y<=e.y}}}function i(e,t,i,n,a){var o=1e-10;var s=t.x-e.x,h=t.y-e.y;var l=n.x-i.x,u=n.y-i.y;var c=e.x-i.x;var f=e.y-i.y;var d=h*l-s*u;var p=h*c-s*f;if(Math.abs(d)>o){var m;if(d>0){if(p<0||p>d)return[];m=u*c-l*f;if(m<0||m>d)return[]}else{if(p>0||p<d)return[];m=u*c-l*f;if(m>0||m<d)return[]}if(m==0){if(a&&(p==0||p==d))return[];return[e]}if(m==d){if(a&&(p==0||p==d))return[];return[t]}if(p==0)return[i];if(p==d)return[n];var v=m/d;return[{x:e.x+v*s,y:e.y+v*h}]}else{if(p!=0||u*c!=l*f)return[];var g=s==0&&h==0;var y=l==0&&u==0;if(g&&y){if(e.x!=i.x||e.y!=i.y)return[];return[e]}if(g){if(!r(i,n,e))return[];return[e]}if(y){if(!r(e,t,i))return[];return[i]}var x,_,b,w;var M,S,C,T;if(s!=0){if(e.x<t.x){x=e;b=e.x;_=t;w=t.x;

}else{x=t;b=t.x;_=e;w=e.x}if(i.x<n.x){M=i;C=i.x;S=n;T=n.x}else{M=n;C=n.x;S=i;T=i.x}}else{if(e.y<t.y){x=e;b=e.y;_=t;w=t.y}else{x=t;b=t.y;_=e;w=e.y}if(i.y<n.y){M=i;C=i.y;S=n;T=n.y}else{M=n;C=n.y;S=i;T=i.y}}if(b<=C){if(w<C)return[];if(w==C){if(a)return[];return[M]}if(w<=T)return[M,_];return[M,S]}else{if(b>T)return[];if(b==T){if(a)return[];return[x]}if(w<=T)return[x,_];return[x,S]}}}function a(e,t,r,i){var n=1e-10;var a=t.x-e.x,o=t.y-e.y;var s=r.x-e.x,h=r.y-e.y;var l=i.x-e.x,u=i.y-e.y;var c=a*h-o*s;var f=a*u-o*l;if(Math.abs(c)>n){var d=l*h-u*s;if(c>0){return f>=0&&d>=0}else{return f>=0||d>=0}}else{return f>0}}function o(e,t){var r=e.concat();var n;function o(e,t){var i=r.length-1;var o=e-1;if(o<0)o=i;var s=e+1;if(s>i)s=0;var h=a(r[e],r[o],r[s],n[t]);if(!h){return false}var l=n.length-1;var u=t-1;if(u<0)u=l;var c=t+1;if(c>l)c=0;h=a(n[t],n[u],n[c],r[e]);if(!h){return false}return true}function s(e,t){var n,a,o;for(n=0;n<r.length;n++){a=n+1;a%=r.length;o=i(e,t,r[n],r[a],true);if(o.length>0)return true}return false}var h=[];function l(e,r){var n,a,o,s,l;for(n=0;n<h.length;n++){a=t[h[n]];for(o=0;o<a.length;o++){s=o+1;s%=a.length;l=i(e,r,a[o],a[s],true);if(l.length>0)return true}}return false}var u,c,f,d,p,m,v=[],g,y,x,_;for(var b=0,w=t.length;b<w;b++){h.push(b)}var M=0;var S=h.length*2;while(h.length>0){S--;if(S<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(c=M;c<r.length;c++){f=r[c];u=-1;for(var b=0;b<h.length;b++){p=h[b];m=f.x+":"+f.y+":"+p;if(v[m]!==undefined)continue;n=t[p];for(var C=0;C<n.length;C++){d=n[C];if(!o(c,C))continue;if(s(f,d))continue;if(l(f,d))continue;u=C;h.splice(b,1);g=r.slice(0,c+1);y=r.slice(c);x=n.slice(u);_=n.slice(0,u+1);r=g.concat(x).concat(_).concat(y);M=c;break}if(u>=0)break;v[m]=true}if(u>=0)break}}return r}var s,h,l,u,c,f,d={};var p=e.concat();for(var m=0,v=t.length;m<v;m++){Array.prototype.push.apply(p,t[m])}for(s=0,h=p.length;s<h;s++){c=p[s].x+":"+p[s].y;if(d[c]!==undefined){n.warn("THREE.Shape: Duplicate point",c)}d[c]=s}var g=o(e,t);var y=n.FontUtils.Triangulate(g,false);for(s=0,h=y.length;s<h;s++){u=y[s];for(l=0;l<3;l++){c=u[l].x+":"+u[l].y;f=d[c];if(f!==undefined){u[l]=f}}}return y.concat()},isClockWise:function(e){return n.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}};n.LineCurve=function(e,t){this.v1=e;this.v2=t};n.LineCurve.prototype=Object.create(n.Curve.prototype);n.LineCurve.prototype.constructor=n.LineCurve;n.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};n.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};n.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};n.QuadraticBezierCurve=function(e,t,r){this.v0=e;this.v1=t;this.v2=r};n.QuadraticBezierCurve.prototype=Object.create(n.Curve.prototype);n.QuadraticBezierCurve.prototype.constructor=n.QuadraticBezierCurve;n.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new n.Vector2;t.x=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return t};n.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new n.Vector2;t.x=n.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);t.y=n.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);return t.normalize()};n.CubicBezierCurve=function(e,t,r,i){this.v0=e;this.v1=t;this.v2=r;this.v3=i};n.CubicBezierCurve.prototype=Object.create(n.Curve.prototype);n.CubicBezierCurve.prototype.constructor=n.CubicBezierCurve;n.CubicBezierCurve.prototype.getPoint=function(e){var t,r;t=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new n.Vector2(t,r)};n.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=n.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r=n.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new n.Vector2(t,r);i.normalize();return i};n.SplineCurve=function(e){this.points=e==undefined?[]:e};n.SplineCurve.prototype=Object.create(n.Curve.prototype);n.SplineCurve.prototype.constructor=n.SplineCurve;n.SplineCurve.prototype.getPoint=function(e){var t=this.points;var r=(t.length-1)*e;var i=Math.floor(r);var a=r-i;var o=t[i==0?i:i-1];var s=t[i];var h=t[i>t.length-2?t.length-1:i+1];var l=t[i>t.length-3?t.length-1:i+2];var u=new n.Vector2;u.x=n.Curve.Utils.interpolate(o.x,s.x,h.x,l.x,a);u.y=n.Curve.Utils.interpolate(o.y,s.y,h.y,l.y,a);return u};n.EllipseCurve=function(e,t,r,i,n,a,o){this.aX=e;this.aY=t;this.xRadius=r;this.yRadius=i;this.aStartAngle=n;this.aEndAngle=a;this.aClockwise=o};n.EllipseCurve.prototype=Object.create(n.Curve.prototype);n.EllipseCurve.prototype.constructor=n.EllipseCurve;n.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(t<0)t+=Math.PI*2;if(t>Math.PI*2)t-=Math.PI*2;var r;if(this.aClockwise===true){r=this.aEndAngle+(1-e)*(Math.PI*2-t)}else{r=this.aStartAngle+e*t}var i=new n.Vector2;i.x=this.aX+this.xRadius*Math.cos(r);i.y=this.aY+this.yRadius*Math.sin(r);return i};n.ArcCurve=function(e,t,r,i,a,o){n.EllipseCurve.call(this,e,t,r,r,i,a,o)};n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype);n.ArcCurve.prototype.constructor=n.ArcCurve;n.LineCurve3=n.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new n.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});n.QuadraticBezierCurve3=n.Curve.create(function(e,t,r){this.v0=e;this.v1=t;this.v2=r},function(e){var t=new n.Vector3;t.x=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);t.z=n.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return t});n.CubicBezierCurve3=n.Curve.create(function(e,t,r,i){this.v0=e;this.v1=t;this.v2=r;this.v3=i},function(e){var t=new n.Vector3;t.x=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t.y=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t.z=n.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return t});n.SplineCurve3=n.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-1)*e;var i=Math.floor(r);var a=r-i;var o=t[i==0?i:i-1];var s=t[i];var h=t[i>t.length-2?t.length-1:i+1];var l=t[i>t.length-3?t.length-1:i+2];var u=new n.Vector3;u.x=n.Curve.Utils.interpolate(o.x,s.x,h.x,l.x,a);u.y=n.Curve.Utils.interpolate(o.y,s.y,h.y,l.y,a);u.z=n.Curve.Utils.interpolate(o.z,s.z,h.z,l.z,a);return u});n.ClosedSplineCurve3=n.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-0)*e;var i=Math.floor(r);var a=r-i;i+=i>0?0:(Math.floor(Math.abs(i)/t.length)+1)*t.length;var o=t[(i-1)%t.length];var s=t[i%t.length];var h=t[(i+1)%t.length];var l=t[(i+2)%t.length];var u=new n.Vector3;u.x=n.Curve.Utils.interpolate(o.x,s.x,h.x,l.x,a);u.y=n.Curve.Utils.interpolate(o.y,s.y,h.y,l.y,a);u.z=n.Curve.Utils.interpolate(o.z,s.z,h.z,l.z,a);return u});n.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){n.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){n.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){n.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===true)return e;for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++){if(e.hierarchy[t].keys[r].time<0){e.hierarchy[t].keys[r].time=0}if(e.hierarchy[t].keys[r].rot!==undefined&&!(e.hierarchy[t].keys[r].rot instanceof n.Quaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new n.Quaternion).fromArray(i)}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var a={};for(var r=0;r<e.hierarchy[t].keys.length;r++){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){var s=e.hierarchy[t].keys[r].morphTargets[o];a[s]=-1}}e.hierarchy[t].usedMorphTargets=a;for(var r=0;r<e.hierarchy[t].keys.length;r++){var h={};for(var s in a){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){if(e.hierarchy[t].keys[r].morphTargets[o]===s){h[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[o];break}}if(o===e.hierarchy[t].keys[r].morphTargets.length){h[s]=0}}e.hierarchy[t].keys[r].morphTargetsInfluences=h}}for(var r=1;r<e.hierarchy[t].keys.length;r++){if(e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time){e.hierarchy[t].keys.splice(r,1);r--}}for(var r=0;r<e.hierarchy[t].keys.length;r++){e.hierarchy[t].keys[r].index=r}}e.initialized=true;return e},parse:function(e){var t=function(e,r){r.push(e);for(var i=0;i<e.children.length;i++)t(e.children[i],r)};var r=[];if(e instanceof n.SkinnedMesh){for(var i=0;i<e.skeleton.bones.length;i++){r.push(e.skeleton.bones[i])}}else{t(e,r)}return r},play:function(e){if(this.animations.indexOf(e)===-1){this.animations.push(e)}},stop:function(e){var t=this.animations.indexOf(e);if(t!==-1){this.animations.splice(t,1)}},update:function(e){for(var t=0;t<this.animations.length;t++){this.animations[t].resetBlendWeights()}for(var t=0;t<this.animations.length;t++){this.animations[t].update(e)}}};n.Animation=function(e,t){this.root=e;this.data=n.AnimationHandler.init(t);this.hierarchy=n.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=n.AnimationHandler.LINEAR};n.Animation.prototype={constructor:n.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=e!==undefined?e:0;this.weight=t!==undefined?t:1;this.isPlaying=true;this.reset();n.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;n.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];if(r.animationCache===undefined){r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}var i=this.data.name;var n=r.animationCache.animations;var a=n[i];if(a===undefined){a={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:r.matrix};n[i]=a}for(var o=0;o<3;o++){var s=this.keyTypes[o];var h=this.data.hierarchy[e].keys[0];var l=this.getNextKeyWith(s,e,1);while(l.time<this.currentTime&&l.index>h.index){h=l;l=this.getNextKeyWith(s,e,l.index+1)}a.prevKey[s]=h;a.nextKey[s]=l}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];var i=r.animationCache;if(i!==undefined){var n=i.blending;n.positionWeight=0;n.quaternionWeight=0;n.scaleWeight=0}}},update:function(){var e=[];var t=new n.Vector3;var r=new n.Vector3;var i=new n.Quaternion;var a=function(e,t){var r=[],i=[],n,a,s,h,l,u,c,f,d;n=(e.length-1)*t;a=Math.floor(n);s=n-a;r[0]=a===0?a:a-1;r[1]=a;r[2]=a>e.length-2?a:a+1;r[3]=a>e.length-3?a:a+2;u=e[r[0]];c=e[r[1]];f=e[r[2]];d=e[r[3]];h=s*s;l=s*h;i[0]=o(u[0],c[0],f[0],d[0],s,h,l);i[1]=o(u[1],c[1],f[1],d[1],s,h,l);i[2]=o(u[2],c[2],f[2],d[2],s,h,l);return i};var o=function(e,t,r,i,n,a,o){var s=(r-e)*.5,h=(i-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t};return function(o){if(this.isPlaying===false)return;this.currentTime+=o*this.timeScale;if(this.weight===0)return;var s=this.data.length;if(this.currentTime>s||this.currentTime<0){if(this.loop){this.currentTime%=s;if(this.currentTime<0)this.currentTime+=s;this.reset()}else{this.stop()}}for(var h=0,l=this.hierarchy.length;h<l;h++){var u=this.hierarchy[h];var c=u.animationCache.animations[this.data.name];var f=u.animationCache.blending;for(var d=0;d<3;d++){var p=this.keyTypes[d];var m=c.prevKey[p];var v=c.nextKey[p];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){m=this.data.hierarchy[h].keys[0];v=this.getNextKeyWith(p,h,1);while(v.time<this.currentTime&&v.index>m.index){m=v;v=this.getNextKeyWith(p,h,v.index+1)}c.prevKey[p]=m;c.nextKey[p]=v}var g=(this.currentTime-m.time)/(v.time-m.time);var y=m[p];var x=v[p];if(g<0)g=0;if(g>1)g=1;if(p==="pos"){if(this.interpolationType===n.AnimationHandler.LINEAR){r.x=y[0]+(x[0]-y[0])*g;r.y=y[1]+(x[1]-y[1])*g;r.z=y[2]+(x[2]-y[2])*g;var _=this.weight/(this.weight+f.positionWeight);u.position.lerp(r,_);f.positionWeight+=this.weight}else if(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",h,m.index-1)["pos"];e[1]=y;e[2]=x;e[3]=this.getNextKeyWith("pos",h,v.index+1)["pos"];g=g*.33+.33;var b=a(e,g);var _=this.weight/(this.weight+f.positionWeight);f.positionWeight+=this.weight;var w=u.position;w.x=w.x+(b[0]-w.x)*_;w.y=w.y+(b[1]-w.y)*_;w.z=w.z+(b[2]-w.z)*_;if(this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){var M=a(e,g*1.01);t.set(M[0],M[1],M[2]);t.sub(w);t.y=0;t.normalize();var S=Math.atan2(t.x,t.z);u.rotation.set(0,S,0)}}}else if(p==="rot"){n.Quaternion.slerp(y,x,i,g);if(f.quaternionWeight===0){u.quaternion.copy(i);f.quaternionWeight=this.weight}else{var _=this.weight/(this.weight+f.quaternionWeight);n.Quaternion.slerp(u.quaternion,i,u.quaternion,_);f.quaternionWeight+=this.weight}}else if(p==="scl"){r.x=y[0]+(x[0]-y[0])*g;r.y=y[1]+(x[1]-y[1])*g;r.z=y[2]+(x[2]-y[2])*g;var _=this.weight/(this.weight+f.scaleWeight);u.scale.lerp(r,_);f.scaleWeight+=this.weight}}}return true}}(),getNextKeyWith:function(e,t,r){var i=this.data.hierarchy[t].keys;if(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){r=r<i.length-1?r:i.length-1}else{r=r%i.length}for(;r<i.length;r++){if(i[r][e]!==undefined){return i[r]}}return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,r){var i=this.data.hierarchy[t].keys;if(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){r=r>0?r:0}else{r=r>=0?r:r+i.length}for(;r>=0;r--){if(i[r][e]!==undefined){return i[r]}}return this.data.hierarchy[t].keys[i.length-1]}};n.KeyFrameAnimation=function(e){this.root=e.node;this.data=n.AnimationHandler.init(e);this.hierarchy=n.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var t=0,r=this.hierarchy.length;t<r;t++){var i=this.data.hierarchy[t].keys,a=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(i.length&&a){for(var s=0;s<a.length;s++){var h=a[s],l=this.getNextKeyWith(h,t,0);if(l){l.apply(h)}}o.matrixAutoUpdate=false;this.data.hierarchy[t].node.updateMatrix();o.matrixWorldNeedsUpdate=true}}};n.KeyFrameAnimation.prototype={constructor:n.KeyFrameAnimation,play:function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;var t,r=this.hierarchy.length,i,a;for(t=0;t<r;t++){i=this.hierarchy[t];a=this.data.hierarchy[t];if(a.animationCache===undefined){a.animationCache={};a.animationCache.prevKey=null;a.animationCache.nextKey=null;a.animationCache.originalMatrix=i.matrix}var o=this.data.hierarchy[t].keys;if(o.length){a.animationCache.prevKey=o[0];a.animationCache.nextKey=o[1];this.startTime=Math.min(o[0].time,this.startTime);this.endTime=Math.max(o[o.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;n.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;this.isPaused=false;n.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var r=this.data.hierarchy[e];if(r.animationCache!==undefined){var i=r.animationCache.originalMatrix;i.copy(t.matrix);t.matrix=i;delete r.animationCache}}},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e*this.timeScale;var t=this.data.length;if(this.loop===true&&this.currentTime>t){this.currentTime%=t}this.currentTime=Math.min(this.currentTime,t);for(var r=0,i=this.hierarchy.length;r<i;r++){var n=this.hierarchy[r];var a=this.data.hierarchy[r];var o=a.keys,s=a.animationCache;if(o.length){var h=s.prevKey;var l=s.nextKey;if(l.time<=this.currentTime){while(l.time<this.currentTime&&l.index>h.index){h=l;l=o[h.index+1]}s.prevKey=h;s.nextKey=l}if(l.time>=this.currentTime){h.interpolate(l,this.currentTime)}else{h.interpolate(l,l.time)}this.data.hierarchy[r].node.updateMatrix();n.matrixWorldNeedsUpdate=true}}},getNextKeyWith:function(e,t,r){var i=this.data.hierarchy[t].keys;r=r%i.length;for(;r<i.length;r++){if(i[r].hasTarget(e)){return i[r]}}return i[0]},getPrevKeyWith:function(e,t,r){var i=this.data.hierarchy[t].keys;r=r>=0?r:r+i.length;for(;r>=0;r--){if(i[r].hasTarget(e)){return i[r]}}return i[i.length-1]}};n.MorphAnimation=function(e){this.mesh=e;this.frames=e.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};n.MorphAnimation.prototype={constructor:n.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames;var r=Math.floor(this.currentTime/t);var i=this.mesh.morphTargetInfluences;if(r!=this.currentFrame){i[this.lastFrame]=0;i[this.currentFrame]=1;i[r]=0;this.lastFrame=this.currentFrame;this.currentFrame=r}i[r]=this.currentTime%t/t;i[this.lastFrame]=1-i[r]}};n.BoxGeometry=function(e,t,r,i,a,o){n.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:a,depthSegments:o};this.widthSegments=i||1;this.heightSegments=a||1;this.depthSegments=o||1;var s=this;var h=e/2;var l=t/2;var u=r/2;c("z","y",-1,-1,r,t,h,0);c("z","y",1,-1,r,t,-h,1);c("x","z",1,1,e,r,l,2);c("x","z",1,-1,e,r,-l,3);c("x","y",1,-1,e,t,u,4);c("x","y",-1,-1,e,t,-u,5);function c(e,t,r,i,a,o,h,l){var u,c,f,d=s.widthSegments,p=s.heightSegments,m=a/2,v=o/2,g=s.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){u="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){u="y";p=s.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){u="x";d=s.depthSegments}var y=d+1,x=p+1,_=a/d,b=o/p,w=new n.Vector3;w[u]=h>0?1:-1;for(f=0;f<x;f++){for(c=0;c<y;c++){var M=new n.Vector3;M[e]=(c*_-m)*r;M[t]=(f*b-v)*i;M[u]=h;s.vertices.push(M)}}for(f=0;f<p;f++){for(c=0;c<d;c++){var S=c+y*f;var C=c+y*(f+1);var T=c+1+y*(f+1);var E=c+1+y*f;var A=new n.Vector2(c/d,1-f/p);var L=new n.Vector2(c/d,1-(f+1)/p);var P=new n.Vector2((c+1)/d,1-(f+1)/p);var R=new n.Vector2((c+1)/d,1-f/p);var F=new n.Face3(S+g,C+g,E+g);F.normal.copy(w);F.vertexNormals.push(w.clone(),w.clone(),w.clone());F.materialIndex=l;s.faces.push(F);s.faceVertexUvs[0].push([A,L,R]);F=new n.Face3(C+g,T+g,E+g);F.normal.copy(w);F.vertexNormals.push(w.clone(),w.clone(),w.clone());F.materialIndex=l;s.faces.push(F);s.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}}this.mergeVertices()};n.BoxGeometry.prototype=Object.create(n.Geometry.prototype);n.BoxGeometry.prototype.constructor=n.BoxGeometry;n.CircleGeometry=function(e,t,r,i){n.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i};e=e||50;t=t!==undefined?Math.max(3,t):8;r=r!==undefined?r:0;i=i!==undefined?i:Math.PI*2;var a,o=[],s=new n.Vector3,h=new n.Vector2(.5,.5);this.vertices.push(s);o.push(h);for(a=0;a<=t;a++){var l=new n.Vector3;var u=r+a/t*i;l.x=e*Math.cos(u);l.y=e*Math.sin(u);this.vertices.push(l);o.push(new n.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var c=new n.Vector3(0,0,1);for(a=1;a<=t;a++){this.faces.push(new n.Face3(a,a+1,0,[c.clone(),c.clone(),c.clone()]));this.faceVertexUvs[0].push([o[a].clone(),o[a+1].clone(),h.clone()])}this.computeFaceNormals();this.boundingSphere=new n.Sphere(new n.Vector3,e)};n.CircleGeometry.prototype=Object.create(n.Geometry.prototype);n.CircleGeometry.prototype.constructor=n.CircleGeometry;n.CubeGeometry=function(e,t,r,i,a,o){n.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new n.BoxGeometry(e,t,r,i,a,o)};n.CylinderGeometry=function(e,t,r,i,a,o,s,h){n.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:h};e=e!==undefined?e:20;t=t!==undefined?t:20;r=r!==undefined?r:100;i=i||8;a=a||1;o=o!==undefined?o:false;s=s!==undefined?s:0;h=h!==undefined?h:2*Math.PI;var l=r/2;var u,c,f=[],d=[];for(c=0;c<=a;c++){var p=[];var m=[];var v=c/a;var g=v*(t-e)+e;for(u=0;u<=i;u++){var y=u/i;var x=new n.Vector3;x.x=g*Math.sin(y*h+s);x.y=-v*r+l;x.z=g*Math.cos(y*h+s);this.vertices.push(x);p.push(this.vertices.length-1);m.push(new n.Vector2(y,1-v))}f.push(p);d.push(m)}var _=(t-e)/r;var b,w;for(u=0;u<i;u++){if(e!==0){b=this.vertices[f[0][u]].clone();w=this.vertices[f[0][u+1]].clone()}else{b=this.vertices[f[1][u]].clone();w=this.vertices[f[1][u+1]].clone()}b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*_).normalize();w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*_).normalize();for(c=0;c<a;c++){var M=f[c][u];var S=f[c+1][u];var C=f[c+1][u+1];var T=f[c][u+1];var E=b.clone();var A=b.clone();var L=w.clone();var P=w.clone();var R=d[c][u].clone();var F=d[c+1][u].clone();var B=d[c+1][u+1].clone();var U=d[c][u+1].clone();this.faces.push(new n.Face3(M,S,T,[E,A,P]));this.faceVertexUvs[0].push([R,F,U]);this.faces.push(new n.Face3(S,C,T,[A.clone(),L,P.clone()]));this.faceVertexUvs[0].push([F.clone(),B,U.clone()])}}if(o===false&&e>0){this.vertices.push(new n.Vector3(0,l,0));for(u=0;u<i;u++){var M=f[0][u];var S=f[0][u+1];var C=this.vertices.length-1;var E=new n.Vector3(0,1,0);var A=new n.Vector3(0,1,0);var L=new n.Vector3(0,1,0);var R=d[0][u].clone();var F=d[0][u+1].clone();var B=new n.Vector2(F.x,0);this.faces.push(new n.Face3(M,S,C,[E,A,L]));this.faceVertexUvs[0].push([R,F,B])}}if(o===false&&t>0){this.vertices.push(new n.Vector3(0,-l,0));for(u=0;u<i;u++){var M=f[a][u+1];var S=f[a][u];var C=this.vertices.length-1;var E=new n.Vector3(0,-1,0);var A=new n.Vector3(0,-1,0);var L=new n.Vector3(0,-1,0);var R=d[a][u+1].clone();var F=d[a][u].clone();var B=new n.Vector2(F.x,1);this.faces.push(new n.Face3(M,S,C,[E,A,L]));this.faceVertexUvs[0].push([R,F,B])}}this.computeFaceNormals()};n.CylinderGeometry.prototype=Object.create(n.Geometry.prototype);n.CylinderGeometry.prototype.constructor=n.CylinderGeometry;n.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}n.Geometry.call(this);this.type="ExtrudeGeometry";e=e instanceof Array?e:[e];this.addShapeList(e,t);this.computeFaceNormals()};n.ExtrudeGeometry.prototype=Object.create(n.Geometry.prototype);n.ExtrudeGeometry.prototype.constructor=n.ExtrudeGeometry;n.ExtrudeGeometry.prototype.addShapeList=function(e,t){var r=e.length;for(var i=0;i<r;i++){var n=e[i];this.addShape(n,t)}};n.ExtrudeGeometry.prototype.addShape=function(e,t){var r=t.amount!==undefined?t.amount:100;var i=t.bevelThickness!==undefined?t.bevelThickness:6;var a=t.bevelSize!==undefined?t.bevelSize:i-2;var o=t.bevelSegments!==undefined?t.bevelSegments:3;var s=t.bevelEnabled!==undefined?t.bevelEnabled:true;var h=t.curveSegments!==undefined?t.curveSegments:12;var l=t.steps!==undefined?t.steps:1;var u=t.extrudePath;var c,f=false;var d=t.material;var p=t.extrudeMaterial;var m=t.UVGenerator!==undefined?t.UVGenerator:n.ExtrudeGeometry.WorldUVGenerator;var v,g,y,x;if(u){c=u.getSpacedPoints(l);f=true;s=false;v=t.frames!==undefined?t.frames:new n.TubeGeometry.FrenetFrames(u,l,false);g=new n.Vector3;y=new n.Vector3;x=new n.Vector3}if(!s){o=0;i=0;a=0}var _,b,w;var M=this;var S=this.vertices.length;var C=e.extractPoints(h);var T=C.shape;var E=C.holes;var A=!n.Shape.Utils.isClockWise(T);if(A){T=T.reverse();for(b=0,w=E.length;b<w;b++){_=E[b];if(n.Shape.Utils.isClockWise(_)){E[b]=_.reverse()}}A=false}var L=n.Shape.Utils.triangulateShape(T,E);var P=T;for(b=0,w=E.length;b<w;b++){_=E[b];T=T.concat(_)}function R(e,t,r){if(!t)n.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(r).add(e)}var F,B,U,D,k,V=T.length,N,O=L.length;function z(e,t,r){var i=1e-10;var a,o,s=1;var h=e.x-t.x,l=e.y-t.y;var u=r.x-e.x,c=r.y-e.y;var f=h*h+l*l;var d=h*c-l*u;if(Math.abs(d)>i){var p=Math.sqrt(f);var m=Math.sqrt(u*u+c*c);var v=t.x-l/p;var g=t.y+h/p;var y=r.x-c/m;var x=r.y+u/m;var _=((y-v)*c-(x-g)*u)/(h*c-l*u);a=v+h*_-e.x;o=g+l*_-e.y;var b=a*a+o*o;if(b<=2){return new n.Vector2(a,o)}else{s=Math.sqrt(b/2)}}else{var w=false;if(h>i){if(u>i){w=true}}else{if(h<-i){if(u<-i){w=true}}else{if(Math.sign(l)==Math.sign(c)){w=true}}}if(w){a=-l;o=h;s=Math.sqrt(f)}else{a=h;o=l;s=Math.sqrt(f/2)}}return new n.Vector2(a/s,o/s)}var I=[];for(var G=0,H=P.length,W=H-1,j=G+1;G<H;G++,W++,j++){if(W===H)W=0;if(j===H)j=0;I[G]=z(P[G],P[W],P[j])}var X=[],q,Y=I.concat();for(b=0,w=E.length;b<w;b++){_=E[b];q=[];for(G=0,H=_.length,W=H-1,j=G+1;G<H;G++,W++,j++){if(W===H)W=0;if(j===H)j=0;q[G]=z(_[G],_[W],_[j])}X.push(q);Y=Y.concat(q)}for(F=0;F<o;F++){U=F/o;D=i*(1-U);B=a*Math.sin(U*Math.PI/2);for(G=0,H=P.length;G<H;G++){k=R(P[G],I[G],B);$(k.x,k.y,-D)}for(b=0,w=E.length;b<w;b++){_=E[b];q=X[b];for(G=0,H=_.length;G<H;G++){k=R(_[G],q[G],B);$(k.x,k.y,-D)}}}B=a;for(G=0;G<V;G++){k=s?R(T[G],Y[G],B):T[G];if(!f){$(k.x,k.y,0)}else{y.copy(v.normals[0]).multiplyScalar(k.x);g.copy(v.binormals[0]).multiplyScalar(k.y);x.copy(c[0]).add(y).add(g);$(x.x,x.y,x.z)}}var K;for(K=1;K<=l;K++){for(G=0;G<V;G++){k=s?R(T[G],Y[G],B):T[G];if(!f){$(k.x,k.y,r/l*K)}else{y.copy(v.normals[K]).multiplyScalar(k.x);g.copy(v.binormals[K]).multiplyScalar(k.y);x.copy(c[K]).add(y).add(g);$(x.x,x.y,x.z)}}}for(F=o-1;F>=0;F--){U=F/o;D=i*(1-U);B=a*Math.sin(U*Math.PI/2);for(G=0,H=P.length;G<H;G++){k=R(P[G],I[G],B);$(k.x,k.y,r+D)}for(b=0,w=E.length;b<w;b++){_=E[b];q=X[b];for(G=0,H=_.length;G<H;G++){k=R(_[G],q[G],B);if(!f){$(k.x,k.y,r+D)}else{$(k.x,k.y+c[l-1].y,c[l-1].x+D)}}}}Q();Z();function Q(){if(s){var e=0;var t=V*e;for(G=0;G<O;G++){N=L[G];ee(N[2]+t,N[1]+t,N[0]+t)}e=l+o*2;t=V*e;for(G=0;G<O;G++){N=L[G];ee(N[0]+t,N[1]+t,N[2]+t)}}else{for(G=0;G<O;G++){N=L[G];ee(N[2],N[1],N[0])}for(G=0;G<O;G++){N=L[G];ee(N[0]+V*l,N[1]+V*l,N[2]+V*l)}}}function Z(){var e=0;J(P,e);e+=P.length;for(b=0,w=E.length;b<w;b++){_=E[b];J(_,e);e+=_.length}}function J(e,t){var r,i;G=e.length;while(--G>=0){r=G;i=G-1;if(i<0)i=e.length-1;var n=0,a=l+o*2;for(n=0;n<a;n++){var s=V*n;var h=V*(n+1);var u=t+r+s,c=t+i+s,f=t+i+h,d=t+r+h;te(u,c,f,d,e,n,a,r,i)}}}function $(e,t,r){M.vertices.push(new n.Vector3(e,t,r))}function ee(e,t,r){e+=S;t+=S;r+=S;M.faces.push(new n.Face3(e,t,r,null,null,d));var i=m.generateTopUV(M,e,t,r);M.faceVertexUvs[0].push(i)}function te(e,t,r,i,a,o,s,h,l){e+=S;t+=S;r+=S;i+=S;M.faces.push(new n.Face3(e,t,i,null,null,p));M.faces.push(new n.Face3(t,r,i,null,null,p));var u=m.generateSideWallUV(M,e,t,r,i);M.faceVertexUvs[0].push([u[0],u[1],u[3]]);M.faceVertexUvs[0].push([u[1],u[2],u[3]])}};n.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i){var a=e.vertices;var o=a[t];var s=a[r];var h=a[i];return[new n.Vector2(o.x,o.y),new n.Vector2(s.x,s.y),new n.Vector2(h.x,h.y)]},generateSideWallUV:function(e,t,r,i,a){var o=e.vertices;var s=o[t];var h=o[r];var l=o[i];var u=o[a];if(Math.abs(s.y-h.y)<.01){return[new n.Vector2(s.x,1-s.z),new n.Vector2(h.x,1-h.z),new n.Vector2(l.x,1-l.z),new n.Vector2(u.x,1-u.z)]}else{return[new n.Vector2(s.y,1-s.z),new n.Vector2(h.y,1-h.z),new n.Vector2(l.y,1-l.z),new n.Vector2(u.y,1-u.z)]}}};n.ShapeGeometry=function(e,t){n.Geometry.call(this);this.type="ShapeGeometry";if(e instanceof Array===false)e=[e];this.addShapeList(e,t);this.computeFaceNormals()};n.ShapeGeometry.prototype=Object.create(n.Geometry.prototype);n.ShapeGeometry.prototype.constructor=n.ShapeGeometry;n.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++){this.addShape(e[r],t)}return this};n.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var r=t.curveSegments!==undefined?t.curveSegments:12;var i=t.material;var a=t.UVGenerator===undefined?n.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var o,s,h;var l=this.vertices.length;var u=e.extractPoints(r);var c=u.shape;var f=u.holes;var d=!n.Shape.Utils.isClockWise(c);if(d){c=c.reverse();for(o=0,s=f.length;o<s;o++){h=f[o];if(n.Shape.Utils.isClockWise(h)){f[o]=h.reverse()}}d=false}var p=n.Shape.Utils.triangulateShape(c,f);var m=c;for(o=0,s=f.length;o<s;o++){h=f[o];c=c.concat(h)}var v,g=c.length;var y,x=p.length;for(o=0;o<g;o++){v=c[o];this.vertices.push(new n.Vector3(v.x,v.y,0))}for(o=0;o<x;o++){y=p[o];var _=y[0]+l;var b=y[1]+l;var w=y[2]+l;this.faces.push(new n.Face3(_,b,w,null,null,i));this.faceVertexUvs[0].push(a.generateTopUV(this,_,b,w))}};n.LatheGeometry=function(e,t,r,i){n.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:r,phiLength:i};t=t||12;r=r||0;i=i||2*Math.PI;var a=1/(e.length-1);var o=1/t;for(var s=0,h=t;s<=h;s++){var l=r+s*o*i;var u=Math.cos(l),c=Math.sin(l);for(var f=0,d=e.length;f<d;f++){var p=e[f];var m=new n.Vector3;m.x=u*p.x-c*p.y;m.y=c*p.x+u*p.y;m.z=p.z;this.vertices.push(m)}}var v=e.length;for(var s=0,h=t;s<h;s++){for(var f=0,d=e.length-1;f<d;f++){var g=f+v*s;var y=g;var x=g+v;var u=g+1+v;var _=g+1;var b=s*o;var w=f*a;var M=b+o;var S=w+a;this.faces.push(new n.Face3(y,x,_));this.faceVertexUvs[0].push([new n.Vector2(b,w),new n.Vector2(M,w),new n.Vector2(b,S)]);this.faces.push(new n.Face3(x,u,_));this.faceVertexUvs[0].push([new n.Vector2(M,w),new n.Vector2(M,S),new n.Vector2(b,S)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};n.LatheGeometry.prototype=Object.create(n.Geometry.prototype);n.LatheGeometry.prototype.constructor=n.LatheGeometry;n.PlaneGeometry=function(e,t,r,i){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");n.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};this.fromBufferGeometry(new n.PlaneBufferGeometry(e,t,r,i))};n.PlaneGeometry.prototype=Object.create(n.Geometry.prototype);n.PlaneGeometry.prototype.constructor=n.PlaneGeometry;n.PlaneBufferGeometry=function(e,t,r,i){n.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var a=e/2;var o=t/2;var s=r||1;var h=i||1;var l=s+1;var u=h+1;var c=e/s;var f=t/h;var d=new Float32Array(l*u*3);var p=new Float32Array(l*u*3);var m=new Float32Array(l*u*2);var v=0;var g=0;for(var y=0;y<u;y++){var x=y*f-o;for(var _=0;_<l;_++){var b=_*c-a;d[v]=b;d[v+1]=-x;p[v+2]=1;m[g]=_/s;m[g+1]=1-y/h;v+=3;g+=2}}v=0;var w=new(d.length/3>65535?Uint32Array:Uint16Array)(s*h*6);for(var y=0;y<h;y++){for(var _=0;_<s;_++){var M=_+l*y;var S=_+l*(y+1);var C=_+1+l*(y+1);var T=_+1+l*y;w[v]=M;w[v+1]=S;w[v+2]=T;w[v+3]=S;w[v+4]=C;w[v+5]=T;v+=6}}this.addAttribute("index",new n.BufferAttribute(w,1));this.addAttribute("position",new n.BufferAttribute(d,3));this.addAttribute("normal",new n.BufferAttribute(p,3));this.addAttribute("uv",new n.BufferAttribute(m,2))};n.PlaneBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype);n.PlaneBufferGeometry.prototype.constructor=n.PlaneBufferGeometry;n.RingGeometry=function(e,t,r,i,a,o){n.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:a,thetaLength:o};e=e||0;t=t||50;a=a!==undefined?a:0;o=o!==undefined?o:Math.PI*2;r=r!==undefined?Math.max(3,r):8;i=i!==undefined?Math.max(1,i):8;var s,h,l=[],u=e,c=(t-e)/i;for(s=0;s<i+1;s++){for(h=0;h<r+1;h++){var f=new n.Vector3;var d=a+h/r*o;f.x=u*Math.cos(d);f.y=u*Math.sin(d);this.vertices.push(f);l.push(new n.Vector2((f.x/t+1)/2,(f.y/t+1)/2))}u+=c}var p=new n.Vector3(0,0,1);for(s=0;s<i;s++){
var m=s*(r+1);for(h=0;h<r;h++){var d=h+m;var v=d;var g=d+r+1;var y=d+r+2;this.faces.push(new n.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()]);v=d;g=d+r+2;y=d+1;this.faces.push(new n.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()])}}this.computeFaceNormals();this.boundingSphere=new n.Sphere(new n.Vector3,u)};n.RingGeometry.prototype=Object.create(n.Geometry.prototype);n.RingGeometry.prototype.constructor=n.RingGeometry;n.SphereGeometry=function(e,t,r,i,a,o,s){n.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:a,thetaStart:o,thetaLength:s};e=e||50;t=Math.max(3,Math.floor(t)||8);r=Math.max(2,Math.floor(r)||6);i=i!==undefined?i:0;a=a!==undefined?a:Math.PI*2;o=o!==undefined?o:0;s=s!==undefined?s:Math.PI;var h,l,u=[],c=[];for(l=0;l<=r;l++){var f=[];var d=[];for(h=0;h<=t;h++){var p=h/t;var m=l/r;var v=new n.Vector3;v.x=-e*Math.cos(i+p*a)*Math.sin(o+m*s);v.y=e*Math.cos(o+m*s);v.z=e*Math.sin(i+p*a)*Math.sin(o+m*s);this.vertices.push(v);f.push(this.vertices.length-1);d.push(new n.Vector2(p,1-m))}u.push(f);c.push(d)}for(l=0;l<r;l++){for(h=0;h<t;h++){var g=u[l][h+1];var y=u[l][h];var x=u[l+1][h];var _=u[l+1][h+1];var b=this.vertices[g].clone().normalize();var w=this.vertices[y].clone().normalize();var M=this.vertices[x].clone().normalize();var S=this.vertices[_].clone().normalize();var C=c[l][h+1].clone();var T=c[l][h].clone();var E=c[l+1][h].clone();var A=c[l+1][h+1].clone();if(Math.abs(this.vertices[g].y)===e){C.x=(C.x+T.x)/2;this.faces.push(new n.Face3(g,x,_,[b,M,S]));this.faceVertexUvs[0].push([C,E,A])}else if(Math.abs(this.vertices[x].y)===e){E.x=(E.x+A.x)/2;this.faces.push(new n.Face3(g,y,x,[b,w,M]));this.faceVertexUvs[0].push([C,T,E])}else{this.faces.push(new n.Face3(g,y,_,[b,w,S]));this.faceVertexUvs[0].push([C,T,A]);this.faces.push(new n.Face3(y,x,_,[w.clone(),M,S.clone()]));this.faceVertexUvs[0].push([T.clone(),E,A.clone()])}}}this.computeFaceNormals();this.boundingSphere=new n.Sphere(new n.Vector3,e)};n.SphereGeometry.prototype=Object.create(n.Geometry.prototype);n.SphereGeometry.prototype.constructor=n.SphereGeometry;n.TextGeometry=function(e,t){t=t||{};var r=n.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;n.ExtrudeGeometry.call(this,r,t);this.type="TextGeometry"};n.TextGeometry.prototype=Object.create(n.ExtrudeGeometry.prototype);n.TextGeometry.prototype.constructor=n.TextGeometry;n.TorusGeometry=function(e,t,r,i,a){n.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:a};e=e||100;t=t||40;r=r||8;i=i||6;a=a||Math.PI*2;var o=new n.Vector3,s=[],h=[];for(var l=0;l<=r;l++){for(var u=0;u<=i;u++){var c=u/i*a;var f=l/r*Math.PI*2;o.x=e*Math.cos(c);o.y=e*Math.sin(c);var d=new n.Vector3;d.x=(e+t*Math.cos(f))*Math.cos(c);d.y=(e+t*Math.cos(f))*Math.sin(c);d.z=t*Math.sin(f);this.vertices.push(d);s.push(new n.Vector2(u/i,l/r));h.push(d.clone().sub(o).normalize())}}for(var l=1;l<=r;l++){for(var u=1;u<=i;u++){var p=(i+1)*l+u-1;var m=(i+1)*(l-1)+u-1;var v=(i+1)*(l-1)+u;var g=(i+1)*l+u;var y=new n.Face3(p,m,g,[h[p].clone(),h[m].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[g].clone()]);y=new n.Face3(m,v,g,[h[m].clone(),h[v].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[m].clone(),s[v].clone(),s[g].clone()])}}this.computeFaceNormals()};n.TorusGeometry.prototype=Object.create(n.Geometry.prototype);n.TorusGeometry.prototype.constructor=n.TorusGeometry;n.TorusKnotGeometry=function(e,t,r,i,a,o,s){n.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,p:a,q:o,heightScale:s};e=e||100;t=t||40;r=r||64;i=i||8;a=a||2;o=o||3;s=s||1;var h=new Array(r);var l=new n.Vector3;var u=new n.Vector3;var c=new n.Vector3;for(var f=0;f<r;++f){h[f]=new Array(i);var d=f/r*2*a*Math.PI;var p=R(d,o,a,e,s);var m=R(d+.01,o,a,e,s);l.subVectors(m,p);u.addVectors(m,p);c.crossVectors(l,u);u.crossVectors(c,l);c.normalize();u.normalize();for(var v=0;v<i;++v){var g=v/i*2*Math.PI;var y=-t*Math.cos(g);var x=t*Math.sin(g);var _=new n.Vector3;_.x=p.x+y*u.x+x*c.x;_.y=p.y+y*u.y+x*c.y;_.z=p.z+y*u.z+x*c.z;h[f][v]=this.vertices.push(_)-1}}for(var f=0;f<r;++f){for(var v=0;v<i;++v){var b=(f+1)%r;var w=(v+1)%i;var M=h[f][v];var S=h[b][v];var C=h[b][w];var T=h[f][w];var E=new n.Vector2(f/r,v/i);var A=new n.Vector2((f+1)/r,v/i);var L=new n.Vector2((f+1)/r,(v+1)/i);var P=new n.Vector2(f/r,(v+1)/i);this.faces.push(new n.Face3(M,S,T));this.faceVertexUvs[0].push([E,A,P]);this.faces.push(new n.Face3(S,C,T));this.faceVertexUvs[0].push([A.clone(),L,P.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function R(e,t,r,i,a){var o=Math.cos(e);var s=Math.sin(e);var h=t/r*e;var l=Math.cos(h);var u=i*(2+l)*.5*o;var c=i*(2+l)*s*.5;var f=a*i*Math.sin(h)*.5;return new n.Vector3(u,c,f)}};n.TorusKnotGeometry.prototype=Object.create(n.Geometry.prototype);n.TorusKnotGeometry.prototype.constructor=n.TorusKnotGeometry;n.TubeGeometry=function(e,t,r,i,a,o){n.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:t,radius:r,radialSegments:i,closed:a};t=t||64;r=r||1;i=i||8;a=a||false;o=o||n.TubeGeometry.NoTaper;var s=[];var h=this,l,u,c,f=t+1,d,p,m,v,g,y,x=new n.Vector3,_,b,w,M,S,C,T,E,A,L,P,R;var F=new n.TubeGeometry.FrenetFrames(e,t,a),B=F.tangents,U=F.normals,D=F.binormals;this.tangents=B;this.normals=U;this.binormals=D;function k(e,t,r){return h.vertices.push(new n.Vector3(e,t,r))-1}for(_=0;_<f;_++){s[_]=[];d=_/(f-1);y=e.getPointAt(d);l=B[_];u=U[_];c=D[_];m=r*o(d);for(b=0;b<i;b++){p=b/i*2*Math.PI;v=-m*Math.cos(p);g=m*Math.sin(p);x.copy(y);x.x+=v*u.x+g*c.x;x.y+=v*u.y+g*c.y;x.z+=v*u.z+g*c.z;s[_][b]=k(x.x,x.y,x.z)}}for(_=0;_<t;_++){for(b=0;b<i;b++){w=a?(_+1)%t:_+1;M=(b+1)%i;S=s[_][b];C=s[w][b];T=s[w][M];E=s[_][M];A=new n.Vector2(_/t,b/i);L=new n.Vector2((_+1)/t,b/i);P=new n.Vector2((_+1)/t,(b+1)/i);R=new n.Vector2(_/t,(b+1)/i);this.faces.push(new n.Face3(S,C,E));this.faceVertexUvs[0].push([A,L,R]);this.faces.push(new n.Face3(C,T,E));this.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};n.TubeGeometry.prototype=Object.create(n.Geometry.prototype);n.TubeGeometry.prototype.constructor=n.TubeGeometry;n.TubeGeometry.NoTaper=function(e){return 1};n.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)};n.TubeGeometry.FrenetFrames=function(e,t,r){var i=new n.Vector3,a=[],o=[],s=[],h=new n.Vector3,l=new n.Matrix4,u=t+1,c,f=1e-4,d,p,m,v,g,y;this.tangents=a;this.normals=o;this.binormals=s;for(g=0;g<u;g++){y=g/(u-1);a[g]=e.getTangentAt(y);a[g].normalize()}x();function x(){o[0]=new n.Vector3;s[0]=new n.Vector3;d=Number.MAX_VALUE;p=Math.abs(a[0].x);m=Math.abs(a[0].y);v=Math.abs(a[0].z);if(p<=d){d=p;i.set(1,0,0)}if(m<=d){d=m;i.set(0,1,0)}if(v<=d){i.set(0,0,1)}h.crossVectors(a[0],i).normalize();o[0].crossVectors(a[0],h);s[0].crossVectors(a[0],o[0])}for(g=1;g<u;g++){o[g]=o[g-1].clone();s[g]=s[g-1].clone();h.crossVectors(a[g-1],a[g]);if(h.length()>f){h.normalize();c=Math.acos(n.Math.clamp(a[g-1].dot(a[g]),-1,1));o[g].applyMatrix4(l.makeRotationAxis(h,c))}s[g].crossVectors(a[g],o[g])}if(r){c=Math.acos(n.Math.clamp(o[0].dot(o[u-1]),-1,1));c/=u-1;if(a[0].dot(h.crossVectors(o[0],o[u-1]))>0){c=-c}for(g=1;g<u;g++){o[g].applyMatrix4(l.makeRotationAxis(a[g],c*g));s[g].crossVectors(a[g],o[g])}}};n.PolyhedronGeometry=function(e,t,r,i){n.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:r,detail:i};r=r||1;i=i||0;var a=this;for(var o=0,s=e.length;o<s;o+=3){b(new n.Vector3(e[o],e[o+1],e[o+2]))}var h=this.vertices;var l=[];for(var o=0,u=0,s=t.length;o<s;o+=3,u++){var c=h[t[o]];var f=h[t[o+1]];var d=h[t[o+2]];l[u]=new n.Face3(c.index,f.index,d.index,[c.clone(),f.clone(),d.clone()])}var p=new n.Vector3;for(var o=0,s=l.length;o<s;o++){M(l[o],i)}for(var o=0,s=this.faceVertexUvs[0].length;o<s;o++){var m=this.faceVertexUvs[0][o];var v=m[0].x;var g=m[1].x;var y=m[2].x;var x=Math.max(v,Math.max(g,y));var _=Math.min(v,Math.min(g,y));if(x>.9&&_<.1){if(v<.2)m[0].x+=1;if(g<.2)m[1].x+=1;if(y<.2)m[2].x+=1}}for(var o=0,s=this.vertices.length;o<s;o++){this.vertices[o].multiplyScalar(r)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new n.Sphere(new n.Vector3,r);function b(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var r=S(e)/2/Math.PI+.5;var i=C(e)/Math.PI+.5;t.uv=new n.Vector2(r,1-i);return t}function w(e,t,r){var i=new n.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);a.faces.push(i);p.copy(e).add(t).add(r).divideScalar(3);var o=S(p);a.faceVertexUvs[0].push([T(e.uv,e,o),T(t.uv,t,o),T(r.uv,r,o)])}function M(e,t){var r=Math.pow(2,t);var i=b(a.vertices[e.a]);var n=b(a.vertices[e.b]);var o=b(a.vertices[e.c]);var s=[];for(var h=0;h<=r;h++){s[h]=[];var l=b(i.clone().lerp(o,h/r));var u=b(n.clone().lerp(o,h/r));var c=r-h;for(var f=0;f<=c;f++){if(f==0&&h==r){s[h][f]=l}else{s[h][f]=b(l.clone().lerp(u,f/c))}}}for(var h=0;h<r;h++){for(var f=0;f<2*(r-h)-1;f++){var d=Math.floor(f/2);if(f%2==0){w(s[h][d+1],s[h+1][d],s[h][d])}else{w(s[h][d+1],s[h+1][d+1],s[h+1][d])}}}}function S(e){return Math.atan2(e.z,-e.x)}function C(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function T(e,t,r){if(r<0&&e.x===1)e=new n.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new n.Vector2(r/2/Math.PI+.5,e.y);return e.clone()}};n.PolyhedronGeometry.prototype=Object.create(n.Geometry.prototype);n.PolyhedronGeometry.prototype.constructor=n.PolyhedronGeometry;n.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=(1+Math.sqrt(5))/2;var i=1/r;var a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i];var o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];n.PolyhedronGeometry.call(this,a,o,e,t)};n.DodecahedronGeometry.prototype=Object.create(n.Geometry.prototype);n.DodecahedronGeometry.prototype.constructor=n.DodecahedronGeometry;n.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;var i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];var a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];n.PolyhedronGeometry.call(this,i,a,e,t);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t}};n.IcosahedronGeometry.prototype=Object.create(n.Geometry.prototype);n.IcosahedronGeometry.prototype.constructor=n.IcosahedronGeometry;n.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];n.PolyhedronGeometry.call(this,r,i,e,t);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t}};n.OctahedronGeometry.prototype=Object.create(n.Geometry.prototype);n.OctahedronGeometry.prototype.constructor=n.OctahedronGeometry;n.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var i=[2,1,0,0,3,2,1,3,0,2,3,1];n.PolyhedronGeometry.call(this,r,i,e,t);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t}};n.TetrahedronGeometry.prototype=Object.create(n.Geometry.prototype);n.TetrahedronGeometry.prototype.constructor=n.TetrahedronGeometry;n.ParametricGeometry=function(e,t,r){n.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:r};var i=this.vertices;var a=this.faces;var o=this.faceVertexUvs[0];var s,h,l;var u,c;var f=t+1;for(s=0;s<=r;s++){c=s/r;for(h=0;h<=t;h++){u=h/t;l=e(u,c);i.push(l)}}var d,p,m,v;var g,y,x,_;for(s=0;s<r;s++){for(h=0;h<t;h++){d=s*f+h;p=s*f+h+1;m=(s+1)*f+h+1;v=(s+1)*f+h;g=new n.Vector2(h/t,s/r);y=new n.Vector2((h+1)/t,s/r);x=new n.Vector2((h+1)/t,(s+1)/r);_=new n.Vector2(h/t,(s+1)/r);a.push(new n.Face3(d,p,v));o.push([g,y,_]);a.push(new n.Face3(p,m,v));o.push([y.clone(),x,_.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};n.ParametricGeometry.prototype=Object.create(n.Geometry.prototype);n.ParametricGeometry.prototype.constructor=n.ParametricGeometry;n.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]);var r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var i=new n.BufferGeometry;i.addAttribute("position",new n.BufferAttribute(t,3));i.addAttribute("color",new n.BufferAttribute(r,3));var a=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.Line.call(this,i,a,n.LinePieces)};n.AxisHelper.prototype=Object.create(n.Line.prototype);n.AxisHelper.prototype.constructor=n.AxisHelper;n.ArrowHelper=function(){var e=new n.Geometry;e.vertices.push(new n.Vector3(0,0,0),new n.Vector3(0,1,0));var t=new n.CylinderGeometry(0,.5,1,5,1);t.applyMatrix((new n.Matrix4).makeTranslation(0,-.5,0));return function(r,i,a,o,s,h){n.Object3D.call(this);if(o===undefined)o=16776960;if(a===undefined)a=1;if(s===undefined)s=.2*a;if(h===undefined)h=.2*s;this.position.copy(i);this.line=new n.Line(e,new n.LineBasicMaterial({color:o}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new n.Mesh(t,new n.MeshBasicMaterial({color:o}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(r);this.setLength(a,s,h)}}();n.ArrowHelper.prototype=Object.create(n.Object3D.prototype);n.ArrowHelper.prototype.constructor=n.ArrowHelper;n.ArrowHelper.prototype.setDirection=function(){var e=new n.Vector3;var t;return function(r){if(r.y>.99999){this.quaternion.set(0,0,0,1)}else if(r.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(r.z,0,-r.x).normalize();t=Math.acos(r.y);this.quaternion.setFromAxisAngle(e,t)}}}();n.ArrowHelper.prototype.setLength=function(e,t,r){if(t===undefined)t=.2*e;if(r===undefined)r=.2*t;this.line.scale.set(1,e-t,1);this.line.updateMatrix();this.cone.scale.set(r,t,r);this.cone.position.y=e;this.cone.updateMatrix()};n.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e);this.cone.material.color.set(e)};n.BoxHelper=function(e){var t=new n.BufferGeometry;t.addAttribute("position",new n.BufferAttribute(new Float32Array(72),3));n.Line.call(this,t,new n.LineBasicMaterial({color:16776960}),n.LinePieces);if(e!==undefined){this.update(e)}};n.BoxHelper.prototype=Object.create(n.Line.prototype);n.BoxHelper.prototype.constructor=n.BoxHelper;n.BoxHelper.prototype.update=function(e){var t=e.geometry;if(t.boundingBox===null){t.computeBoundingBox()}var r=t.boundingBox.min;var i=t.boundingBox.max;var n=this.geometry.attributes.position.array;n[0]=i.x;n[1]=i.y;n[2]=i.z;n[3]=r.x;n[4]=i.y;n[5]=i.z;n[6]=r.x;n[7]=i.y;n[8]=i.z;n[9]=r.x;n[10]=r.y;n[11]=i.z;n[12]=r.x;n[13]=r.y;n[14]=i.z;n[15]=i.x;n[16]=r.y;n[17]=i.z;n[18]=i.x;n[19]=r.y;n[20]=i.z;n[21]=i.x;n[22]=i.y;n[23]=i.z;n[24]=i.x;n[25]=i.y;n[26]=r.z;n[27]=r.x;n[28]=i.y;n[29]=r.z;n[30]=r.x;n[31]=i.y;n[32]=r.z;n[33]=r.x;n[34]=r.y;n[35]=r.z;n[36]=r.x;n[37]=r.y;n[38]=r.z;n[39]=i.x;n[40]=r.y;n[41]=r.z;n[42]=i.x;n[43]=r.y;n[44]=r.z;n[45]=i.x;n[46]=i.y;n[47]=r.z;n[48]=i.x;n[49]=i.y;n[50]=i.z;n[51]=i.x;n[52]=i.y;n[53]=r.z;n[54]=r.x;n[55]=i.y;n[56]=i.z;n[57]=r.x;n[58]=i.y;n[59]=r.z;n[60]=r.x;n[61]=r.y;n[62]=i.z;n[63]=r.x;n[64]=r.y;n[65]=r.z;n[66]=i.x;n[67]=r.y;n[68]=i.z;n[69]=i.x;n[70]=r.y;n[71]=r.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};n.BoundingBoxHelper=function(e,t){var r=t!==undefined?t:8947848;this.object=e;this.box=new n.Box3;n.Mesh.call(this,new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial({color:r,wireframe:true}))};n.BoundingBoxHelper.prototype=Object.create(n.Mesh.prototype);n.BoundingBoxHelper.prototype.constructor=n.BoundingBoxHelper;n.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};n.CameraHelper=function(e){var t=new n.Geometry;var r=new n.LineBasicMaterial({color:16777215,vertexColors:n.FaceColors});var i={};var a=16755200;var o=16711680;var s=43775;var h=16777215;var l=3355443;u("n1","n2",a);u("n2","n4",a);u("n4","n3",a);u("n3","n1",a);u("f1","f2",a);u("f2","f4",a);u("f4","f3",a);u("f3","f1",a);u("n1","f1",a);u("n2","f2",a);u("n3","f3",a);u("n4","f4",a);u("p","n1",o);u("p","n2",o);u("p","n3",o);u("p","n4",o);u("u1","u2",s);u("u2","u3",s);u("u3","u1",s);u("c","t",h);u("p","c",l);u("cn1","cn2",l);u("cn3","cn4",l);u("cf1","cf2",l);u("cf3","cf4",l);function u(e,t,r){c(e,r);c(t,r)}function c(e,r){t.vertices.push(new n.Vector3);t.colors.push(new n.Color(r));if(i[e]===undefined){i[e]=[]}i[e].push(t.vertices.length-1)}n.Line.call(this,t,r,n.LinePieces);this.camera=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=i;this.update()};n.CameraHelper.prototype=Object.create(n.Line.prototype);n.CameraHelper.prototype.constructor=n.CameraHelper;n.CameraHelper.prototype.update=function(){var e,t;var r=new n.Vector3;var i=new n.Camera;var a=function(n,a,o,s){r.set(a,o,s).unproject(i);var h=t[n];if(h!==undefined){for(var l=0,u=h.length;l<u;l++){e.vertices[h[l]].copy(r)}}};return function(){e=this.geometry;t=this.pointMap;var r=1,n=1;i.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-r,-n,-1);a("n2",r,-n,-1);a("n3",-r,n,-1);a("n4",r,n,-1);a("f1",-r,-n,1);a("f2",r,-n,1);a("f3",-r,n,1);a("f4",r,n,1);a("u1",r*.7,n*1.1,-1);a("u2",-r*.7,n*1.1,-1);a("u3",0,n*2,-1);a("cf1",-r,0,1);a("cf2",r,0,1);a("cf3",0,-n,1);a("cf4",0,n,1);a("cn1",-r,0,-1);a("cn2",r,0,-1);a("cn3",0,-n,-1);a("cn4",0,n,-1);e.verticesNeedUpdate=true}}();n.DirectionalLightHelper=function(e,t){n.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var r=new n.Geometry;r.vertices.push(new n.Vector3(-t,t,0),new n.Vector3(t,t,0),new n.Vector3(t,-t,0),new n.Vector3(-t,-t,0),new n.Vector3(-t,t,0));var i=new n.LineBasicMaterial({fog:false});i.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new n.Line(r,i);this.add(this.lightPlane);r=new n.Geometry;r.vertices.push(new n.Vector3,new n.Vector3);i=new n.LineBasicMaterial({fog:false});i.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new n.Line(r,i);this.add(this.targetLine);this.update()};n.DirectionalLightHelper.prototype=Object.create(n.Object3D.prototype);n.DirectionalLightHelper.prototype.constructor=n.DirectionalLightHelper;n.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};n.DirectionalLightHelper.prototype.update=function(){var e=new n.Vector3;var t=new n.Vector3;var r=new n.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);r.subVectors(t,e);this.lightPlane.lookAt(r);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(r);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();n.EdgesHelper=function(e,t,r){var i=t!==undefined?t:16777215;r=r!==undefined?r:1;var a=Math.cos(n.Math.degToRad(r));var o=[0,0],s={};var h=function(e,t){return e-t};var l=["a","b","c"];var u=new n.BufferGeometry;var c;if(e.geometry instanceof n.BufferGeometry){c=new n.Geometry;c.fromBufferGeometry(e.geometry)}else{c=e.geometry.clone()}c.mergeVertices();c.computeFaceNormals();var f=c.vertices;var d=c.faces;var p=0;for(var m=0,v=d.length;m<v;m++){var g=d[m];for(var y=0;y<3;y++){o[0]=g[l[y]];o[1]=g[l[(y+1)%3]];o.sort(h);var x=o.toString();if(s[x]===undefined){s[x]={vert1:o[0],vert2:o[1],face1:m,face2:undefined};p++}else{s[x].face2=m}}}var _=new Float32Array(p*2*3);var b=0;for(var x in s){var w=s[x];if(w.face2===undefined||d[w.face1].normal.dot(d[w.face2].normal)<=a){var M=f[w.vert1];_[b++]=M.x;_[b++]=M.y;_[b++]=M.z;M=f[w.vert2];_[b++]=M.x;_[b++]=M.y;_[b++]=M.z}}u.addAttribute("position",new n.BufferAttribute(_,3));n.Line.call(this,u,new n.LineBasicMaterial({color:i}),n.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};n.EdgesHelper.prototype=Object.create(n.Line.prototype);n.EdgesHelper.prototype.constructor=n.EdgesHelper;n.FaceNormalsHelper=function(e,t,r,i){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16776960;var o=i!==undefined?i:1;var s=new n.Geometry;var h=this.object.geometry.faces;for(var l=0,u=h.length;l<u;l++){s.vertices.push(new n.Vector3,new n.Vector3)}n.Line.call(this,s,new n.LineBasicMaterial({color:a,linewidth:o}),n.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new n.Matrix3;this.update()};n.FaceNormalsHelper.prototype=Object.create(n.Line.prototype);n.FaceNormalsHelper.prototype.constructor=n.FaceNormalsHelper;n.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices;var t=this.object;var r=t.geometry.vertices;var i=t.geometry.faces;var n=t.matrixWorld;t.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(n);for(var a=0,o=0,s=i.length;a<s;a++,o+=2){var h=i[a];e[o].copy(r[h.a]).add(r[h.b]).add(r[h.c]).divideScalar(3).applyMatrix4(n);e[o+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[o])}this.geometry.verticesNeedUpdate=true;return this};n.GridHelper=function(e,t){var r=new n.Geometry;var i=new n.LineBasicMaterial({vertexColors:n.VertexColors});this.color1=new n.Color(4473924);this.color2=new n.Color(8947848);for(var a=-e;a<=e;a+=t){r.vertices.push(new n.Vector3(-e,0,a),new n.Vector3(e,0,a),new n.Vector3(a,0,-e),new n.Vector3(a,0,e));var o=a===0?this.color1:this.color2;r.colors.push(o,o,o,o)}n.Line.call(this,r,i,n.LinePieces)};n.GridHelper.prototype=Object.create(n.Line.prototype);n.GridHelper.prototype.constructor=n.GridHelper;n.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};n.HemisphereLightHelper=function(e,t){n.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new n.Color,new n.Color];var r=new n.SphereGeometry(t,4,2);r.applyMatrix((new n.Matrix4).makeRotationX(-Math.PI/2));for(var i=0,a=8;i<a;i++){r.faces[i].color=this.colors[i<4?0:1]}var o=new n.MeshBasicMaterial({vertexColors:n.FaceColors,wireframe:true});this.lightSphere=new n.Mesh(r,o);this.add(this.lightSphere);this.update()};n.HemisphereLightHelper.prototype=Object.create(n.Object3D.prototype);n.HemisphereLightHelper.prototype.constructor=n.HemisphereLightHelper;n.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};n.HemisphereLightHelper.prototype.update=function(){var e=new n.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();n.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var r=new n.SphereGeometry(t,4,2);var i=new n.MeshBasicMaterial({wireframe:true,fog:false});i.color.copy(this.light.color).multiplyScalar(this.light.intensity);n.Mesh.call(this,r,i);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};n.PointLightHelper.prototype=Object.create(n.Mesh.prototype);n.PointLightHelper.prototype.constructor=n.PointLightHelper;n.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};n.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};n.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new n.Geometry;for(var r=0;r<this.bones.length;r++){var i=this.bones[r];if(i.parent instanceof n.Bone){t.vertices.push(new n.Vector3);t.vertices.push(new n.Vector3);t.colors.push(new n.Color(0,0,1));t.colors.push(new n.Color(0,1,0))}}var a=new n.LineBasicMaterial({vertexColors:n.VertexColors,depthTest:false,depthWrite:false,transparent:true});n.Line.call(this,t,a,n.LinePieces);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.update()};n.SkeletonHelper.prototype=Object.create(n.Line.prototype);n.SkeletonHelper.prototype.constructor=n.SkeletonHelper;n.SkeletonHelper.prototype.getBoneList=function(e){var t=[];if(e instanceof n.Bone){t.push(e)}for(var r=0;r<e.children.length;r++){t.push.apply(t,this.getBoneList(e.children[r]))}return t};n.SkeletonHelper.prototype.update=function(){var e=this.geometry;var t=(new n.Matrix4).getInverse(this.root.matrixWorld);var r=new n.Matrix4;var i=0;for(var a=0;a<this.bones.length;a++){var o=this.bones[a];if(o.parent instanceof n.Bone){r.multiplyMatrices(t,o.matrixWorld);e.vertices[i].setFromMatrixPosition(r);r.multiplyMatrices(t,o.parent.matrixWorld);e.vertices[i+1].setFromMatrixPosition(r);i+=2}}e.verticesNeedUpdate=true;e.computeBoundingSphere()};n.SpotLightHelper=function(e){n.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;var t=new n.CylinderGeometry(0,1,1,8,1,true);t.applyMatrix((new n.Matrix4).makeTranslation(0,-.5,0));t.applyMatrix((new n.Matrix4).makeRotationX(-Math.PI/2));var r=new n.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new n.Mesh(t,r);this.add(this.cone);this.update()};n.SpotLightHelper.prototype=Object.create(n.Object3D.prototype);n.SpotLightHelper.prototype.constructor=n.SpotLightHelper;n.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};n.SpotLightHelper.prototype.update=function(){var e=new n.Vector3;var t=new n.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4;var i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();n.VertexNormalsHelper=function(e,t,r,i){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16711680;var o=i!==undefined?i:1;var s=new n.Geometry;var h=e.geometry.faces;for(var l=0,u=h.length;l<u;l++){var c=h[l];for(var f=0,d=c.vertexNormals.length;f<d;f++){s.vertices.push(new n.Vector3,new n.Vector3)}}n.Line.call(this,s,new n.LineBasicMaterial({color:a,linewidth:o}),n.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new n.Matrix3;this.update()};n.VertexNormalsHelper.prototype=Object.create(n.Line.prototype);n.VertexNormalsHelper.prototype.constructor=n.VertexNormalsHelper;n.VertexNormalsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var i=this.geometry.vertices;var n=this.object.geometry.vertices;var a=this.object.geometry.faces;var o=this.object.matrixWorld;var s=0;for(var h=0,l=a.length;h<l;h++){var u=a[h];for(var c=0,f=u.vertexNormals.length;c<f;c++){var d=u[r[c]];var p=n[d];var m=u.vertexNormals[c];i[s].copy(p).applyMatrix4(o);t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);t.add(i[s]);s=s+1;i[s].copy(t);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}();n.VertexTangentsHelper=function(e,t,r,i){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:255;var o=i!==undefined?i:1;var s=new n.Geometry;var h=e.geometry.faces;for(var l=0,u=h.length;l<u;l++){var c=h[l];for(var f=0,d=c.vertexTangents.length;f<d;f++){s.vertices.push(new n.Vector3);s.vertices.push(new n.Vector3)}}n.Line.call(this,s,new n.LineBasicMaterial({color:a,linewidth:o}),n.LinePieces);this.matrixAutoUpdate=false;this.update()};n.VertexTangentsHelper.prototype=Object.create(n.Line.prototype);n.VertexTangentsHelper.prototype.constructor=n.VertexTangentsHelper;n.VertexTangentsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(true);var i=this.geometry.vertices;var n=this.object.geometry.vertices;var a=this.object.geometry.faces;var o=this.object.matrixWorld;var s=0;for(var h=0,l=a.length;h<l;h++){var u=a[h];for(var c=0,f=u.vertexTangents.length;c<f;c++){var d=u[r[c]];var p=n[d];var m=u.vertexTangents[c];i[s].copy(p).applyMatrix4(o);t.copy(m).transformDirection(o).multiplyScalar(this.size);t.add(i[s]);s=s+1;i[s].copy(t);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}();n.WireframeHelper=function(e,t){var r=t!==undefined?t:16777215;var i=[0,0],a={};var o=function(e,t){return e-t};var s=["a","b","c"];var h=new n.BufferGeometry;if(e.geometry instanceof n.Geometry){var l=e.geometry.vertices;var u=e.geometry.faces;var c=0;var f=new Uint32Array(6*u.length);for(var d=0,p=u.length;d<p;d++){var m=u[d];for(var v=0;v<3;v++){i[0]=m[s[v]];i[1]=m[s[(v+1)%3]];i.sort(o);var g=i.toString();if(a[g]===undefined){f[2*c]=i[0];f[2*c+1]=i[1];a[g]=true;c++}}}var y=new Float32Array(c*2*3);for(var d=0,p=c;d<p;d++){for(var v=0;v<2;v++){var x=l[f[2*d+v]];var _=6*d+3*v;y[_+0]=x.x;y[_+1]=x.y;y[_+2]=x.z}}h.addAttribute("position",new n.BufferAttribute(y,3))}else if(e.geometry instanceof n.BufferGeometry){if(e.geometry.attributes.index!==undefined){var l=e.geometry.attributes.position.array;var b=e.geometry.attributes.index.array;var w=e.geometry.drawcalls;var c=0;if(w.length===0){w=[{count:b.length,index:0,start:0}]}var f=new Uint32Array(2*b.length);for(var M=0,S=w.length;M<S;++M){var C=w[M].start;var T=w[M].count;var _=w[M].index;for(var d=C,E=C+T;d<E;d+=3){for(var v=0;v<3;v++){i[0]=_+b[d+v];i[1]=_+b[d+(v+1)%3];i.sort(o);var g=i.toString();if(a[g]===undefined){f[2*c]=i[0];f[2*c+1]=i[1];a[g]=true;c++}}}}var y=new Float32Array(c*2*3);for(var d=0,p=c;d<p;d++){for(var v=0;v<2;v++){var _=6*d+3*v;var A=3*f[2*d+v];y[_+0]=l[A];y[_+1]=l[A+1];y[_+2]=l[A+2]}}h.addAttribute("position",new n.BufferAttribute(y,3))}else{var l=e.geometry.attributes.position.array;var c=l.length/3;var L=c/3;var y=new Float32Array(c*2*3);for(var d=0,p=L;d<p;d++){for(var v=0;v<3;v++){var _=18*d+6*v;var P=9*d+3*v;y[_+0]=l[P];y[_+1]=l[P+1];y[_+2]=l[P+2];var A=9*d+3*((v+1)%3);y[_+3]=l[A];y[_+4]=l[A+1];y[_+5]=l[A+2]}}h.addAttribute("position",new n.BufferAttribute(y,3))}}n.Line.call(this,h,new n.LineBasicMaterial({color:r}),n.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};n.WireframeHelper.prototype=Object.create(n.Line.prototype);n.WireframeHelper.prototype.constructor=n.WireframeHelper;n.ImmediateRenderObject=function(){n.Object3D.call(this);this.render=function(e){}};n.ImmediateRenderObject.prototype=Object.create(n.Object3D.prototype);n.ImmediateRenderObject.prototype.constructor=n.ImmediateRenderObject;n.MorphBlendMesh=function(e,t){n.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var r=this.geometry.morphTargets.length;var i="__default";var a=0;var o=r-1;var s=r/1;this.createAnimation(i,a,o,s);this.setAnimationWeight(i,1)};n.MorphBlendMesh.prototype=Object.create(n.Mesh.prototype);n.MorphBlendMesh.prototype.constructor=n.MorphBlendMesh;n.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=n;

this.animationsList.push(n)};n.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/;var r,i={};var n=this.geometry;for(var a=0,o=n.morphTargets.length;a<o;a++){var s=n.morphTargets[a];var h=s.name.match(t);if(h&&h.length>1){var l=h[1];if(!i[l])i[l]={start:Infinity,end:-Infinity};var u=i[l];if(a<u.start)u.start=a;if(a>u.end)u.end=a;if(!r)r=l}}for(var l in i){var u=i[l];this.createAnimation(l,u.start,u.end,e)}this.firstAnimation=r};n.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};n.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};n.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];if(r){r.fps=t;r.duration=(r.end-r.start)/r.fps}};n.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];if(r){r.duration=t;r.fps=(r.end-r.start)/r.duration}};n.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];if(r){r.weight=t}};n.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];if(r){r.time=t}};n.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var r=this.animationsMap[e];if(r){t=r.time}return t};n.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var r=this.animationsMap[e];if(r){t=r.duration}return t};n.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{n.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")}};n.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};n.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(!i.active)continue;var a=i.duration/i.length;i.time+=i.direction*e;if(i.mirroredLoop){if(i.time>i.duration||i.time<0){i.direction*=-1;if(i.time>i.duration){i.time=i.duration;i.directionBackwards=true}if(i.time<0){i.time=0;i.directionBackwards=false}}}else{i.time=i.time%i.duration;if(i.time<0)i.time+=i.duration}var o=i.startFrame+n.Math.clamp(Math.floor(i.time/a),0,i.length-1);var s=i.weight;if(o!==i.currentFrame){this.morphTargetInfluences[i.lastFrame]=0;this.morphTargetInfluences[i.currentFrame]=1*s;this.morphTargetInfluences[o]=0;i.lastFrame=i.currentFrame;i.currentFrame=o}var h=i.time%a/a;if(i.directionBackwards)h=1-h;this.morphTargetInfluences[i.currentFrame]=h*s;this.morphTargetInfluences[i.lastFrame]=(1-h)*s}};if(typeof r!=="undefined"){if(typeof t!=="undefined"&&t.exports){r=t.exports=n}r.THREE=n}else{this["THREE"]=n}},{}],11:[function(e,t,r){"use strict";var i=e("three");var n=e("./passes/copy/CopyPass");var a=e("./Stack");var o=e("./Pass");function s(e,t){var r=e.getPixelRatio();this.width=Math.floor(e.context.canvas.width/r)||1;this.height=Math.floor(e.context.canvas.height/r)||1;this.output=null;this.input=null;this.read=null;this.write=null;this.settings=t||{};this.useRGBA=this.settings.useRGBA||false;this.renderer=e;this.copyPass=new n(this.settings);this.defaultMaterial=new i.MeshBasicMaterial({color:65280,wireframe:false});this.scene=new i.Scene;this.quad=new i.Mesh(new i.PlaneBufferGeometry(1,1),this.defaultMaterial);this.scene.add(this.quad);this.camera=new i.OrthographicCamera(1,1,1,1,-1e4,1e4);this.front=new i.WebGLRenderTarget(1,1,{minFilter:this.settings.minFilter!==undefined?this.settings.minFilter:i.LinearFilter,magFilter:this.settings.magFilter!==undefined?this.settings.magFilter:i.LinearFilter,wrapS:this.settings.wrapS!==undefined?this.settings.wrapS:i.ClampToEdgeWrapping,wrapT:this.settings.wrapT!==undefined?this.settings.wrapT:i.ClampToEdgeWrapping,format:this.useRGBA?i.RGBAFormat:i.RGBFormat,type:this.settings.type!==undefined?this.settings.type:i.UnsignedByteType,stencilBuffer:this.settings.stencilBuffer!==undefined?this.settings.stencilBuffer:true});this.back=this.front.clone();this.startTime=Date.now();this.passes={};this.setSize(this.width,this.height)}t.exports=s;s.prototype.swapBuffers=function(){this.output=this.write;this.input=this.read;var e=this.write;this.write=this.read;this.read=e};s.prototype.render=function(e,t,r,i){if(r)this.swapBuffers();this.renderer.render(e,t,i?i:this.write,true);if(!i)this.swapBuffers()};s.prototype.toScreen=function(){this.quad.material=this.copyPass.shader;this.quad.material.uniforms.tInput.value=this.read;this.quad.material.uniforms.resolution.value.set(this.width,this.height);this.renderer.render(this.scene,this.camera)};s.prototype.toTexture=function(e){this.quad.material=this.copyPass.shader;this.quad.material.uniforms.tInput.value=this.read;this.renderer.render(this.scene,this.camera,e,false)};s.prototype.pass=function(e){if(e instanceof a){this.passStack(e)}else{if(e instanceof i.ShaderMaterial){this.quad.material=e}if(e instanceof o){e.run(this);return}if(!e.isSim){this.quad.material.uniforms.tInput.value=this.read}this.quad.material.uniforms.resolution.value.set(this.width,this.height);this.quad.material.uniforms.time.value=.001*(Date.now()-this.startTime);this.renderer.render(this.scene,this.camera,this.write,false);this.swapBuffers()}};s.prototype.passStack=function(e){e.getPasses().forEach(function(e){this.pass(e)}.bind(this))};s.prototype.reset=function(){this.read=this.front;this.write=this.back;this.output=this.write;this.input=this.read};s.prototype.setSource=function(e){this.quad.material=this.copyPass.shader;this.quad.material.uniforms.tInput.value=e;this.renderer.render(this.scene,this.camera,this.write,true);this.swapBuffers()};s.prototype.setSize=function(e,t){this.width=e;this.height=t;this.camera.projectionMatrix.makeOrthographic(e/-2,e/2,t/2,t/-2,this.camera.near,this.camera.far);this.quad.scale.set(e,t,1);var r=this.front.clone();r.width=e;r.height=t;if(this.quad.material instanceof o){this.quad.material.uniforms.tInput.value=r}this.front=r;r=this.back.clone();r.width=e;r.height=t;this.back=r}},{"./Pass":12,"./Stack":13,"./passes/copy/CopyPass":19,three:10}],12:[function(e,t,r){"use strict";var i=e("three");var n=e("./utils/processShader");function a(){this.shader=null;this.loaded=null;this.params={};this.isSim=false}t.exports=a;a.prototype.setShader=function(e,t){this.shader=n(e,t)};a.prototype.run=function(e){e.pass(this.shader)};a.prototype.getOfflineTexture=function(e,t,r){return new i.WebGLRenderTarget(e,t,{minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:r?i.RGBAFormat:i.RGBFormat})}},{"./utils/processShader":22,three:10}],13:[function(e,t,r){"use strict";function i(e){this.passItems=[];this.shadersPool=e;this.passes=[]}t.exports=i;i.prototype.addPass=function(e,t,r,i){var n=0;var a={shaderName:e,enabled:t||false};this.passItems.push(a);n=this.passItems.length;this.updatePasses();if(i){return this.movePassToIndex(this.passItems[n],i)}else{return n-1}};i.prototype.removePass=function(e){this.passItems.splice(e,1);this.updatePasses()};i.prototype.enablePass=function(e){this.passItems[e].enabled=true;this.updatePasses()};i.prototype.disablePass=function(e){this.passItems[e].enabled=false;this.updatePasses()};i.prototype.isPassEnabled=function(e){return this.passItems[e].enabled};i.prototype.movePassToIndex=function(e,t){this.passItems.splice(t,0,this.passItems.splice(e,1)[0]);this.updatePasses();return t};i.prototype.reverse=function(){this.passItems.reverse();this.updatePasses()};i.prototype.updatePasses=function(){this.passes=this.shadersPool.getPasses(this.passItems);this.passItems.forEach(function(e,t){if(e.params===undefined){e.params=JSON.parse(JSON.stringify(this.passes[t].params))}}.bind(this))};i.prototype.getPasses=function(){return this.passes}},{}],14:[function(e,t,r){"use strict";var i=e("three");var n=e("../../Pass");var a="#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var o="#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform sampler2D tInput2;\nuniform vec2 resolution;\nuniform vec2 resolution2;\nuniform float aspectRatio;\nuniform float aspectRatio2;\nuniform int mode;\nuniform int sizeMode;\nuniform float opacity;\n\nvec2 vUv2;\n\nfloat applyOverlayToChannel( float base, float blend ) {\n\n  return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n\n}\n\nfloat applySoftLightToChannel( float base, float blend ) {\n\n  return ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)));\n\n}\n\nfloat applyColorBurnToChannel( float base, float blend ) {\n\n  return ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0));\n\n}\n\nfloat applyColorDodgeToChannel( float base, float blend ) {\n\n  return ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0));\n\n}\n\nfloat applyLinearBurnToChannel( float base, float blend ) {\n\n  return max(base + blend - 1., 0.0 );\n\n}\n\nfloat applyLinearDodgeToChannel( float base, float blend ) {\n\n  return min( base + blend, 1. );\n\n}\n\nfloat applyLinearLightToChannel( float base, float blend ) {\n\n  return ( blend < .5 ) ? applyLinearBurnToChannel( base, 2. * blend ) : applyLinearDodgeToChannel( base, 2. * ( blend - .5 ) );\n\n}\n\nvoid main() {\n\n  vUv2 = vUv;\n  \n  if( sizeMode == 1 ) {\n    \n    if( aspectRatio2 > aspectRatio ) {\n      vUv2.x = vUv.x * aspectRatio / aspectRatio2;\n      vUv2.x += .5 * ( 1. - aspectRatio / aspectRatio2 ); \n      vUv2.y = vUv.y;\n    }\n\n    if( aspectRatio2 < aspectRatio ) {\n      vUv2.x = vUv.x;\n      vUv2.y = vUv.y * aspectRatio2 / aspectRatio;\n      vUv2.y += .5 * ( 1. - aspectRatio2 / aspectRatio );\n    }\n\n  }\n\n  vec4 base = texture2D( tInput, vUv );\n  vec4 blend = texture2D( tInput2, vUv2 );\n\n  if( mode == 1 ) { // normal\n\n    gl_FragColor = base;\n    gl_FragColor.a *= opacity;\n    return;\n\n  }\n\n  if( mode == 2 ) { // dissolve\n\n  }\n\n  if( mode == 3 ) { // darken\n\n    gl_FragColor = min( base, blend );\n    return;\n\n  }\n\n  if( mode == 4 ) { // multiply\n\n    gl_FragColor = base * blend;\n    return;\n\n  }\n\n  if( mode == 5 ) { // color burn\n\n    gl_FragColor = vec4(\n      applyColorBurnToChannel( base.r, blend.r ),\n      applyColorBurnToChannel( base.g, blend.g ),\n      applyColorBurnToChannel( base.b, blend.b ),\n      applyColorBurnToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 6 ) { // linear burn\n\n    gl_FragColor = max(base + blend - 1.0, 0.0);\n    return;\n\n  }\n\n  if( mode == 7 ) { // darker color\n\n  }\n\n  if( mode == 8 ) { // lighten\n\n    gl_FragColor = max( base, blend );\n    return;\n\n  }\n\n  if( mode == 9 ) { // screen\n\n    gl_FragColor = (1.0 - ((1.0 - base) * (1.0 - blend)));\n    gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n    return;\n\n  }\n\n  if( mode == 10 ) { // color dodge\n\n    gl_FragColor = vec4(\n      applyColorDodgeToChannel( base.r, blend.r ),\n      applyColorDodgeToChannel( base.g, blend.g ),\n      applyColorDodgeToChannel( base.b, blend.b ),\n      applyColorDodgeToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 11 ) { // linear dodge\n\n    gl_FragColor = min(base + blend, 1.0);\n    return;\n\n  }\n\n  if( mode == 12 ) { // lighter color\n\n  }\n\n  if( mode == 13 ) { // overlay\n\n    gl_FragColor = gl_FragColor = vec4( \n      applyOverlayToChannel( base.r, blend.r ),\n      applyOverlayToChannel( base.g, blend.g ),\n      applyOverlayToChannel( base.b, blend.b ),\n      applyOverlayToChannel( base.a, blend.a )\n    );\n    gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n  \n    return;\n\n  }\n\n  if( mode == 14 ) { // soft light\n\n    gl_FragColor = vec4( \n      applySoftLightToChannel( base.r, blend.r ),\n      applySoftLightToChannel( base.g, blend.g ),\n      applySoftLightToChannel( base.b, blend.b ),\n      applySoftLightToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 15 ) { // hard light\n\n    gl_FragColor = vec4( \n      applyOverlayToChannel( base.r, blend.r ),\n      applyOverlayToChannel( base.g, blend.g ),\n      applyOverlayToChannel( base.b, blend.b ),\n      applyOverlayToChannel( base.a, blend.a )\n    );\n    gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n    return;\n\n  }\n\n  if( mode == 16 ) { // vivid light\n\n  }\n\n  if( mode == 17 ) { // linear light\n\n    gl_FragColor = vec4( \n      applyLinearLightToChannel( base.r, blend.r ),\n      applyLinearLightToChannel( base.g, blend.g ),\n      applyLinearLightToChannel( base.b, blend.b ),\n      applyLinearLightToChannel( base.a, blend.a )\n    );\n    return;\n\n  }\n\n  if( mode == 18 ) { // pin light\n\n  }\n\n  if( mode == 19 ) { // hard mix\n\n  }\n\n  if( mode == 20 ) { // difference\n\n    gl_FragColor = abs( base - blend );\n    gl_FragColor.a = base.a + blend.b;\n    return;\n\n  }\n\n  if( mode == 21 ) { // exclusion\n\n    gl_FragColor = base + blend - 2. * base * blend;\n    \n  }\n\n  if( mode == 22 ) { // substract\n\n  }\n\n  if( mode == 23 ) { // divide\n\n  }\n\n  gl_FragColor = vec4( 1., 0., 1., 1. );\n\n}";function s(e){n.call(this);e=e||{};this.setShader(a,o);this.params.mode=e.mode||1;this.params.opacity=e.opacity||1;this.params.tInput2=e.tInput2||null;this.params.resolution2=e.resolution2||new i.Vector2;this.params.sizeMode=e.sizeMode||1;this.params.aspectRatio=e.aspectRatio||1;this.params.aspectRatio2=e.aspectRatio2||1}t.exports=s;s.prototype=Object.create(n.prototype);s.prototype.constructor=s;s.prototype.run=function(e){this.shader.uniforms.mode.value=this.params.mode;this.shader.uniforms.opacity.value=this.params.opacity;this.shader.uniforms.tInput2.value=this.params.tInput2;this.shader.uniforms.sizeMode.value=this.params.sizeMode;this.shader.uniforms.aspectRatio.value=this.params.aspectRatio;this.shader.uniforms.aspectRatio2.value=this.params.aspectRatio2;e.pass(this.shader)}},{"../../Pass":12,three:10}],15:[function(e,t,r){"use strict";var i=e("three");var n=e("../../Pass");var a=e("../../Composer");var o=e("../../..").BlendMode;var s=e("../box-blur/FullBoxBlurPass");var h=e("../blend/BlendPass");var l=e("../zoom-blur/ZoomBlurPass");var u=e("../brightness-contrast/BrightnessContrastPass");function c(e){n.call(this);e=e||{};this.composer=null;this.tmpTexture=this.getOfflineTexture(e.width,e.height,true);this.blurPass=new s(2);this.blendPass=new h;this.zoomBlur=new l;this.brightnessContrastPass=new u;this.width=e.width||512;this.height=e.height||512;this.params.blurAmount=e.blurAmount||2;this.params.applyZoomBlur=e.applyZoomBlur||false;this.params.zoomBlurStrength=e.zoomBlurStrength||.2;this.params.useTexture=e.useTexture||false;this.params.zoomBlurCenter=e.zoomBlurCenter||new i.Vector2(.5,.5);this.params.blendMode=e.blendMode||o.Screen;this.params.glowTexture=null}t.exports=c;c.prototype=Object.create(n.prototype);c.prototype.constructor=c;c.prototype.run=function(e){if(!this.composer){this.composer=new a(e.renderer,{useRGBA:true});this.composer.setSize(this.width,this.height)}this.composer.reset();if(this.params.useTexture===true){this.composer.setSource(this.params.glowTexture)}else{this.composer.setSource(e.output)}this.blurPass.params.amount=this.params.blurAmount;this.composer.pass(this.blurPass);if(this.params.applyZoomBlur){this.zoomBlur.params.center.set(.5,.5);this.zoomBlur.params.strength=this.params.zoomBlurStrength;this.composer.pass(this.zoomBlur)}if(this.params.useTexture===true){this.blendPass.params.mode=o.Screen;this.blendPass.params.tInput=this.params.glowTexture;e.pass(this.blendPass)}this.blendPass.params.mode=this.params.blendMode;this.blendPass.params.tInput2=this.composer.output;e.pass(this.blendPass)}},{"../../..":2,"../../Composer":11,"../../Pass":12,"../blend/BlendPass":14,"../box-blur/FullBoxBlurPass":17,"../brightness-contrast/BrightnessContrastPass":18,"../zoom-blur/ZoomBlurPass":21,three:10}],16:[function(e,t,r){"use strict";var i=e("three");var n=e("../../Pass");var a="#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var o="#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 delta;\nuniform vec2 resolution;\n\nvoid main() {\n\n  vec4 sum = vec4( 0. );\n  vec2 inc = delta / resolution;\n\n  sum += texture2D( tInput, ( vUv - inc * 4. ) ) * 0.051;\n  sum += texture2D( tInput, ( vUv - inc * 3. ) ) * 0.0918;\n  sum += texture2D( tInput, ( vUv - inc * 2. ) ) * 0.12245;\n  sum += texture2D( tInput, ( vUv - inc * 1. ) ) * 0.1531;\n  sum += texture2D( tInput, ( vUv + inc * 0. ) ) * 0.1633;\n  sum += texture2D( tInput, ( vUv + inc * 1. ) ) * 0.1531;\n  sum += texture2D( tInput, ( vUv + inc * 2. ) ) * 0.12245;\n  sum += texture2D( tInput, ( vUv + inc * 3. ) ) * 0.0918;\n  sum += texture2D( tInput, ( vUv + inc * 4. ) ) * 0.051;\n\n  gl_FragColor = sum;\n\n}";function s(e,t){n.call(this);this.setShader(a,o);this.params.delta=new i.Vector2(e||0,t||0)}t.exports=s;s.prototype=Object.create(n.prototype);s.prototype.constructor=s;s.prototype.run=function(e){this.shader.uniforms.delta.value.copy(this.params.delta);e.pass(this.shader)}},{"../../Pass":12,three:10}],17:[function(e,t,r){"use strict";var i=e("../../Pass");var n=e("./BoxBlurPass");function a(e){i.call(this);e=e||2;this.boxPass=new n(e,e);this.params.amount=e}t.exports=a;a.prototype=Object.create(i.prototype);a.prototype.constructor=a;a.prototype.run=function(e){var t=this.params.amount;this.boxPass.params.delta.set(t,0);e.pass(this.boxPass);this.boxPass.params.delta.set(0,t);e.pass(this.boxPass)}},{"../../Pass":12,"./BoxBlurPass":16}],18:[function(e,t,r){"use strict";var i=e("../../Pass");var n="#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var a="#define GLSLIFY 1\n\nuniform float brightness;\nuniform float contrast;\nuniform sampler2D tInput;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vec3 color = texture2D(tInput, vUv).rgb;\n  vec3 colorContrasted = (color) * contrast;\n  vec3 bright = colorContrasted + vec3(brightness,brightness,brightness);\n  gl_FragColor.rgb = bright;\n  gl_FragColor.a = 1.;\n\n}";function o(e,t){i.call(this);this.setShader(n,a);this.params.brightness=e||1;this.params.contrast=t||1}t.exports=o;o.prototype=Object.create(i.prototype);o.prototype.constructor=o;o.prototype.run=function(e){this.shader.uniforms.brightness.value=this.params.brightness;this.shader.uniforms.contrast.value=this.params.contrast;e.pass(this.shader)}},{"../../Pass":12}],19:[function(e,t,r){"use strict";var i=e("../../Pass");var n="#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var a="#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\n\nvoid main() {\n  gl_FragColor = texture2D( tInput, vUv );\n\n}";function o(){i.call(this);this.setShader(n,a)}t.exports=o;o.prototype=Object.create(i.prototype);o.prototype.constructor=o},{"../../Pass":12}],20:[function(e,t,r){"use strict";var i=e("../../Pass");var n="#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var a="#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\n\nvoid main() {\n\n    vec2 res = 1. / resolution;\n\n    vec3 rgbNW = texture2D( tInput, ( vUv.xy + vec2( -1.0, -1.0 ) * res ) ).xyz;\n    vec3 rgbNE = texture2D( tInput, ( vUv.xy + vec2( 1.0, -1.0 ) * res ) ).xyz;\n    vec3 rgbSW = texture2D( tInput, ( vUv.xy + vec2( -1.0, 1.0 ) * res ) ).xyz;\n    vec3 rgbSE = texture2D( tInput, ( vUv.xy + vec2( 1.0, 1.0 ) * res ) ).xyz;\n    vec4 rgbaM  = texture2D( tInput,  vUv.xy  * res );\n    vec3 rgbM  = rgbaM.xyz;\n    vec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n    float lumaNW = dot( rgbNW, luma );\n    float lumaNE = dot( rgbNE, luma );\n    float lumaSW = dot( rgbSW, luma );\n    float lumaSE = dot( rgbSE, luma );\n    float lumaM  = dot( rgbM,  luma );\n    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n\n    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n    dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\n          max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                dir * rcpDirMin)) * res;\n    vec4 rgbA = (1.0/2.0) * (\n    texture2D(tInput,  vUv.xy + dir * (1.0/3.0 - 0.5)) +\n    texture2D(tInput,  vUv.xy + dir * (2.0/3.0 - 0.5)));\n    vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n    texture2D(tInput,  vUv.xy + dir * (0.0/3.0 - 0.5)) +\n    texture2D(tInput,  vUv.xy + dir * (3.0/3.0 - 0.5)));\n    float lumaB = dot(rgbB, vec4(luma, 0.0));\n\n    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\n        gl_FragColor = rgbA;\n    } else {\n        gl_FragColor = rgbB;\n    }\n\n    //gl_FragColor = vec4( texture2D( tInput,vUv ).xyz, 1. );\n}";function o(){i.call(this);this.setShader(n,a)}t.exports=o;o.prototype=Object.create(i.prototype);o.prototype.constructor=o},{"../../Pass":12}],21:[function(e,t,r){"use strict";var i=e("three");var n=e("../../Pass");var a="#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";var o="#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 center;\nuniform float strength;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nfloat random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}\n\nvoid main(){\n  vec4 color=vec4(0.0);\n  float total=0.0;\n  vec2 toCenter=center-vUv*resolution;\n  float offset=random(vec3(12.9898,78.233,151.7182),0.0);\n  for(float t=0.0;t<=40.0;t++){\n    float percent=(t+offset)/40.0;\n    float weight=4.0*(percent-percent*percent);\n    vec4 sample=texture2D(tInput,vUv+toCenter*percent*strength/resolution);\n    sample.rgb*=sample.a;\n    color+=sample*weight;\n    total+=weight;\n  }\n  gl_FragColor=color/total;\n  gl_FragColor.rgb/=gl_FragColor.a+0.00001;\n}";function s(e){n.call(this);e=e||{};this.setShader(a,o);this.params.center=new i.Vector2(e.centerX||.5,e.centerY||.5);this.params.strength=e.strength||.1}t.exports=s;s.prototype=Object.create(n.prototype);s.prototype.constructor=s;s.prototype.run=function(e){this.shader.uniforms.center.value.set(e.width*this.params.center.x,e.height*this.params.center.y);this.shader.uniforms.strength.value=this.params.strength;e.pass(this.shader)}},{"../../Pass":12,three:10}],22:[function(e,t,r){"use strict";var i=e("three");t.exports=function n(e,t){var r=/uniform\s+([^\s]+)\s+([^\s]+)\s*;/gi;var n=/uniform\s+([^\s]+)\s+([^\s]+)\s*\[\s*(\w+)\s*\]*\s*;/gi;var a={sampler2D:{type:"t",value:function(){return new i.Texture}},samplerCube:{type:"t",value:function(){}},bool:{type:"b",value:function(){return 0}},"int":{type:"i",value:function(){return 0}},"float":{type:"f",value:function(){return 0}},vec2:{type:"v2",value:function(){return new i.Vector2}},vec3:{type:"v3",value:function(){return new i.Vector3}},vec4:{type:"v4",value:function(){return new i.Vector4}},bvec2:{type:"v2",value:function(){return new i.Vector2}},bvec3:{type:"v3",value:function(){return new i.Vector3}},bvec4:{type:"v4",value:function(){return new i.Vector4}},ivec2:{type:"v2",value:function(){return new i.Vector2}},ivec3:{type:"v3",value:function(){return new i.Vector3}},ivec4:{type:"v4",value:function(){return new i.Vector4}},mat2:{type:"v2",value:function(){return new i.Matrix2}},mat3:{type:"v3",value:function(){return new i.Matrix3}},mat4:{type:"v4",value:function(){return new i.Matrix4}}};var o={"float":{type:"fv",value:function(){return[]}},vec3:{type:"v3v",value:function(){return[]}}};var s;var h={resolution:{type:"v2",value:new i.Vector2(1,1),"default":true},time:{type:"f",value:Date.now(),"default":true},tInput:{type:"t",value:new i.Texture,"default":true}};var l,u,c;while((s=r.exec(t))!==null){if(s.index===r.lastIndex){r.lastIndex++}l=s[1];u=s[2];h[u]={type:a[l].type,value:a[l].value()}}while((s=n.exec(t))!==null){if(s.index===r.lastIndex){r.lastIndex++}l=s[1];u=s[2];c=s[3];h[u]={type:o[l].type,value:o[l].value()}}var f=new i.ShaderMaterial({uniforms:h,vertexShader:e,fragmentShader:t,shading:i.FlatShading,depthWrite:false,depthTest:false,transparent:true});return f}},{three:10}]},{},[1]);